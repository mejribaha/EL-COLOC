{"ast":null,"code":"import $kKvpS$peerjsjsbinarypack from \"peerjs-js-binarypack\";\nimport $kKvpS$webrtcadapter from \"webrtc-adapter\";\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {\n    get: v,\n    set: s,\n    enumerable: true,\n    configurable: true\n  });\n}\nvar $af8cf1f663f490f4$var$webRTCAdapter =\n//@ts-ignore\n$kKvpS$webrtcadapter.default || $kKvpS$webrtcadapter;\nvar $af8cf1f663f490f4$export$25be9502477c137d = new ( /** @class */function () {\n  function class_1() {\n    this.isIOS = [\"iPad\", \"iPhone\", \"iPod\"].includes(navigator.platform);\n    this.supportedBrowsers = [\"firefox\", \"chrome\", \"safari\"];\n    this.minFirefoxVersion = 59;\n    this.minChromeVersion = 72;\n    this.minSafariVersion = 605;\n  }\n  class_1.prototype.isWebRTCSupported = function () {\n    return typeof RTCPeerConnection !== \"undefined\";\n  };\n  class_1.prototype.isBrowserSupported = function () {\n    var browser = this.getBrowser();\n    var version = this.getVersion();\n    var validBrowser = this.supportedBrowsers.includes(browser);\n    if (!validBrowser) return false;\n    if (browser === \"chrome\") return version >= this.minChromeVersion;\n    if (browser === \"firefox\") return version >= this.minFirefoxVersion;\n    if (browser === \"safari\") return !this.isIOS && version >= this.minSafariVersion;\n    return false;\n  };\n  class_1.prototype.getBrowser = function () {\n    return $af8cf1f663f490f4$var$webRTCAdapter.browserDetails.browser;\n  };\n  class_1.prototype.getVersion = function () {\n    return $af8cf1f663f490f4$var$webRTCAdapter.browserDetails.version || 0;\n  };\n  class_1.prototype.isUnifiedPlanSupported = function () {\n    var browser = this.getBrowser();\n    var version = $af8cf1f663f490f4$var$webRTCAdapter.browserDetails.version || 0;\n    if (browser === \"chrome\" && version < this.minChromeVersion) return false;\n    if (browser === \"firefox\" && version >= this.minFirefoxVersion) return true;\n    if (!window.RTCRtpTransceiver || !(\"currentDirection\" in RTCRtpTransceiver.prototype)) return false;\n    var tempPc;\n    var supported = false;\n    try {\n      tempPc = new RTCPeerConnection();\n      tempPc.addTransceiver(\"audio\");\n      supported = true;\n    } catch (e) {} finally {\n      if (tempPc) tempPc.close();\n    }\n    return supported;\n  };\n  class_1.prototype.toString = function () {\n    return \"Supports:\\n    browser:\".concat(this.getBrowser(), \"\\n    version:\").concat(this.getVersion(), \"\\n    isIOS:\").concat(this.isIOS, \"\\n    isWebRTCSupported:\").concat(this.isWebRTCSupported(), \"\\n    isBrowserSupported:\").concat(this.isBrowserSupported(), \"\\n    isUnifiedPlanSupported:\").concat(this.isUnifiedPlanSupported());\n  };\n  return class_1;\n}())();\nvar $06cb531ed7840f78$var$DEFAULT_CONFIG = {\n  iceServers: [{\n    urls: \"stun:stun.l.google.com:19302\"\n  }, {\n    urls: [\"turn:eu-0.turn.peerjs.com:3478\", \"turn:us-0.turn.peerjs.com:3478\"],\n    username: \"peerjs\",\n    credential: \"peerjsp\"\n  }],\n  sdpSemantics: \"unified-plan\"\n};\nvar $06cb531ed7840f78$var$Util = /** @class */function () {\n  function Util() {\n    this.CLOUD_HOST = \"0.peerjs.com\";\n    this.CLOUD_PORT = 443;\n    // Browsers that need chunking:\n    this.chunkedBrowsers = {\n      Chrome: 1,\n      chrome: 1\n    };\n    this.chunkedMTU = 16300; // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n    // Returns browser-agnostic default config\n    this.defaultConfig = $06cb531ed7840f78$var$DEFAULT_CONFIG;\n    this.browser = $af8cf1f663f490f4$export$25be9502477c137d.getBrowser();\n    this.browserVersion = $af8cf1f663f490f4$export$25be9502477c137d.getVersion();\n    // Lists which features are supported\n    this.supports = function () {\n      var supported = {\n        browser: $af8cf1f663f490f4$export$25be9502477c137d.isBrowserSupported(),\n        webRTC: $af8cf1f663f490f4$export$25be9502477c137d.isWebRTCSupported(),\n        audioVideo: false,\n        data: false,\n        binaryBlob: false,\n        reliable: false\n      };\n      if (!supported.webRTC) return supported;\n      var pc;\n      try {\n        pc = new RTCPeerConnection($06cb531ed7840f78$var$DEFAULT_CONFIG);\n        supported.audioVideo = true;\n        var dc = void 0;\n        try {\n          dc = pc.createDataChannel(\"_PEERJSTEST\", {\n            ordered: true\n          });\n          supported.data = true;\n          supported.reliable = !!dc.ordered;\n          // Binary test\n          try {\n            dc.binaryType = \"blob\";\n            supported.binaryBlob = !$af8cf1f663f490f4$export$25be9502477c137d.isIOS;\n          } catch (e) {}\n        } catch (e) {} finally {\n          if (dc) dc.close();\n        }\n      } catch (e) {} finally {\n        if (pc) pc.close();\n      }\n      return supported;\n    }();\n    this.pack = $kKvpS$peerjsjsbinarypack.pack;\n    this.unpack = $kKvpS$peerjsjsbinarypack.unpack;\n    // Binary stuff\n    this._dataCount = 1;\n  }\n  Util.prototype.noop = function () {};\n  // Ensure alphanumeric ids\n  Util.prototype.validateId = function (id) {\n    // Allow empty ids\n    return !id || /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id);\n  };\n  Util.prototype.chunk = function (blob) {\n    var chunks = [];\n    var size = blob.size;\n    var total = Math.ceil(size / $06cb531ed7840f78$export$7debb50ef11d5e0b.chunkedMTU);\n    var index = 0;\n    var start = 0;\n    while (start < size) {\n      var end = Math.min(size, start + $06cb531ed7840f78$export$7debb50ef11d5e0b.chunkedMTU);\n      var b = blob.slice(start, end);\n      var chunk = {\n        __peerData: this._dataCount,\n        n: index,\n        data: b,\n        total: total\n      };\n      chunks.push(chunk);\n      start = end;\n      index++;\n    }\n    this._dataCount++;\n    return chunks;\n  };\n  Util.prototype.blobToArrayBuffer = function (blob, cb) {\n    var fr = new FileReader();\n    fr.onload = function (evt) {\n      if (evt.target) cb(evt.target.result);\n    };\n    fr.readAsArrayBuffer(blob);\n    return fr;\n  };\n  Util.prototype.binaryStringToArrayBuffer = function (binary) {\n    var byteArray = new Uint8Array(binary.length);\n    for (var i = 0; i < binary.length; i++) byteArray[i] = binary.charCodeAt(i) & 0xff;\n    return byteArray.buffer;\n  };\n  Util.prototype.randomToken = function () {\n    return Math.random().toString(36).slice(2);\n  };\n  Util.prototype.isSecure = function () {\n    return location.protocol === \"https:\";\n  };\n  return Util;\n}();\nvar $06cb531ed7840f78$export$7debb50ef11d5e0b = new $06cb531ed7840f78$var$Util();\nvar $26088d7da5b03f69$exports = {};\n$parcel$export($26088d7da5b03f69$exports, \"Peer\", () => $26088d7da5b03f69$export$ecd1fc136c422448, v => $26088d7da5b03f69$export$ecd1fc136c422448 = v);\nvar $ac9b757d51178e15$exports = {};\n'use strict';\nvar $ac9b757d51178e15$var$has = Object.prototype.hasOwnProperty,\n  $ac9b757d51178e15$var$prefix = '~';\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction $ac9b757d51178e15$var$Events() {}\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  $ac9b757d51178e15$var$Events.prototype = Object.create(null);\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new $ac9b757d51178e15$var$Events().__proto__) $ac9b757d51178e15$var$prefix = false;\n}\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction $ac9b757d51178e15$var$EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction $ac9b757d51178e15$var$addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') throw new TypeError('The listener must be a function');\n  var listener = new $ac9b757d51178e15$var$EE(fn, context || emitter, once),\n    evt = $ac9b757d51178e15$var$prefix ? $ac9b757d51178e15$var$prefix + event : event;\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);else emitter._events[evt] = [emitter._events[evt], listener];\n  return emitter;\n}\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction $ac9b757d51178e15$var$clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new $ac9b757d51178e15$var$Events();else delete emitter._events[evt];\n}\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction $ac9b757d51178e15$var$EventEmitter() {\n  this._events = new $ac9b757d51178e15$var$Events();\n  this._eventsCount = 0;\n}\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.eventNames = function eventNames() {\n  var names = [],\n    events,\n    name;\n  if (this._eventsCount === 0) return names;\n  for (name in events = this._events) if ($ac9b757d51178e15$var$has.call(events, name)) names.push($ac9b757d51178e15$var$prefix ? name.slice(1) : name);\n  if (Object.getOwnPropertySymbols) return names.concat(Object.getOwnPropertySymbols(events));\n  return names;\n};\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.listeners = function listeners(event) {\n  var evt = $ac9b757d51178e15$var$prefix ? $ac9b757d51178e15$var$prefix + event : event,\n    handlers = this._events[evt];\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) ee[i] = handlers[i].fn;\n  return ee;\n};\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = $ac9b757d51178e15$var$prefix ? $ac9b757d51178e15$var$prefix + event : event,\n    listeners = this._events[evt];\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = $ac9b757d51178e15$var$prefix ? $ac9b757d51178e15$var$prefix + event : event;\n  if (!this._events[evt]) return false;\n  var listeners = this._events[evt],\n    len = arguments.length,\n    args,\n    i;\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n    switch (len) {\n      case 1:\n        return listeners.fn.call(listeners.context), true;\n      case 2:\n        return listeners.fn.call(listeners.context, a1), true;\n      case 3:\n        return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4:\n        return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5:\n        return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6:\n        return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n    for (i = 1, args = new Array(len - 1); i < len; i++) args[i - 1] = arguments[i];\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length,\n      j;\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n      switch (len) {\n        case 1:\n          listeners[i].fn.call(listeners[i].context);\n          break;\n        case 2:\n          listeners[i].fn.call(listeners[i].context, a1);\n          break;\n        case 3:\n          listeners[i].fn.call(listeners[i].context, a1, a2);\n          break;\n        case 4:\n          listeners[i].fn.call(listeners[i].context, a1, a2, a3);\n          break;\n        default:\n          if (!args) for (j = 1, args = new Array(len - 1); j < len; j++) args[j - 1] = arguments[j];\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n  return true;\n};\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.on = function on(event, fn, context) {\n  return $ac9b757d51178e15$var$addListener(this, event, fn, context, false);\n};\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.once = function once(event, fn, context) {\n  return $ac9b757d51178e15$var$addListener(this, event, fn, context, true);\n};\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = $ac9b757d51178e15$var$prefix ? $ac9b757d51178e15$var$prefix + event : event;\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    $ac9b757d51178e15$var$clearEvent(this, evt);\n    return this;\n  }\n  var listeners = this._events[evt];\n  if (listeners.fn) {\n    if (listeners.fn === fn && (!once || listeners.once) && (!context || listeners.context === context)) $ac9b757d51178e15$var$clearEvent(this, evt);\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) if (listeners[i].fn !== fn || once && !listeners[i].once || context && listeners[i].context !== context) events.push(listeners[i]);\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;else $ac9b757d51178e15$var$clearEvent(this, evt);\n  }\n  return this;\n};\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\n$ac9b757d51178e15$var$EventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n  if (event) {\n    evt = $ac9b757d51178e15$var$prefix ? $ac9b757d51178e15$var$prefix + event : event;\n    if (this._events[evt]) $ac9b757d51178e15$var$clearEvent(this, evt);\n  } else {\n    this._events = new $ac9b757d51178e15$var$Events();\n    this._eventsCount = 0;\n  }\n  return this;\n};\n//\n// Alias methods names because people roll like that.\n//\n$ac9b757d51178e15$var$EventEmitter.prototype.off = $ac9b757d51178e15$var$EventEmitter.prototype.removeListener;\n$ac9b757d51178e15$var$EventEmitter.prototype.addListener = $ac9b757d51178e15$var$EventEmitter.prototype.on;\n//\n// Expose the prefix.\n//\n$ac9b757d51178e15$var$EventEmitter.prefixed = $ac9b757d51178e15$var$prefix;\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\n$ac9b757d51178e15$var$EventEmitter.EventEmitter = $ac9b757d51178e15$var$EventEmitter;\n$ac9b757d51178e15$exports = $ac9b757d51178e15$var$EventEmitter;\nvar $1615705ecc6adca3$exports = {};\n$parcel$export($1615705ecc6adca3$exports, \"LogLevel\", () => $1615705ecc6adca3$export$243e62d78d3b544d, v => $1615705ecc6adca3$export$243e62d78d3b544d = v);\n$parcel$export($1615705ecc6adca3$exports, \"default\", () => $1615705ecc6adca3$export$2e2bcd8739ae039, v => $1615705ecc6adca3$export$2e2bcd8739ae039 = v);\nvar $1615705ecc6adca3$var$__read = undefined && undefined.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar $1615705ecc6adca3$var$__spreadArray = undefined && undefined.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) {\n    for (var i = 0, l = from.length, ar; i < l; i++) if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar $1615705ecc6adca3$var$LOG_PREFIX = \"PeerJS: \";\nvar $1615705ecc6adca3$export$243e62d78d3b544d;\n(function ($1615705ecc6adca3$export$243e62d78d3b544d) {\n  $1615705ecc6adca3$export$243e62d78d3b544d[$1615705ecc6adca3$export$243e62d78d3b544d[\"Disabled\"] = 0] = \"Disabled\";\n  $1615705ecc6adca3$export$243e62d78d3b544d[$1615705ecc6adca3$export$243e62d78d3b544d[\"Errors\"] = 1] = \"Errors\";\n  $1615705ecc6adca3$export$243e62d78d3b544d[$1615705ecc6adca3$export$243e62d78d3b544d[\"Warnings\"] = 2] = \"Warnings\";\n  $1615705ecc6adca3$export$243e62d78d3b544d[$1615705ecc6adca3$export$243e62d78d3b544d[\"All\"] = 3] = \"All\";\n})($1615705ecc6adca3$export$243e62d78d3b544d || ($1615705ecc6adca3$export$243e62d78d3b544d = {}));\nvar $1615705ecc6adca3$var$Logger = /** @class */function () {\n  function Logger() {\n    this._logLevel = $1615705ecc6adca3$export$243e62d78d3b544d.Disabled;\n  }\n  Object.defineProperty(Logger.prototype, \"logLevel\", {\n    get: function () {\n      return this._logLevel;\n    },\n    set: function (logLevel) {\n      this._logLevel = logLevel;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Logger.prototype.log = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) args[_i] = arguments[_i];\n    if (this._logLevel >= $1615705ecc6adca3$export$243e62d78d3b544d.All) this._print.apply(this, $1615705ecc6adca3$var$__spreadArray([$1615705ecc6adca3$export$243e62d78d3b544d.All], $1615705ecc6adca3$var$__read(args), false));\n  };\n  Logger.prototype.warn = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) args[_i] = arguments[_i];\n    if (this._logLevel >= $1615705ecc6adca3$export$243e62d78d3b544d.Warnings) this._print.apply(this, $1615705ecc6adca3$var$__spreadArray([$1615705ecc6adca3$export$243e62d78d3b544d.Warnings], $1615705ecc6adca3$var$__read(args), false));\n  };\n  Logger.prototype.error = function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) args[_i] = arguments[_i];\n    if (this._logLevel >= $1615705ecc6adca3$export$243e62d78d3b544d.Errors) this._print.apply(this, $1615705ecc6adca3$var$__spreadArray([$1615705ecc6adca3$export$243e62d78d3b544d.Errors], $1615705ecc6adca3$var$__read(args), false));\n  };\n  Logger.prototype.setLogFunction = function (fn) {\n    this._print = fn;\n  };\n  Logger.prototype._print = function (logLevel) {\n    var rest = [];\n    for (var _i = 1; _i < arguments.length; _i++) rest[_i - 1] = arguments[_i];\n    var copy = $1615705ecc6adca3$var$__spreadArray([$1615705ecc6adca3$var$LOG_PREFIX], $1615705ecc6adca3$var$__read(rest), false);\n    for (var i in copy) if (copy[i] instanceof Error) copy[i] = \"(\" + copy[i].name + \") \" + copy[i].message;\n    if (logLevel >= $1615705ecc6adca3$export$243e62d78d3b544d.All) console.log.apply(console, $1615705ecc6adca3$var$__spreadArray([], $1615705ecc6adca3$var$__read(copy), false));else if (logLevel >= $1615705ecc6adca3$export$243e62d78d3b544d.Warnings) console.warn.apply(console, $1615705ecc6adca3$var$__spreadArray([\"WARNING\"], $1615705ecc6adca3$var$__read(copy), false));else if (logLevel >= $1615705ecc6adca3$export$243e62d78d3b544d.Errors) console.error.apply(console, $1615705ecc6adca3$var$__spreadArray([\"ERROR\"], $1615705ecc6adca3$var$__read(copy), false));\n  };\n  return Logger;\n}();\nvar $1615705ecc6adca3$export$2e2bcd8739ae039 = new $1615705ecc6adca3$var$Logger();\nvar $31d11a8d122cb4b7$exports = {};\n$parcel$export($31d11a8d122cb4b7$exports, \"Socket\", () => $31d11a8d122cb4b7$export$4798917dbf149b79, v => $31d11a8d122cb4b7$export$4798917dbf149b79 = v);\nvar $60fadef21a2daafc$export$3157d57b4135e3bc;\n(function ($60fadef21a2daafc$export$3157d57b4135e3bc) {\n  $60fadef21a2daafc$export$3157d57b4135e3bc[\"Data\"] = \"data\";\n  $60fadef21a2daafc$export$3157d57b4135e3bc[\"Media\"] = \"media\";\n})($60fadef21a2daafc$export$3157d57b4135e3bc || ($60fadef21a2daafc$export$3157d57b4135e3bc = {}));\nvar $60fadef21a2daafc$export$9547aaa2e39030ff;\n(function ($60fadef21a2daafc$export$9547aaa2e39030ff) {\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"BrowserIncompatible\"] = \"browser-incompatible\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"Disconnected\"] = \"disconnected\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"InvalidID\"] = \"invalid-id\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"InvalidKey\"] = \"invalid-key\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"Network\"] = \"network\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"PeerUnavailable\"] = \"peer-unavailable\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"SslUnavailable\"] = \"ssl-unavailable\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"ServerError\"] = \"server-error\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"SocketError\"] = \"socket-error\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"SocketClosed\"] = \"socket-closed\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"UnavailableID\"] = \"unavailable-id\";\n  $60fadef21a2daafc$export$9547aaa2e39030ff[\"WebRTC\"] = \"webrtc\";\n})($60fadef21a2daafc$export$9547aaa2e39030ff || ($60fadef21a2daafc$export$9547aaa2e39030ff = {}));\nvar $60fadef21a2daafc$export$89f507cf986a947;\n(function ($60fadef21a2daafc$export$89f507cf986a947) {\n  $60fadef21a2daafc$export$89f507cf986a947[\"Binary\"] = \"binary\";\n  $60fadef21a2daafc$export$89f507cf986a947[\"BinaryUTF8\"] = \"binary-utf8\";\n  $60fadef21a2daafc$export$89f507cf986a947[\"JSON\"] = \"json\";\n})($60fadef21a2daafc$export$89f507cf986a947 || ($60fadef21a2daafc$export$89f507cf986a947 = {}));\nvar $60fadef21a2daafc$export$3b5c4a4b6354f023;\n(function ($60fadef21a2daafc$export$3b5c4a4b6354f023) {\n  $60fadef21a2daafc$export$3b5c4a4b6354f023[\"Message\"] = \"message\";\n  $60fadef21a2daafc$export$3b5c4a4b6354f023[\"Disconnected\"] = \"disconnected\";\n  $60fadef21a2daafc$export$3b5c4a4b6354f023[\"Error\"] = \"error\";\n  $60fadef21a2daafc$export$3b5c4a4b6354f023[\"Close\"] = \"close\";\n})($60fadef21a2daafc$export$3b5c4a4b6354f023 || ($60fadef21a2daafc$export$3b5c4a4b6354f023 = {}));\nvar $60fadef21a2daafc$export$adb4a1754da6f10d;\n(function ($60fadef21a2daafc$export$adb4a1754da6f10d) {\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Heartbeat\"] = \"HEARTBEAT\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Candidate\"] = \"CANDIDATE\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Offer\"] = \"OFFER\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Answer\"] = \"ANSWER\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Open\"] = \"OPEN\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Error\"] = \"ERROR\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"IdTaken\"] = \"ID-TAKEN\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"InvalidKey\"] = \"INVALID-KEY\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Leave\"] = \"LEAVE\";\n  $60fadef21a2daafc$export$adb4a1754da6f10d[\"Expire\"] = \"EXPIRE\";\n})($60fadef21a2daafc$export$adb4a1754da6f10d || ($60fadef21a2daafc$export$adb4a1754da6f10d = {}));\nvar $0d1ed891c5cb27c0$exports = {};\n$0d1ed891c5cb27c0$exports = JSON.parse(\"{\\\"name\\\":\\\"peerjs\\\",\\\"version\\\":\\\"1.4.7\\\",\\\"keywords\\\":[\\\"peerjs\\\",\\\"webrtc\\\",\\\"p2p\\\",\\\"rtc\\\"],\\\"description\\\":\\\"PeerJS client\\\",\\\"homepage\\\":\\\"https://peerjs.com\\\",\\\"bugs\\\":{\\\"url\\\":\\\"https://github.com/peers/peerjs/issues\\\"},\\\"repository\\\":{\\\"type\\\":\\\"git\\\",\\\"url\\\":\\\"https://github.com/peers/peerjs\\\"},\\\"license\\\":\\\"MIT\\\",\\\"contributors\\\":[\\\"Michelle Bu <michelle@michellebu.com>\\\",\\\"afrokick <devbyru@gmail.com>\\\",\\\"ericz <really.ez@gmail.com>\\\",\\\"Jairo <kidandcat@gmail.com>\\\",\\\"Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>\\\",\\\"Jairo Caro-Accino Viciana <jairo@galax.be>\\\",\\\"Carlos Caballero <carlos.caballero.gonzalez@gmail.com>\\\",\\\"hc <hheennrryy@gmail.com>\\\",\\\"Muhammad Asif <capripio@gmail.com>\\\",\\\"PrashoonB <prashoonbhattacharjee@gmail.com>\\\",\\\"Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>\\\",\\\"akotynski <aleksanderkotbury@gmail.com>\\\",\\\"lmb <i@lmb.io>\\\",\\\"Jairooo <jairocaro@msn.com>\\\",\\\"Moritz Stückler <moritz.stueckler@gmail.com>\\\",\\\"Simon <crydotsnakegithub@gmail.com>\\\",\\\"Denis Lukov <denismassters@gmail.com>\\\",\\\"Philipp Hancke <fippo@andyet.net>\\\",\\\"Hans Oksendahl <hansoksendahl@gmail.com>\\\",\\\"Jess <jessachandler@gmail.com>\\\",\\\"khankuan <khankuan@gmail.com>\\\",\\\"DUODVK <kurmanov.work@gmail.com>\\\",\\\"XiZhao <kwang1imsa@gmail.com>\\\",\\\"Matthias Lohr <matthias@lohr.me>\\\",\\\"=frank tree <=frnktrb@googlemail.com>\\\",\\\"Andre Eckardt <aeckardt@outlook.com>\\\",\\\"Chris Cowan <agentme49@gmail.com>\\\",\\\"Alex Chuev <alex@chuev.com>\\\",\\\"alxnull <alxnull@e.mail.de>\\\",\\\"Yemel Jardi <angel.jardi@gmail.com>\\\",\\\"Ben Parnell <benjaminparnell.94@gmail.com>\\\",\\\"Benny Lichtner <bennlich@gmail.com>\\\",\\\"fresheneesz <bitetrudpublic@gmail.com>\\\",\\\"bob.barstead@exaptive.com <bob.barstead@exaptive.com>\\\",\\\"chandika <chandika@gmail.com>\\\",\\\"emersion <contact@emersion.fr>\\\",\\\"Christopher Van <cvan@users.noreply.github.com>\\\",\\\"eddieherm <edhermoso@gmail.com>\\\",\\\"Eduardo Pinho <enet4mikeenet@gmail.com>\\\",\\\"Evandro Zanatta <ezanatta@tray.net.br>\\\",\\\"Gardner Bickford <gardner@users.noreply.github.com>\\\",\\\"Gian Luca <gianluca.cecchi@cynny.com>\\\",\\\"PatrickJS <github@gdi2290.com>\\\",\\\"jonnyf <github@jonathanfoss.co.uk>\\\",\\\"Hizkia Felix <hizkifw@gmail.com>\\\",\\\"Hristo Oskov <hristo.oskov@gmail.com>\\\",\\\"Isaac Madwed <i.madwed@gmail.com>\\\",\\\"Ilya Konanykhin <ilya.konanykhin@gmail.com>\\\",\\\"jasonbarry <jasbarry@me.com>\\\",\\\"Jonathan Burke <jonathan.burke.1311@googlemail.com>\\\",\\\"Josh Hamit <josh.hamit@gmail.com>\\\",\\\"Jordan Austin <jrax86@gmail.com>\\\",\\\"Joel Wetzell <jwetzell@yahoo.com>\\\",\\\"xizhao <kevin.wang@cloudera.com>\\\",\\\"Alberto Torres <kungfoobar@gmail.com>\\\",\\\"Jonathan Mayol <mayoljonathan@gmail.com>\\\",\\\"Jefferson Felix <me@jsfelix.dev>\\\",\\\"Rolf Erik Lekang <me@rolflekang.com>\\\",\\\"Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>\\\",\\\"Pepijn de Vos <pepijndevos@gmail.com>\\\",\\\"JooYoung <qkdlql@naver.com>\\\",\\\"Tobias Speicher <rootcommander@gmail.com>\\\",\\\"Steve Blaurock <sblaurock@gmail.com>\\\",\\\"Kyrylo Shegeda <shegeda@ualberta.ca>\\\",\\\"Diwank Singh Tomer <singh@diwank.name>\\\",\\\"Sören Balko <Soeren.Balko@gmail.com>\\\",\\\"Arpit Solanki <solankiarpit1997@gmail.com>\\\",\\\"Yuki Ito <yuki@gnnk.net>\\\",\\\"Artur Zayats <zag2art@gmail.com>\\\"],\\\"funding\\\":{\\\"type\\\":\\\"opencollective\\\",\\\"url\\\":\\\"https://opencollective.com/peer\\\"},\\\"collective\\\":{\\\"type\\\":\\\"opencollective\\\",\\\"url\\\":\\\"https://opencollective.com/peer\\\"},\\\"files\\\":[\\\"dist/*\\\"],\\\"sideEffects\\\":[\\\"lib/global.ts\\\",\\\"lib/supports.ts\\\"],\\\"main\\\":\\\"dist/bundler.cjs\\\",\\\"module\\\":\\\"dist/bundler.mjs\\\",\\\"browser-minified\\\":\\\"dist/peerjs.min.js\\\",\\\"browser-unminified\\\":\\\"dist/peerjs.js\\\",\\\"types\\\":\\\"dist/types.d.ts\\\",\\\"engines\\\":{\\\"node\\\":\\\">= 10\\\"},\\\"targets\\\":{\\\"types\\\":{\\\"source\\\":\\\"lib/exports.ts\\\"},\\\"main\\\":{\\\"source\\\":\\\"lib/exports.ts\\\",\\\"sourceMap\\\":{\\\"inlineSources\\\":true}},\\\"module\\\":{\\\"source\\\":\\\"lib/exports.ts\\\",\\\"includeNodeModules\\\":[\\\"eventemitter3\\\"],\\\"sourceMap\\\":{\\\"inlineSources\\\":true}},\\\"browser-minified\\\":{\\\"context\\\":\\\"browser\\\",\\\"outputFormat\\\":\\\"global\\\",\\\"optimize\\\":true,\\\"engines\\\":{\\\"browsers\\\":\\\"cover 99%, not dead\\\"},\\\"source\\\":\\\"lib/global.ts\\\"},\\\"browser-unminified\\\":{\\\"context\\\":\\\"browser\\\",\\\"outputFormat\\\":\\\"global\\\",\\\"optimize\\\":false,\\\"engines\\\":{\\\"browsers\\\":\\\"cover 99%, not dead\\\"},\\\"source\\\":\\\"lib/global.ts\\\"}},\\\"scripts\\\":{\\\"contributors\\\":\\\"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\\\\\\"chore(contributors): update and sort contributors list\\\\\\\"\\\",\\\"check\\\":\\\"tsc --noEmit\\\",\\\"watch\\\":\\\"parcel watch\\\",\\\"build\\\":\\\"rm -rf dist && parcel build\\\",\\\"prepublishOnly\\\":\\\"npm run build\\\",\\\"test\\\":\\\"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts\\\",\\\"format\\\":\\\"prettier --write .\\\",\\\"semantic-release\\\":\\\"semantic-release\\\"},\\\"devDependencies\\\":{\\\"@parcel/config-default\\\":\\\"^2.5.0\\\",\\\"@parcel/packager-ts\\\":\\\"^2.5.0\\\",\\\"@parcel/transformer-typescript-tsc\\\":\\\"^2.5.0\\\",\\\"@parcel/transformer-typescript-types\\\":\\\"^2.5.0\\\",\\\"@semantic-release/changelog\\\":\\\"^6.0.1\\\",\\\"@semantic-release/git\\\":\\\"^10.0.1\\\",\\\"@types/chai\\\":\\\"^4.3.0\\\",\\\"@types/mocha\\\":\\\"^9.1.0\\\",\\\"@types/node\\\":\\\"^17.0.18\\\",\\\"chai\\\":\\\"^4.3.6\\\",\\\"git-authors-cli\\\":\\\"^1.0.40\\\",\\\"jsdom\\\":\\\"^19.0.0\\\",\\\"jsdom-global\\\":\\\"^3.0.2\\\",\\\"mocha\\\":\\\"^9.2.0\\\",\\\"mock-socket\\\":\\\"8.0.5\\\",\\\"parcel\\\":\\\"^2.5.0\\\",\\\"parcel-transformer-tsc-sourcemaps\\\":\\\"^1.0.2\\\",\\\"prettier\\\":\\\"^2.6.2\\\",\\\"semantic-release\\\":\\\"^19.0.2\\\",\\\"standard\\\":\\\"^16.0.4\\\",\\\"ts-node\\\":\\\"^10.5.0\\\",\\\"typescript\\\":\\\"^4.5.5\\\"},\\\"dependencies\\\":{\\\"@swc/helpers\\\":\\\"^0.3.13\\\",\\\"eventemitter3\\\":\\\"^4.0.7\\\",\\\"peerjs-js-binarypack\\\":\\\"1.0.1\\\",\\\"webrtc-adapter\\\":\\\"^7.7.1\\\"}}\");\nvar $31d11a8d122cb4b7$var$__extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d1, b1) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d1, b1);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar $31d11a8d122cb4b7$var$__read = undefined && undefined.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar $31d11a8d122cb4b7$var$__spreadArray = undefined && undefined.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) {\n    for (var i = 0, l = from.length, ar; i < l; i++) if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar $31d11a8d122cb4b7$var$__values = undefined && undefined.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n/**\n * An abstraction on top of WebSockets to provide fastest\n * possible connection for peers.\n */\nvar $31d11a8d122cb4b7$export$4798917dbf149b79 = /** @class */function (_super) {\n  $31d11a8d122cb4b7$var$__extends($31d11a8d122cb4b7$export$4798917dbf149b79, _super);\n  function $31d11a8d122cb4b7$export$4798917dbf149b79(secure, host, port, path, key, pingInterval) {\n    if (pingInterval === void 0) pingInterval = 5000;\n    var _this = _super.call(this) || this;\n    _this.pingInterval = pingInterval;\n    _this._disconnected = true;\n    _this._messagesQueue = [];\n    var wsProtocol = secure ? \"wss://\" : \"ws://\";\n    _this._baseUrl = wsProtocol + host + \":\" + port + path + \"peerjs?key=\" + key;\n    return _this;\n  }\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype.start = function (id, token) {\n    var _this = this;\n    this._id = id;\n    var wsUrl = \"\".concat(this._baseUrl, \"&id=\").concat(id, \"&token=\").concat(token);\n    if (!!this._socket || !this._disconnected) return;\n    this._socket = new WebSocket(wsUrl + \"&version=\" + $0d1ed891c5cb27c0$exports.version);\n    this._disconnected = false;\n    this._socket.onmessage = function (event) {\n      var data;\n      try {\n        data = JSON.parse(event.data);\n        $1615705ecc6adca3$exports.default.log(\"Server message received:\", data);\n      } catch (e) {\n        $1615705ecc6adca3$exports.default.log(\"Invalid server message\", event.data);\n        return;\n      }\n      _this.emit($60fadef21a2daafc$export$3b5c4a4b6354f023.Message, data);\n    };\n    this._socket.onclose = function (event) {\n      if (_this._disconnected) return;\n      $1615705ecc6adca3$exports.default.log(\"Socket closed.\", event);\n      _this._cleanup();\n      _this._disconnected = true;\n      _this.emit($60fadef21a2daafc$export$3b5c4a4b6354f023.Disconnected);\n    };\n    // Take care of the queue of connections if necessary and make sure Peer knows\n    // socket is open.\n    this._socket.onopen = function () {\n      if (_this._disconnected) return;\n      _this._sendQueuedMessages();\n      $1615705ecc6adca3$exports.default.log(\"Socket open\");\n      _this._scheduleHeartbeat();\n    };\n  };\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype._scheduleHeartbeat = function () {\n    var _this = this;\n    this._wsPingTimer = setTimeout(function () {\n      _this._sendHeartbeat();\n    }, this.pingInterval);\n  };\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype._sendHeartbeat = function () {\n    if (!this._wsOpen()) {\n      $1615705ecc6adca3$exports.default.log(\"Cannot send heartbeat, because socket closed\");\n      return;\n    }\n    var message = JSON.stringify({\n      type: $60fadef21a2daafc$export$adb4a1754da6f10d.Heartbeat\n    });\n    this._socket.send(message);\n    this._scheduleHeartbeat();\n  };\n  /** Is the websocket currently open? */\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype._wsOpen = function () {\n    return !!this._socket && this._socket.readyState === 1;\n  };\n  /** Send queued messages. */\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype._sendQueuedMessages = function () {\n    var e_1, _a;\n    //Create copy of queue and clear it,\n    //because send method push the message back to queue if smth will go wrong\n    var copiedQueue = $31d11a8d122cb4b7$var$__spreadArray([], $31d11a8d122cb4b7$var$__read(this._messagesQueue), false);\n    this._messagesQueue = [];\n    try {\n      for (var copiedQueue_1 = $31d11a8d122cb4b7$var$__values(copiedQueue), copiedQueue_1_1 = copiedQueue_1.next(); !copiedQueue_1_1.done; copiedQueue_1_1 = copiedQueue_1.next()) {\n        var message = copiedQueue_1_1.value;\n        this.send(message);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (copiedQueue_1_1 && !copiedQueue_1_1.done && (_a = copiedQueue_1.return)) _a.call(copiedQueue_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n  /** Exposed send for DC & Peer. */\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype.send = function (data) {\n    if (this._disconnected) return;\n    // If we didn't get an ID yet, we can't yet send anything so we should queue\n    // up these messages.\n    if (!this._id) {\n      this._messagesQueue.push(data);\n      return;\n    }\n    if (!data.type) {\n      this.emit($60fadef21a2daafc$export$3b5c4a4b6354f023.Error, \"Invalid message\");\n      return;\n    }\n    if (!this._wsOpen()) return;\n    var message = JSON.stringify(data);\n    this._socket.send(message);\n  };\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype.close = function () {\n    if (this._disconnected) return;\n    this._cleanup();\n    this._disconnected = true;\n  };\n  $31d11a8d122cb4b7$export$4798917dbf149b79.prototype._cleanup = function () {\n    if (this._socket) {\n      this._socket.onopen = this._socket.onmessage = this._socket.onclose = null;\n      this._socket.close();\n      this._socket = undefined;\n    }\n    clearTimeout(this._wsPingTimer);\n  };\n  return $31d11a8d122cb4b7$export$4798917dbf149b79;\n}($ac9b757d51178e15$exports.EventEmitter);\nvar $353dee38f9ab557b$exports = {};\n$parcel$export($353dee38f9ab557b$exports, \"MediaConnection\", () => $353dee38f9ab557b$export$4a84e95a2324ac29, v => $353dee38f9ab557b$export$4a84e95a2324ac29 = v);\nvar $77f14d3e81888156$exports = {};\n$parcel$export($77f14d3e81888156$exports, \"Negotiator\", () => $77f14d3e81888156$export$89e6bb5ad64bf4a, v => $77f14d3e81888156$export$89e6bb5ad64bf4a = v);\nvar $77f14d3e81888156$var$__assign = undefined && undefined.__assign || function () {\n  $77f14d3e81888156$var$__assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return $77f14d3e81888156$var$__assign.apply(this, arguments);\n};\nvar $77f14d3e81888156$var$__awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar $77f14d3e81888156$var$__generator = undefined && undefined.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n/**\n * Manages all negotiations between Peers.\n */\nvar $77f14d3e81888156$export$89e6bb5ad64bf4a = /** @class */function () {\n  function $77f14d3e81888156$export$89e6bb5ad64bf4a(connection) {\n    this.connection = connection;\n  }\n  /** Returns a PeerConnection object set up correctly (for data, media). */\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype.startConnection = function (options) {\n    var peerConnection = this._startPeerConnection();\n    // Set the connection's PC.\n    this.connection.peerConnection = peerConnection;\n    if (this.connection.type === $60fadef21a2daafc$export$3157d57b4135e3bc.Media && options._stream) this._addTracksToConnection(options._stream, peerConnection);\n    // What do we need to do now?\n    if (options.originator) {\n      if (this.connection.type === $60fadef21a2daafc$export$3157d57b4135e3bc.Data) {\n        var dataConnection = this.connection;\n        var config = {\n          ordered: !!options.reliable\n        };\n        var dataChannel = peerConnection.createDataChannel(dataConnection.label, config);\n        dataConnection.initialize(dataChannel);\n      }\n      this._makeOffer();\n    } else this.handleSDP(\"OFFER\", options.sdp);\n  };\n  /** Start a PC. */\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype._startPeerConnection = function () {\n    $1615705ecc6adca3$exports.default.log(\"Creating RTCPeerConnection.\");\n    var peerConnection = new RTCPeerConnection(this.connection.provider.options.config);\n    this._setupListeners(peerConnection);\n    return peerConnection;\n  };\n  /** Set up various WebRTC listeners. */\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype._setupListeners = function (peerConnection) {\n    var _this = this;\n    var peerId = this.connection.peer;\n    var connectionId = this.connection.connectionId;\n    var connectionType = this.connection.type;\n    var provider = this.connection.provider;\n    // ICE CANDIDATES.\n    $1615705ecc6adca3$exports.default.log(\"Listening for ICE candidates.\");\n    peerConnection.onicecandidate = function (evt) {\n      if (!evt.candidate || !evt.candidate.candidate) return;\n      $1615705ecc6adca3$exports.default.log(\"Received ICE candidates for \".concat(peerId, \":\"), evt.candidate);\n      provider.socket.send({\n        type: $60fadef21a2daafc$export$adb4a1754da6f10d.Candidate,\n        payload: {\n          candidate: evt.candidate,\n          type: connectionType,\n          connectionId: connectionId\n        },\n        dst: peerId\n      });\n    };\n    peerConnection.oniceconnectionstatechange = function () {\n      switch (peerConnection.iceConnectionState) {\n        case \"failed\":\n          $1615705ecc6adca3$exports.default.log(\"iceConnectionState is failed, closing connections to \" + peerId);\n          _this.connection.emit(\"error\", new Error(\"Negotiation of connection to \" + peerId + \" failed.\"));\n          _this.connection.close();\n          break;\n        case \"closed\":\n          $1615705ecc6adca3$exports.default.log(\"iceConnectionState is closed, closing connections to \" + peerId);\n          _this.connection.emit(\"error\", new Error(\"Connection to \" + peerId + \" closed.\"));\n          _this.connection.close();\n          break;\n        case \"disconnected\":\n          $1615705ecc6adca3$exports.default.log(\"iceConnectionState changed to disconnected on the connection with \" + peerId);\n          break;\n        case \"completed\":\n          peerConnection.onicecandidate = $06cb531ed7840f78$export$7debb50ef11d5e0b.noop;\n          break;\n      }\n      _this.connection.emit(\"iceStateChanged\", peerConnection.iceConnectionState);\n    };\n    // DATACONNECTION.\n    $1615705ecc6adca3$exports.default.log(\"Listening for data channel\");\n    // Fired between offer and answer, so options should already be saved\n    // in the options hash.\n    peerConnection.ondatachannel = function (evt) {\n      $1615705ecc6adca3$exports.default.log(\"Received data channel\");\n      var dataChannel = evt.channel;\n      var connection = provider.getConnection(peerId, connectionId);\n      connection.initialize(dataChannel);\n    };\n    // MEDIACONNECTION.\n    $1615705ecc6adca3$exports.default.log(\"Listening for remote stream\");\n    peerConnection.ontrack = function (evt) {\n      $1615705ecc6adca3$exports.default.log(\"Received remote stream\");\n      var stream = evt.streams[0];\n      var connection = provider.getConnection(peerId, connectionId);\n      if (connection.type === $60fadef21a2daafc$export$3157d57b4135e3bc.Media) {\n        var mediaConnection = connection;\n        _this._addStreamToMediaConnection(stream, mediaConnection);\n      }\n    };\n  };\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype.cleanup = function () {\n    $1615705ecc6adca3$exports.default.log(\"Cleaning up PeerConnection to \" + this.connection.peer);\n    var peerConnection = this.connection.peerConnection;\n    if (!peerConnection) return;\n    this.connection.peerConnection = null;\n    //unsubscribe from all PeerConnection's events\n    peerConnection.onicecandidate = peerConnection.oniceconnectionstatechange = peerConnection.ondatachannel = peerConnection.ontrack = function () {};\n    var peerConnectionNotClosed = peerConnection.signalingState !== \"closed\";\n    var dataChannelNotClosed = false;\n    if (this.connection.type === $60fadef21a2daafc$export$3157d57b4135e3bc.Data) {\n      var dataConnection = this.connection;\n      var dataChannel = dataConnection.dataChannel;\n      if (dataChannel) dataChannelNotClosed = !!dataChannel.readyState && dataChannel.readyState !== \"closed\";\n    }\n    if (peerConnectionNotClosed || dataChannelNotClosed) peerConnection.close();\n  };\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype._makeOffer = function () {\n    return $77f14d3e81888156$var$__awaiter(this, void 0, Promise, function () {\n      var peerConnection, provider, offer, payload, dataConnection, err_2, err_1_1;\n      return $77f14d3e81888156$var$__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            peerConnection = this.connection.peerConnection;\n            provider = this.connection.provider;\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 7,, 8]);\n            return [4 /*yield*/, peerConnection.createOffer(this.connection.options.constraints)];\n          case 2:\n            offer = _a.sent();\n            $1615705ecc6adca3$exports.default.log(\"Created offer.\");\n            if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === \"function\") offer.sdp = this.connection.options.sdpTransform(offer.sdp) || offer.sdp;\n            _a.label = 3;\n          case 3:\n            _a.trys.push([3, 5,, 6]);\n            return [4 /*yield*/, peerConnection.setLocalDescription(offer)];\n          case 4:\n            _a.sent();\n            $1615705ecc6adca3$exports.default.log(\"Set localDescription:\", offer, \"for:\".concat(this.connection.peer));\n            payload = {\n              sdp: offer,\n              type: this.connection.type,\n              connectionId: this.connection.connectionId,\n              metadata: this.connection.metadata,\n              browser: $06cb531ed7840f78$export$7debb50ef11d5e0b.browser\n            };\n            if (this.connection.type === $60fadef21a2daafc$export$3157d57b4135e3bc.Data) {\n              dataConnection = this.connection;\n              payload = $77f14d3e81888156$var$__assign($77f14d3e81888156$var$__assign({}, payload), {\n                label: dataConnection.label,\n                reliable: dataConnection.reliable,\n                serialization: dataConnection.serialization\n              });\n            }\n            provider.socket.send({\n              type: $60fadef21a2daafc$export$adb4a1754da6f10d.Offer,\n              payload: payload,\n              dst: this.connection.peer\n            });\n            return [3 /*break*/, 6];\n          case 5:\n            err_2 = _a.sent();\n            // TODO: investigate why _makeOffer is being called from the answer\n            if (err_2 != \"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer\") {\n              provider.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.WebRTC, err_2);\n              $1615705ecc6adca3$exports.default.log(\"Failed to setLocalDescription, \", err_2);\n            }\n            return [3 /*break*/, 6];\n          case 6:\n            return [3 /*break*/, 8];\n          case 7:\n            err_1_1 = _a.sent();\n            provider.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.WebRTC, err_1_1);\n            $1615705ecc6adca3$exports.default.log(\"Failed to createOffer, \", err_1_1);\n            return [3 /*break*/, 8];\n          case 8:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype._makeAnswer = function () {\n    return $77f14d3e81888156$var$__awaiter(this, void 0, Promise, function () {\n      var peerConnection, provider, answer, err_3, err_1_2;\n      return $77f14d3e81888156$var$__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            peerConnection = this.connection.peerConnection;\n            provider = this.connection.provider;\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 7,, 8]);\n            return [4 /*yield*/, peerConnection.createAnswer()];\n          case 2:\n            answer = _a.sent();\n            $1615705ecc6adca3$exports.default.log(\"Created answer.\");\n            if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === \"function\") answer.sdp = this.connection.options.sdpTransform(answer.sdp) || answer.sdp;\n            _a.label = 3;\n          case 3:\n            _a.trys.push([3, 5,, 6]);\n            return [4 /*yield*/, peerConnection.setLocalDescription(answer)];\n          case 4:\n            _a.sent();\n            $1615705ecc6adca3$exports.default.log(\"Set localDescription:\", answer, \"for:\".concat(this.connection.peer));\n            provider.socket.send({\n              type: $60fadef21a2daafc$export$adb4a1754da6f10d.Answer,\n              payload: {\n                sdp: answer,\n                type: this.connection.type,\n                connectionId: this.connection.connectionId,\n                browser: $06cb531ed7840f78$export$7debb50ef11d5e0b.browser\n              },\n              dst: this.connection.peer\n            });\n            return [3 /*break*/, 6];\n          case 5:\n            err_3 = _a.sent();\n            provider.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.WebRTC, err_3);\n            $1615705ecc6adca3$exports.default.log(\"Failed to setLocalDescription, \", err_3);\n            return [3 /*break*/, 6];\n          case 6:\n            return [3 /*break*/, 8];\n          case 7:\n            err_1_2 = _a.sent();\n            provider.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.WebRTC, err_1_2);\n            $1615705ecc6adca3$exports.default.log(\"Failed to create answer, \", err_1_2);\n            return [3 /*break*/, 8];\n          case 8:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** Handle an SDP. */\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype.handleSDP = function (type, sdp) {\n    return $77f14d3e81888156$var$__awaiter(this, void 0, Promise, function () {\n      var peerConnection, provider, self, err_4;\n      return $77f14d3e81888156$var$__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            sdp = new RTCSessionDescription(sdp);\n            peerConnection = this.connection.peerConnection;\n            provider = this.connection.provider;\n            $1615705ecc6adca3$exports.default.log(\"Setting remote description\", sdp);\n            self = this;\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 5,, 6]);\n            return [4 /*yield*/, peerConnection.setRemoteDescription(sdp)];\n          case 2:\n            _a.sent();\n            $1615705ecc6adca3$exports.default.log(\"Set remoteDescription:\".concat(type, \" for:\").concat(this.connection.peer));\n            if (!(type === \"OFFER\")) return [3 /*break*/, 4];\n            return [4 /*yield*/, self._makeAnswer()];\n          case 3:\n            _a.sent();\n            _a.label = 4;\n          case 4:\n            return [3 /*break*/, 6];\n          case 5:\n            err_4 = _a.sent();\n            provider.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.WebRTC, err_4);\n            $1615705ecc6adca3$exports.default.log(\"Failed to setRemoteDescription, \", err_4);\n            return [3 /*break*/, 6];\n          case 6:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** Handle a candidate. */\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype.handleCandidate = function (ice) {\n    return $77f14d3e81888156$var$__awaiter(this, void 0, Promise, function () {\n      var candidate, sdpMLineIndex, sdpMid, peerConnection, provider, err_5;\n      return $77f14d3e81888156$var$__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            $1615705ecc6adca3$exports.default.log(\"handleCandidate:\", ice);\n            candidate = ice.candidate;\n            sdpMLineIndex = ice.sdpMLineIndex;\n            sdpMid = ice.sdpMid;\n            peerConnection = this.connection.peerConnection;\n            provider = this.connection.provider;\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, peerConnection.addIceCandidate(new RTCIceCandidate({\n              sdpMid: sdpMid,\n              sdpMLineIndex: sdpMLineIndex,\n              candidate: candidate\n            }))];\n          case 2:\n            _a.sent();\n            $1615705ecc6adca3$exports.default.log(\"Added ICE candidate for:\".concat(this.connection.peer));\n            return [3 /*break*/, 4];\n          case 3:\n            err_5 = _a.sent();\n            provider.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.WebRTC, err_5);\n            $1615705ecc6adca3$exports.default.log(\"Failed to handleCandidate, \", err_5);\n            return [3 /*break*/, 4];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype._addTracksToConnection = function (stream, peerConnection) {\n    $1615705ecc6adca3$exports.default.log(\"add tracks from stream \".concat(stream.id, \" to peer connection\"));\n    if (!peerConnection.addTrack) return $1615705ecc6adca3$exports.default.error(\"Your browser does't support RTCPeerConnection#addTrack. Ignored.\");\n    stream.getTracks().forEach(function (track) {\n      peerConnection.addTrack(track, stream);\n    });\n  };\n  $77f14d3e81888156$export$89e6bb5ad64bf4a.prototype._addStreamToMediaConnection = function (stream, mediaConnection) {\n    $1615705ecc6adca3$exports.default.log(\"add stream \".concat(stream.id, \" to media connection \").concat(mediaConnection.connectionId));\n    mediaConnection.addStream(stream);\n  };\n  return $77f14d3e81888156$export$89e6bb5ad64bf4a;\n}();\nvar $0b3b332fd86c5202$exports = {};\n$parcel$export($0b3b332fd86c5202$exports, \"BaseConnection\", () => $0b3b332fd86c5202$export$23a2a68283c24d80, v => $0b3b332fd86c5202$export$23a2a68283c24d80 = v);\nvar $0b3b332fd86c5202$var$__extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d1, b1) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d1, b1);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar $0b3b332fd86c5202$export$23a2a68283c24d80 = /** @class */function (_super) {\n  $0b3b332fd86c5202$var$__extends($0b3b332fd86c5202$export$23a2a68283c24d80, _super);\n  function $0b3b332fd86c5202$export$23a2a68283c24d80(peer, provider, options) {\n    var _this = _super.call(this) || this;\n    _this.peer = peer;\n    _this.provider = provider;\n    _this.options = options;\n    _this._open = false;\n    _this.metadata = options.metadata;\n    return _this;\n  }\n  Object.defineProperty($0b3b332fd86c5202$export$23a2a68283c24d80.prototype, \"open\", {\n    get: function () {\n      return this._open;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return $0b3b332fd86c5202$export$23a2a68283c24d80;\n}($ac9b757d51178e15$exports.EventEmitter);\nvar $353dee38f9ab557b$var$__extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d1, b1) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d1, b1);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar $353dee38f9ab557b$var$__assign = undefined && undefined.__assign || function () {\n  $353dee38f9ab557b$var$__assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return $353dee38f9ab557b$var$__assign.apply(this, arguments);\n};\nvar $353dee38f9ab557b$var$__values = undefined && undefined.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n/**\n * Wraps the streaming interface between two Peers.\n */\nvar $353dee38f9ab557b$export$4a84e95a2324ac29 = /** @class */function (_super) {\n  $353dee38f9ab557b$var$__extends($353dee38f9ab557b$export$4a84e95a2324ac29, _super);\n  function $353dee38f9ab557b$export$4a84e95a2324ac29(peerId, provider, options) {\n    var _this = _super.call(this, peerId, provider, options) || this;\n    _this._localStream = _this.options._stream;\n    _this.connectionId = _this.options.connectionId || $353dee38f9ab557b$export$4a84e95a2324ac29.ID_PREFIX + $06cb531ed7840f78$export$7debb50ef11d5e0b.randomToken();\n    _this._negotiator = new $77f14d3e81888156$exports.Negotiator(_this);\n    if (_this._localStream) _this._negotiator.startConnection({\n      _stream: _this._localStream,\n      originator: true\n    });\n    return _this;\n  }\n  Object.defineProperty($353dee38f9ab557b$export$4a84e95a2324ac29.prototype, \"type\", {\n    get: function () {\n      return $60fadef21a2daafc$export$3157d57b4135e3bc.Media;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($353dee38f9ab557b$export$4a84e95a2324ac29.prototype, \"localStream\", {\n    get: function () {\n      return this._localStream;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($353dee38f9ab557b$export$4a84e95a2324ac29.prototype, \"remoteStream\", {\n    get: function () {\n      return this._remoteStream;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  $353dee38f9ab557b$export$4a84e95a2324ac29.prototype.addStream = function (remoteStream) {\n    $1615705ecc6adca3$exports.default.log(\"Receiving stream\", remoteStream);\n    this._remoteStream = remoteStream;\n    _super.prototype.emit.call(this, \"stream\", remoteStream); // Should we call this `open`?\n  };\n\n  $353dee38f9ab557b$export$4a84e95a2324ac29.prototype.handleMessage = function (message) {\n    var type = message.type;\n    var payload = message.payload;\n    switch (message.type) {\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Answer:\n        // Forward to negotiator\n        this._negotiator.handleSDP(type, payload.sdp);\n        this._open = true;\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Candidate:\n        this._negotiator.handleCandidate(payload.candidate);\n        break;\n      default:\n        $1615705ecc6adca3$exports.default.warn(\"Unrecognized message type:\".concat(type, \" from peer:\").concat(this.peer));\n        break;\n    }\n  };\n  $353dee38f9ab557b$export$4a84e95a2324ac29.prototype.answer = function (stream, options) {\n    var e_1, _a;\n    if (options === void 0) options = {};\n    if (this._localStream) {\n      $1615705ecc6adca3$exports.default.warn(\"Local stream already exists on this MediaConnection. Are you answering a call twice?\");\n      return;\n    }\n    this._localStream = stream;\n    if (options && options.sdpTransform) this.options.sdpTransform = options.sdpTransform;\n    this._negotiator.startConnection($353dee38f9ab557b$var$__assign($353dee38f9ab557b$var$__assign({}, this.options._payload), {\n      _stream: stream\n    }));\n    // Retrieve lost messages stored because PeerConnection not set up.\n    var messages = this.provider._getMessages(this.connectionId);\n    try {\n      for (var messages_1 = $353dee38f9ab557b$var$__values(messages), messages_1_1 = messages_1.next(); !messages_1_1.done; messages_1_1 = messages_1.next()) {\n        var message = messages_1_1.value;\n        this.handleMessage(message);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (messages_1_1 && !messages_1_1.done && (_a = messages_1.return)) _a.call(messages_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n    this._open = true;\n  };\n  /**\n   * Exposed functionality for users.\n   */ /** Allows user to close connection. */\n  $353dee38f9ab557b$export$4a84e95a2324ac29.prototype.close = function () {\n    if (this._negotiator) {\n      this._negotiator.cleanup();\n      this._negotiator = null;\n    }\n    this._localStream = null;\n    this._remoteStream = null;\n    if (this.provider) {\n      this.provider._removeConnection(this);\n      this.provider = null;\n    }\n    if (this.options && this.options._stream) this.options._stream = null;\n    if (!this.open) return;\n    this._open = false;\n    _super.prototype.emit.call(this, \"close\");\n  };\n  $353dee38f9ab557b$export$4a84e95a2324ac29.ID_PREFIX = \"mc_\";\n  return $353dee38f9ab557b$export$4a84e95a2324ac29;\n}($0b3b332fd86c5202$exports.BaseConnection);\nvar $3356170d7bce7f20$exports = {};\n$parcel$export($3356170d7bce7f20$exports, \"DataConnection\", () => $3356170d7bce7f20$export$d365f7ad9d7df9c9, v => $3356170d7bce7f20$export$d365f7ad9d7df9c9 = v);\nvar $3014d862dcc9946b$exports = {};\n$parcel$export($3014d862dcc9946b$exports, \"EncodingQueue\", () => $3014d862dcc9946b$export$c6913ae0ed687038, v => $3014d862dcc9946b$export$c6913ae0ed687038 = v);\nvar $3014d862dcc9946b$var$__extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d1, b1) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d1, b1);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar $3014d862dcc9946b$export$c6913ae0ed687038 = /** @class */function (_super) {\n  $3014d862dcc9946b$var$__extends($3014d862dcc9946b$export$c6913ae0ed687038, _super);\n  function $3014d862dcc9946b$export$c6913ae0ed687038() {\n    var _this = _super.call(this) || this;\n    _this.fileReader = new FileReader();\n    _this._queue = [];\n    _this._processing = false;\n    _this.fileReader.onload = function (evt) {\n      _this._processing = false;\n      if (evt.target) _this.emit(\"done\", evt.target.result);\n      _this.doNextTask();\n    };\n    _this.fileReader.onerror = function (evt) {\n      $1615705ecc6adca3$exports.default.error(\"EncodingQueue error:\", evt);\n      _this._processing = false;\n      _this.destroy();\n      _this.emit(\"error\", evt);\n    };\n    return _this;\n  }\n  Object.defineProperty($3014d862dcc9946b$export$c6913ae0ed687038.prototype, \"queue\", {\n    get: function () {\n      return this._queue;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($3014d862dcc9946b$export$c6913ae0ed687038.prototype, \"size\", {\n    get: function () {\n      return this.queue.length;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($3014d862dcc9946b$export$c6913ae0ed687038.prototype, \"processing\", {\n    get: function () {\n      return this._processing;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  $3014d862dcc9946b$export$c6913ae0ed687038.prototype.enque = function (blob) {\n    this.queue.push(blob);\n    if (this.processing) return;\n    this.doNextTask();\n  };\n  $3014d862dcc9946b$export$c6913ae0ed687038.prototype.destroy = function () {\n    this.fileReader.abort();\n    this._queue = [];\n  };\n  $3014d862dcc9946b$export$c6913ae0ed687038.prototype.doNextTask = function () {\n    if (this.size === 0) return;\n    if (this.processing) return;\n    this._processing = true;\n    this.fileReader.readAsArrayBuffer(this.queue.shift());\n  };\n  return $3014d862dcc9946b$export$c6913ae0ed687038;\n}($ac9b757d51178e15$exports.EventEmitter);\nvar $3356170d7bce7f20$var$__extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d1, b1) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d1, b1);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar $3356170d7bce7f20$var$__values = undefined && undefined.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n/**\n * Wraps a DataChannel between two Peers.\n */\nvar $3356170d7bce7f20$export$d365f7ad9d7df9c9 = /** @class */function (_super) {\n  $3356170d7bce7f20$var$__extends($3356170d7bce7f20$export$d365f7ad9d7df9c9, _super);\n  function $3356170d7bce7f20$export$d365f7ad9d7df9c9(peerId, provider, options) {\n    var _this = _super.call(this, peerId, provider, options) || this;\n    _this.stringify = JSON.stringify;\n    _this.parse = JSON.parse;\n    _this._buffer = [];\n    _this._bufferSize = 0;\n    _this._buffering = false;\n    _this._chunkedData = {};\n    _this._encodingQueue = new $3014d862dcc9946b$exports.EncodingQueue();\n    _this.connectionId = _this.options.connectionId || $3356170d7bce7f20$export$d365f7ad9d7df9c9.ID_PREFIX + $06cb531ed7840f78$export$7debb50ef11d5e0b.randomToken();\n    _this.label = _this.options.label || _this.connectionId;\n    _this.serialization = _this.options.serialization || $60fadef21a2daafc$export$89f507cf986a947.Binary;\n    _this.reliable = !!_this.options.reliable;\n    _this._encodingQueue.on(\"done\", function (ab) {\n      _this._bufferedSend(ab);\n    });\n    _this._encodingQueue.on(\"error\", function () {\n      $1615705ecc6adca3$exports.default.error(\"DC#\".concat(_this.connectionId, \": Error occured in encoding from blob to arraybuffer, close DC\"));\n      _this.close();\n    });\n    _this._negotiator = new $77f14d3e81888156$exports.Negotiator(_this);\n    _this._negotiator.startConnection(_this.options._payload || {\n      originator: true\n    });\n    return _this;\n  }\n  Object.defineProperty($3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype, \"type\", {\n    get: function () {\n      return $60fadef21a2daafc$export$3157d57b4135e3bc.Data;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype, \"dataChannel\", {\n    get: function () {\n      return this._dc;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype, \"bufferSize\", {\n    get: function () {\n      return this._bufferSize;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /** Called by the Negotiator when the DataChannel is ready. */\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype.initialize = function (dc) {\n    this._dc = dc;\n    this._configureDataChannel();\n  };\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype._configureDataChannel = function () {\n    var _this = this;\n    if (!$06cb531ed7840f78$export$7debb50ef11d5e0b.supports.binaryBlob || $06cb531ed7840f78$export$7debb50ef11d5e0b.supports.reliable) this.dataChannel.binaryType = \"arraybuffer\";\n    this.dataChannel.onopen = function () {\n      $1615705ecc6adca3$exports.default.log(\"DC#\".concat(_this.connectionId, \" dc connection success\"));\n      _this._open = true;\n      _this.emit(\"open\");\n    };\n    this.dataChannel.onmessage = function (e) {\n      $1615705ecc6adca3$exports.default.log(\"DC#\".concat(_this.connectionId, \" dc onmessage:\"), e.data);\n      _this._handleDataMessage(e);\n    };\n    this.dataChannel.onclose = function () {\n      $1615705ecc6adca3$exports.default.log(\"DC#\".concat(_this.connectionId, \" dc closed for:\"), _this.peer);\n      _this.close();\n    };\n  };\n  // Handles a DataChannel message.\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype._handleDataMessage = function (_a) {\n    var _this = this;\n    var data = _a.data;\n    var datatype = data.constructor;\n    var isBinarySerialization = this.serialization === $60fadef21a2daafc$export$89f507cf986a947.Binary || this.serialization === $60fadef21a2daafc$export$89f507cf986a947.BinaryUTF8;\n    var deserializedData = data;\n    if (isBinarySerialization) {\n      if (datatype === Blob) {\n        // Datatype should never be blob\n        $06cb531ed7840f78$export$7debb50ef11d5e0b.blobToArrayBuffer(data, function (ab) {\n          var unpackedData = $06cb531ed7840f78$export$7debb50ef11d5e0b.unpack(ab);\n          _this.emit(\"data\", unpackedData);\n        });\n        return;\n      } else if (datatype === ArrayBuffer) deserializedData = $06cb531ed7840f78$export$7debb50ef11d5e0b.unpack(data);else if (datatype === String) {\n        // String fallback for binary data for browsers that don't support binary yet\n        var ab1 = $06cb531ed7840f78$export$7debb50ef11d5e0b.binaryStringToArrayBuffer(data);\n        deserializedData = $06cb531ed7840f78$export$7debb50ef11d5e0b.unpack(ab1);\n      }\n    } else if (this.serialization === $60fadef21a2daafc$export$89f507cf986a947.JSON) deserializedData = this.parse(data);\n    // Check if we've chunked--if so, piece things back together.\n    // We're guaranteed that this isn't 0.\n    if (deserializedData.__peerData) {\n      this._handleChunk(deserializedData);\n      return;\n    }\n    _super.prototype.emit.call(this, \"data\", deserializedData);\n  };\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype._handleChunk = function (data) {\n    var id = data.__peerData;\n    var chunkInfo = this._chunkedData[id] || {\n      data: [],\n      count: 0,\n      total: data.total\n    };\n    chunkInfo.data[data.n] = data.data;\n    chunkInfo.count++;\n    this._chunkedData[id] = chunkInfo;\n    if (chunkInfo.total === chunkInfo.count) {\n      // Clean up before making the recursive call to `_handleDataMessage`.\n      delete this._chunkedData[id];\n      // We've received all the chunks--time to construct the complete data.\n      var data_1 = new Blob(chunkInfo.data);\n      this._handleDataMessage({\n        data: data_1\n      });\n    }\n  };\n  /**\n   * Exposed functionality for users.\n   */ /** Allows user to close connection. */\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype.close = function () {\n    this._buffer = [];\n    this._bufferSize = 0;\n    this._chunkedData = {};\n    if (this._negotiator) {\n      this._negotiator.cleanup();\n      this._negotiator = null;\n    }\n    if (this.provider) {\n      this.provider._removeConnection(this);\n      this.provider = null;\n    }\n    if (this.dataChannel) {\n      this.dataChannel.onopen = null;\n      this.dataChannel.onmessage = null;\n      this.dataChannel.onclose = null;\n      this._dc = null;\n    }\n    if (this._encodingQueue) {\n      this._encodingQueue.destroy();\n      this._encodingQueue.removeAllListeners();\n      this._encodingQueue = null;\n    }\n    if (!this.open) return;\n    this._open = false;\n    _super.prototype.emit.call(this, \"close\");\n  };\n  /** Allows user to send data. */\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype.send = function (data, chunked) {\n    if (!this.open) {\n      _super.prototype.emit.call(this, \"error\", new Error(\"Connection is not open. You should listen for the `open` event before sending messages.\"));\n      return;\n    }\n    if (this.serialization === $60fadef21a2daafc$export$89f507cf986a947.JSON) this._bufferedSend(this.stringify(data));else if (this.serialization === $60fadef21a2daafc$export$89f507cf986a947.Binary || this.serialization === $60fadef21a2daafc$export$89f507cf986a947.BinaryUTF8) {\n      var blob = $06cb531ed7840f78$export$7debb50ef11d5e0b.pack(data);\n      if (!chunked && blob.size > $06cb531ed7840f78$export$7debb50ef11d5e0b.chunkedMTU) {\n        this._sendChunks(blob);\n        return;\n      }\n      if (!$06cb531ed7840f78$export$7debb50ef11d5e0b.supports.binaryBlob)\n        // We only do this if we really need to (e.g. blobs are not supported),\n        // because this conversion is costly.\n        this._encodingQueue.enque(blob);else this._bufferedSend(blob);\n    } else this._bufferedSend(data);\n  };\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype._bufferedSend = function (msg) {\n    if (this._buffering || !this._trySend(msg)) {\n      this._buffer.push(msg);\n      this._bufferSize = this._buffer.length;\n    }\n  };\n  // Returns true if the send succeeds.\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype._trySend = function (msg) {\n    var _this = this;\n    if (!this.open) return false;\n    if (this.dataChannel.bufferedAmount > $3356170d7bce7f20$export$d365f7ad9d7df9c9.MAX_BUFFERED_AMOUNT) {\n      this._buffering = true;\n      setTimeout(function () {\n        _this._buffering = false;\n        _this._tryBuffer();\n      }, 50);\n      return false;\n    }\n    try {\n      this.dataChannel.send(msg);\n    } catch (e) {\n      $1615705ecc6adca3$exports.default.error(\"DC#:\".concat(this.connectionId, \" Error when sending:\"), e);\n      this._buffering = true;\n      this.close();\n      return false;\n    }\n    return true;\n  };\n  // Try to send the first message in the buffer.\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype._tryBuffer = function () {\n    if (!this.open) return;\n    if (this._buffer.length === 0) return;\n    var msg = this._buffer[0];\n    if (this._trySend(msg)) {\n      this._buffer.shift();\n      this._bufferSize = this._buffer.length;\n      this._tryBuffer();\n    }\n  };\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype._sendChunks = function (blob) {\n    var e_1, _a;\n    var blobs = $06cb531ed7840f78$export$7debb50ef11d5e0b.chunk(blob);\n    $1615705ecc6adca3$exports.default.log(\"DC#\".concat(this.connectionId, \" Try to send \").concat(blobs.length, \" chunks...\"));\n    try {\n      for (var blobs_1 = $3356170d7bce7f20$var$__values(blobs), blobs_1_1 = blobs_1.next(); !blobs_1_1.done; blobs_1_1 = blobs_1.next()) {\n        var blob_1 = blobs_1_1.value;\n        this.send(blob_1, true);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (blobs_1_1 && !blobs_1_1.done && (_a = blobs_1.return)) _a.call(blobs_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.prototype.handleMessage = function (message) {\n    var payload = message.payload;\n    switch (message.type) {\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Answer:\n        this._negotiator.handleSDP(message.type, payload.sdp);\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Candidate:\n        this._negotiator.handleCandidate(payload.candidate);\n        break;\n      default:\n        $1615705ecc6adca3$exports.default.warn(\"Unrecognized message type:\", message.type, \"from peer:\", this.peer);\n        break;\n    }\n  };\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.ID_PREFIX = \"dc_\";\n  $3356170d7bce7f20$export$d365f7ad9d7df9c9.MAX_BUFFERED_AMOUNT = 8388608;\n  return $3356170d7bce7f20$export$d365f7ad9d7df9c9;\n}($0b3b332fd86c5202$exports.BaseConnection);\nvar $9e85b3e1327369e6$exports = {};\n$parcel$export($9e85b3e1327369e6$exports, \"API\", () => $9e85b3e1327369e6$export$2c4e825dc9120f87, v => $9e85b3e1327369e6$export$2c4e825dc9120f87 = v);\nvar $9e85b3e1327369e6$var$__awaiter = undefined && undefined.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar $9e85b3e1327369e6$var$__generator = undefined && undefined.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar $9e85b3e1327369e6$export$2c4e825dc9120f87 = /** @class */function () {\n  function $9e85b3e1327369e6$export$2c4e825dc9120f87(_options) {\n    this._options = _options;\n  }\n  $9e85b3e1327369e6$export$2c4e825dc9120f87.prototype._buildRequest = function (method) {\n    var protocol = this._options.secure ? \"https\" : \"http\";\n    var _a = this._options,\n      host = _a.host,\n      port = _a.port,\n      path = _a.path,\n      key = _a.key;\n    var url = new URL(\"\".concat(protocol, \"://\").concat(host, \":\").concat(port).concat(path).concat(key, \"/\").concat(method));\n    // TODO: Why timestamp, why random?\n    url.searchParams.set(\"ts\", \"\".concat(Date.now()).concat(Math.random()));\n    url.searchParams.set(\"version\", $0d1ed891c5cb27c0$exports.version);\n    return fetch(url.href, {\n      referrerPolicy: this._options.referrerPolicy\n    });\n  };\n  /** Get a unique ID from the server via XHR and initialize with it. */\n  $9e85b3e1327369e6$export$2c4e825dc9120f87.prototype.retrieveId = function () {\n    return $9e85b3e1327369e6$var$__awaiter(this, void 0, Promise, function () {\n      var response, error_1, pathError;\n      return $9e85b3e1327369e6$var$__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, this._buildRequest(\"id\")];\n          case 1:\n            response = _a.sent();\n            if (response.status !== 200) throw new Error(\"Error. Status:\".concat(response.status));\n            return [2 /*return*/, response.text()];\n          case 2:\n            error_1 = _a.sent();\n            $1615705ecc6adca3$exports.default.error(\"Error retrieving ID\", error_1);\n            pathError = \"\";\n            if (this._options.path === \"/\" && this._options.host !== $06cb531ed7840f78$export$7debb50ef11d5e0b.CLOUD_HOST) pathError = \" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer.\";\n            throw new Error(\"Could not get an ID from the server.\" + pathError);\n          case 3:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** @deprecated */\n  $9e85b3e1327369e6$export$2c4e825dc9120f87.prototype.listAllPeers = function () {\n    return $9e85b3e1327369e6$var$__awaiter(this, void 0, Promise, function () {\n      var response, helpfulError, error_2;\n      return $9e85b3e1327369e6$var$__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, this._buildRequest(\"peers\")];\n          case 1:\n            response = _a.sent();\n            if (response.status !== 200) {\n              if (response.status === 401) {\n                helpfulError = \"\";\n                if (this._options.host === $06cb531ed7840f78$export$7debb50ef11d5e0b.CLOUD_HOST) helpfulError = \"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.\";else helpfulError = \"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.\";\n                throw new Error(\"It doesn't look like you have permission to list peers IDs. \" + helpfulError);\n              }\n              throw new Error(\"Error. Status:\".concat(response.status));\n            }\n            return [2 /*return*/, response.json()];\n          case 2:\n            error_2 = _a.sent();\n            $1615705ecc6adca3$exports.default.error(\"Error retrieving list peers\", error_2);\n            throw new Error(\"Could not get list peers from the server.\" + error_2);\n          case 3:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  return $9e85b3e1327369e6$export$2c4e825dc9120f87;\n}();\nvar $26088d7da5b03f69$var$__extends = undefined && undefined.__extends || function () {\n  var extendStatics = function (d1, b1) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d1, b1);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar $26088d7da5b03f69$var$__assign = undefined && undefined.__assign || function () {\n  $26088d7da5b03f69$var$__assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return $26088d7da5b03f69$var$__assign.apply(this, arguments);\n};\nvar $26088d7da5b03f69$var$__values = undefined && undefined.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar $26088d7da5b03f69$var$__read = undefined && undefined.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar $26088d7da5b03f69$var$PeerOptions = /** @class */function () {\n  function PeerOptions() {}\n  return PeerOptions;\n}();\n/**\n * A peer who can initiate connections with other peers.\n */\nvar $26088d7da5b03f69$export$ecd1fc136c422448 = /** @class */function (_super) {\n  $26088d7da5b03f69$var$__extends($26088d7da5b03f69$export$ecd1fc136c422448, _super);\n  function $26088d7da5b03f69$export$ecd1fc136c422448(id1, options) {\n    var _this = _super.call(this) || this;\n    _this._id = null;\n    _this._lastServerId = null;\n    // States.\n    _this._destroyed = false; // Connections have been killed\n    _this._disconnected = false; // Connection to PeerServer killed but P2P connections still active\n    _this._open = false; // Sockets and such are not yet open.\n    _this._connections = new Map(); // All connections for this peer.\n    _this._lostMessages = new Map(); // src => [list of messages]\n    var userId;\n    // Deal with overloading\n    if (id1 && id1.constructor == Object) options = id1;else if (id1) userId = id1.toString();\n    // Configurize options\n    options = $26088d7da5b03f69$var$__assign({\n      debug: 0,\n      host: $06cb531ed7840f78$export$7debb50ef11d5e0b.CLOUD_HOST,\n      port: $06cb531ed7840f78$export$7debb50ef11d5e0b.CLOUD_PORT,\n      path: \"/\",\n      key: $26088d7da5b03f69$export$ecd1fc136c422448.DEFAULT_KEY,\n      token: $06cb531ed7840f78$export$7debb50ef11d5e0b.randomToken(),\n      config: $06cb531ed7840f78$export$7debb50ef11d5e0b.defaultConfig,\n      referrerPolicy: \"strict-origin-when-cross-origin\"\n    }, options);\n    _this._options = options;\n    // Detect relative URL host.\n    if (_this._options.host === \"/\") _this._options.host = window.location.hostname;\n    // Set path correctly.\n    if (_this._options.path) {\n      if (_this._options.path[0] !== \"/\") _this._options.path = \"/\" + _this._options.path;\n      if (_this._options.path[_this._options.path.length - 1] !== \"/\") _this._options.path += \"/\";\n    }\n    // Set whether we use SSL to same as current host\n    if (_this._options.secure === undefined && _this._options.host !== $06cb531ed7840f78$export$7debb50ef11d5e0b.CLOUD_HOST) _this._options.secure = $06cb531ed7840f78$export$7debb50ef11d5e0b.isSecure();else if (_this._options.host == $06cb531ed7840f78$export$7debb50ef11d5e0b.CLOUD_HOST) _this._options.secure = true;\n    // Set a custom log function if present\n    if (_this._options.logFunction) $1615705ecc6adca3$exports.default.setLogFunction(_this._options.logFunction);\n    $1615705ecc6adca3$exports.default.logLevel = _this._options.debug || 0;\n    _this._api = new $9e85b3e1327369e6$exports.API(options);\n    _this._socket = _this._createServerConnection();\n    // Sanity checks\n    // Ensure WebRTC supported\n    if (!$06cb531ed7840f78$export$7debb50ef11d5e0b.supports.audioVideo && !$06cb531ed7840f78$export$7debb50ef11d5e0b.supports.data) {\n      _this._delayedAbort($60fadef21a2daafc$export$9547aaa2e39030ff.BrowserIncompatible, \"The current browser does not support WebRTC\");\n      return _this;\n    }\n    // Ensure alphanumeric id\n    if (!!userId && !$06cb531ed7840f78$export$7debb50ef11d5e0b.validateId(userId)) {\n      _this._delayedAbort($60fadef21a2daafc$export$9547aaa2e39030ff.InvalidID, \"ID \\\"\".concat(userId, \"\\\" is invalid\"));\n      return _this;\n    }\n    if (userId) _this._initialize(userId);else _this._api.retrieveId().then(function (id) {\n      return _this._initialize(id);\n    }).catch(function (error) {\n      return _this._abort($60fadef21a2daafc$export$9547aaa2e39030ff.ServerError, error);\n    });\n    return _this;\n  }\n  Object.defineProperty($26088d7da5b03f69$export$ecd1fc136c422448.prototype, \"id\", {\n    /**\n     * The brokering ID of this peer\n     */\n    get: function () {\n      return this._id;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($26088d7da5b03f69$export$ecd1fc136c422448.prototype, \"options\", {\n    get: function () {\n      return this._options;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($26088d7da5b03f69$export$ecd1fc136c422448.prototype, \"open\", {\n    get: function () {\n      return this._open;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($26088d7da5b03f69$export$ecd1fc136c422448.prototype, \"socket\", {\n    get: function () {\n      return this._socket;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($26088d7da5b03f69$export$ecd1fc136c422448.prototype, \"connections\", {\n    /**\n     * A hash of all connections associated with this peer, keyed by the remote peer's ID.\n     * @deprecated\n     * Return type will change from Object to Map<string,[]>\n     */\n    get: function () {\n      var e_1, _a;\n      var plainConnections = Object.create(null);\n      try {\n        for (var _b = $26088d7da5b03f69$var$__values(this._connections), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var _d = $26088d7da5b03f69$var$__read(_c.value, 2),\n            k = _d[0],\n            v = _d[1];\n          plainConnections[k] = v;\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n      return plainConnections;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($26088d7da5b03f69$export$ecd1fc136c422448.prototype, \"destroyed\", {\n    /**\n     * true if this peer and all of its connections can no longer be used.\n     */\n    get: function () {\n      return this._destroyed;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty($26088d7da5b03f69$export$ecd1fc136c422448.prototype, \"disconnected\", {\n    /**\n     * false if there is an active connection to the PeerServer.\n     */\n    get: function () {\n      return this._disconnected;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._createServerConnection = function () {\n    var _this = this;\n    var socket = new $31d11a8d122cb4b7$exports.Socket(this._options.secure, this._options.host, this._options.port, this._options.path, this._options.key, this._options.pingInterval);\n    socket.on($60fadef21a2daafc$export$3b5c4a4b6354f023.Message, function (data) {\n      _this._handleMessage(data);\n    });\n    socket.on($60fadef21a2daafc$export$3b5c4a4b6354f023.Error, function (error) {\n      _this._abort($60fadef21a2daafc$export$9547aaa2e39030ff.SocketError, error);\n    });\n    socket.on($60fadef21a2daafc$export$3b5c4a4b6354f023.Disconnected, function () {\n      if (_this.disconnected) return;\n      _this.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.Network, \"Lost connection to server.\");\n      _this.disconnect();\n    });\n    socket.on($60fadef21a2daafc$export$3b5c4a4b6354f023.Close, function () {\n      if (_this.disconnected) return;\n      _this._abort($60fadef21a2daafc$export$9547aaa2e39030ff.SocketClosed, \"Underlying socket is already closed.\");\n    });\n    return socket;\n  };\n  /** Initialize a connection with the server. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._initialize = function (id) {\n    this._id = id;\n    this.socket.start(id, this._options.token);\n  };\n  /** Handles messages from the server. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._handleMessage = function (message) {\n    var e_2, _a;\n    var type = message.type;\n    var payload = message.payload;\n    var peerId = message.src;\n    switch (type) {\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Open:\n        this._lastServerId = this.id;\n        this._open = true;\n        this.emit(\"open\", this.id);\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Error:\n        this._abort($60fadef21a2daafc$export$9547aaa2e39030ff.ServerError, payload.msg);\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.IdTaken:\n        this._abort($60fadef21a2daafc$export$9547aaa2e39030ff.UnavailableID, \"ID \\\"\".concat(this.id, \"\\\" is taken\"));\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.InvalidKey:\n        this._abort($60fadef21a2daafc$export$9547aaa2e39030ff.InvalidKey, \"API KEY \\\"\".concat(this._options.key, \"\\\" is invalid\"));\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Leave:\n        $1615705ecc6adca3$exports.default.log(\"Received leave message from \".concat(peerId));\n        this._cleanupPeer(peerId);\n        this._connections.delete(peerId);\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Expire:\n        this.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.PeerUnavailable, \"Could not connect to peer \".concat(peerId));\n        break;\n      case $60fadef21a2daafc$export$adb4a1754da6f10d.Offer:\n        // we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n        var connectionId = payload.connectionId;\n        var connection = this.getConnection(peerId, connectionId);\n        if (connection) {\n          connection.close();\n          $1615705ecc6adca3$exports.default.warn(\"Offer received for existing Connection ID:\".concat(connectionId));\n        }\n        // Create a new connection.\n        if (payload.type === $60fadef21a2daafc$export$3157d57b4135e3bc.Media) {\n          var mediaConnection = new $353dee38f9ab557b$exports.MediaConnection(peerId, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata\n          });\n          connection = mediaConnection;\n          this._addConnection(peerId, connection);\n          this.emit(\"call\", mediaConnection);\n        } else if (payload.type === $60fadef21a2daafc$export$3157d57b4135e3bc.Data) {\n          var dataConnection = new $3356170d7bce7f20$exports.DataConnection(peerId, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata,\n            label: payload.label,\n            serialization: payload.serialization,\n            reliable: payload.reliable\n          });\n          connection = dataConnection;\n          this._addConnection(peerId, connection);\n          this.emit(\"connection\", dataConnection);\n        } else {\n          $1615705ecc6adca3$exports.default.warn(\"Received malformed connection type:\".concat(payload.type));\n          return;\n        }\n        // Find messages.\n        var messages = this._getMessages(connectionId);\n        try {\n          for (var messages_1 = $26088d7da5b03f69$var$__values(messages), messages_1_1 = messages_1.next(); !messages_1_1.done; messages_1_1 = messages_1.next()) {\n            var message_1 = messages_1_1.value;\n            connection.handleMessage(message_1);\n          }\n        } catch (e_2_1) {\n          e_2 = {\n            error: e_2_1\n          };\n        } finally {\n          try {\n            if (messages_1_1 && !messages_1_1.done && (_a = messages_1.return)) _a.call(messages_1);\n          } finally {\n            if (e_2) throw e_2.error;\n          }\n        }\n        break;\n      default:\n        if (!payload) {\n          $1615705ecc6adca3$exports.default.warn(\"You received a malformed message from \".concat(peerId, \" of type \").concat(type));\n          return;\n        }\n        var connectionId = payload.connectionId;\n        var connection = this.getConnection(peerId, connectionId);\n        if (connection && connection.peerConnection)\n          // Pass it on.\n          connection.handleMessage(message);else if (connectionId)\n          // Store for possible later use\n          this._storeMessage(connectionId, message);else $1615705ecc6adca3$exports.default.warn(\"You received an unrecognized message:\", message);\n        break;\n    }\n  };\n  /** Stores messages without a set up connection, to be claimed later. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._storeMessage = function (connectionId, message) {\n    if (!this._lostMessages.has(connectionId)) this._lostMessages.set(connectionId, []);\n    this._lostMessages.get(connectionId).push(message);\n  };\n  /** Retrieve messages from lost message store */ //TODO Change it to private\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._getMessages = function (connectionId) {\n    var messages = this._lostMessages.get(connectionId);\n    if (messages) {\n      this._lostMessages.delete(connectionId);\n      return messages;\n    }\n    return [];\n  };\n  /**\n   * Connects to the remote peer specified by id and returns a data connection.\n   * @param peer The brokering ID of the remote peer (their peer.id).\n   * @param options for specifying details about Peer Connection\n   */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.connect = function (peer, options) {\n    if (options === void 0) options = {};\n    if (this.disconnected) {\n      $1615705ecc6adca3$exports.default.warn(\"You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available.\");\n      this.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.Disconnected, \"Cannot connect to new Peer after disconnecting from server.\");\n      return;\n    }\n    var dataConnection = new $3356170d7bce7f20$exports.DataConnection(peer, this, options);\n    this._addConnection(peer, dataConnection);\n    return dataConnection;\n  };\n  /**\n   * Calls the remote peer specified by id and returns a media connection.\n   * @param peer The brokering ID of the remote peer (their peer.id).\n   * @param stream The caller's media stream\n   * @param options Metadata associated with the connection, passed in by whoever initiated the connection.\n   */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.call = function (peer, stream, options) {\n    if (options === void 0) options = {};\n    if (this.disconnected) {\n      $1615705ecc6adca3$exports.default.warn(\"You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect.\");\n      this.emitError($60fadef21a2daafc$export$9547aaa2e39030ff.Disconnected, \"Cannot connect to new Peer after disconnecting from server.\");\n      return;\n    }\n    if (!stream) {\n      $1615705ecc6adca3$exports.default.error(\"To call a peer, you must provide a stream from your browser's `getUserMedia`.\");\n      return;\n    }\n    var mediaConnection = new $353dee38f9ab557b$exports.MediaConnection(peer, this, $26088d7da5b03f69$var$__assign($26088d7da5b03f69$var$__assign({}, options), {\n      _stream: stream\n    }));\n    this._addConnection(peer, mediaConnection);\n    return mediaConnection;\n  };\n  /** Add a data/media connection to this peer. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._addConnection = function (peerId, connection) {\n    $1615705ecc6adca3$exports.default.log(\"add connection \".concat(connection.type, \":\").concat(connection.connectionId, \" to peerId:\").concat(peerId));\n    if (!this._connections.has(peerId)) this._connections.set(peerId, []);\n    this._connections.get(peerId).push(connection);\n  };\n  //TODO should be private\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._removeConnection = function (connection) {\n    var connections = this._connections.get(connection.peer);\n    if (connections) {\n      var index = connections.indexOf(connection);\n      if (index !== -1) connections.splice(index, 1);\n    }\n    //remove from lost messages\n    this._lostMessages.delete(connection.connectionId);\n  };\n  /** Retrieve a data/media connection for this peer. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.getConnection = function (peerId, connectionId) {\n    var e_3, _a;\n    var connections = this._connections.get(peerId);\n    if (!connections) return null;\n    try {\n      for (var connections_1 = $26088d7da5b03f69$var$__values(connections), connections_1_1 = connections_1.next(); !connections_1_1.done; connections_1_1 = connections_1.next()) {\n        var connection = connections_1_1.value;\n        if (connection.connectionId === connectionId) return connection;\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (connections_1_1 && !connections_1_1.done && (_a = connections_1.return)) _a.call(connections_1);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n    return null;\n  };\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._delayedAbort = function (type, message) {\n    var _this = this;\n    setTimeout(function () {\n      _this._abort(type, message);\n    }, 0);\n  };\n  /**\n   * Emits an error message and destroys the Peer.\n   * The Peer is not destroyed if it's in a disconnected state, in which case\n   * it retains its disconnected state and its existing connections.\n   */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._abort = function (type, message) {\n    $1615705ecc6adca3$exports.default.error(\"Aborting!\");\n    this.emitError(type, message);\n    if (!this._lastServerId) this.destroy();else this.disconnect();\n  };\n  /** Emits a typed error message. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.emitError = function (type, err) {\n    $1615705ecc6adca3$exports.default.error(\"Error:\", err);\n    var error;\n    if (typeof err === \"string\") error = new Error(err);else error = err;\n    error.type = type;\n    this.emit(\"error\", error);\n  };\n  /**\n   * Destroys the Peer: closes all active connections as well as the connection\n   *  to the server.\n   * Warning: The peer can no longer create or accept connections after being\n   *  destroyed.\n   */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.destroy = function () {\n    if (this.destroyed) return;\n    $1615705ecc6adca3$exports.default.log(\"Destroy peer with ID:\".concat(this.id));\n    this.disconnect();\n    this._cleanup();\n    this._destroyed = true;\n    this.emit(\"close\");\n  };\n  /** Disconnects every connection on this peer. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._cleanup = function () {\n    var e_4, _a;\n    try {\n      for (var _b = $26088d7da5b03f69$var$__values(this._connections.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var peerId = _c.value;\n        this._cleanupPeer(peerId);\n        this._connections.delete(peerId);\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n    this.socket.removeAllListeners();\n  };\n  /** Closes all connections to this peer. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype._cleanupPeer = function (peerId) {\n    var e_5, _a;\n    var connections = this._connections.get(peerId);\n    if (!connections) return;\n    try {\n      for (var connections_2 = $26088d7da5b03f69$var$__values(connections), connections_2_1 = connections_2.next(); !connections_2_1.done; connections_2_1 = connections_2.next()) {\n        var connection = connections_2_1.value;\n        connection.close();\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (connections_2_1 && !connections_2_1.done && (_a = connections_2.return)) _a.call(connections_2);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n  };\n  /**\n   * Disconnects the Peer's connection to the PeerServer. Does not close any\n   *  active connections.\n   * Warning: The peer can no longer create or accept connections after being\n   *  disconnected. It also cannot reconnect to the server.\n   */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.disconnect = function () {\n    if (this.disconnected) return;\n    var currentId = this.id;\n    $1615705ecc6adca3$exports.default.log(\"Disconnect peer with ID:\".concat(currentId));\n    this._disconnected = true;\n    this._open = false;\n    this.socket.close();\n    this._lastServerId = currentId;\n    this._id = null;\n    this.emit(\"disconnected\", currentId);\n  };\n  /** Attempts to reconnect with the same ID. */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.reconnect = function () {\n    if (this.disconnected && !this.destroyed) {\n      $1615705ecc6adca3$exports.default.log(\"Attempting reconnection to server with ID \".concat(this._lastServerId));\n      this._disconnected = false;\n      this._initialize(this._lastServerId);\n    } else if (this.destroyed) throw new Error(\"This peer cannot reconnect to the server. It has already been destroyed.\");else if (!this.disconnected && !this.open)\n      // Do nothing. We're still connecting the first time.\n      $1615705ecc6adca3$exports.default.error(\"In a hurry? We're still trying to make the initial connection!\");else throw new Error(\"Peer \".concat(this.id, \" cannot reconnect because it is not disconnected from the server!\"));\n  };\n  /**\n   * Get a list of available peer IDs. If you're running your own server, you'll\n   * want to set allow_discovery: true in the PeerServer options. If you're using\n   * the cloud server, email team@peerjs.com to get the functionality enabled for\n   * your key.\n   */\n  $26088d7da5b03f69$export$ecd1fc136c422448.prototype.listAllPeers = function (cb) {\n    var _this = this;\n    if (cb === void 0) cb = function (_) {};\n    this._api.listAllPeers().then(function (peers) {\n      return cb(peers);\n    }).catch(function (error) {\n      return _this._abort($60fadef21a2daafc$export$9547aaa2e39030ff.ServerError, error);\n    });\n  };\n  $26088d7da5b03f69$export$ecd1fc136c422448.DEFAULT_KEY = \"peerjs\";\n  return $26088d7da5b03f69$export$ecd1fc136c422448;\n}($ac9b757d51178e15$exports.EventEmitter);\nvar $70d766613f57b014$export$2e2bcd8739ae039 = $26088d7da5b03f69$exports.Peer;\nexport { $70d766613f57b014$export$2e2bcd8739ae039 as default, $26088d7da5b03f69$export$ecd1fc136c422448 as Peer, $06cb531ed7840f78$export$7debb50ef11d5e0b as util };","map":{"version":3,"names":["$af8cf1f663f490f4$var$webRTCAdapter","$kKvpS$webrtcadapter","default","$af8cf1f663f490f4$export$25be9502477c137d","class_1","isIOS","includes","navigator","platform","supportedBrowsers","minFirefoxVersion","minChromeVersion","minSafariVersion","prototype","isWebRTCSupported","RTCPeerConnection","isBrowserSupported","browser","getBrowser","version","getVersion","validBrowser","browserDetails","isUnifiedPlanSupported","window","RTCRtpTransceiver","tempPc","supported","addTransceiver","e","close","toString","concat","$06cb531ed7840f78$var$DEFAULT_CONFIG","iceServers","urls","username","credential","sdpSemantics","$06cb531ed7840f78$var$Util","Util","CLOUD_HOST","CLOUD_PORT","chunkedBrowsers","Chrome","chrome","chunkedMTU","defaultConfig","browserVersion","supports","webRTC","audioVideo","data","binaryBlob","reliable","pc","dc","createDataChannel","ordered","binaryType","pack","$kKvpS$peerjsjsbinarypack","unpack","_dataCount","noop","validateId","id","test","chunk","blob","chunks","size","total","Math","ceil","$06cb531ed7840f78$export$7debb50ef11d5e0b","index","start","end","min","b","slice","__peerData","n","push","blobToArrayBuffer","cb","fr","FileReader","onload","evt","target","result","readAsArrayBuffer","binaryStringToArrayBuffer","binary","byteArray","Uint8Array","length","i","charCodeAt","buffer","randomToken","random","isSecure","location","protocol","$ac9b757d51178e15$var$has","Object","hasOwnProperty","$ac9b757d51178e15$var$prefix","$ac9b757d51178e15$var$Events","create","__proto__","$ac9b757d51178e15$var$EE","fn","context","once","$ac9b757d51178e15$var$addListener","emitter","event","TypeError","listener","_events","_eventsCount","$ac9b757d51178e15$var$clearEvent","$ac9b757d51178e15$var$EventEmitter","eventNames","names","events","name","call","getOwnPropertySymbols","listeners","handlers","l","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","len","arguments","args","removeListener","undefined","apply","j","on","removeAllListeners","off","addListener","prefixed","EventEmitter","$ac9b757d51178e15$exports","$1615705ecc6adca3$var$LOG_PREFIX","$1615705ecc6adca3$export$243e62d78d3b544d","$1615705ecc6adca3$var$Logger","Logger","_logLevel","Disabled","defineProperty","get","set","logLevel","log","_i","All","_print","$1615705ecc6adca3$var$__spreadArray","$1615705ecc6adca3$var$__read","warn","Warnings","error","Errors","setLogFunction","rest","copy","Error","message","console","$1615705ecc6adca3$export$2e2bcd8739ae039","$60fadef21a2daafc$export$3157d57b4135e3bc","$60fadef21a2daafc$export$9547aaa2e39030ff","$60fadef21a2daafc$export$89f507cf986a947","$60fadef21a2daafc$export$3b5c4a4b6354f023","$60fadef21a2daafc$export$adb4a1754da6f10d","$0d1ed891c5cb27c0$exports","JSON","parse","$31d11a8d122cb4b7$export$4798917dbf149b79","_super","$31d11a8d122cb4b7$var$__extends","secure","host","port","path","key","pingInterval","_this","_disconnected","_messagesQueue","wsProtocol","_baseUrl","token","_id","wsUrl","_socket","WebSocket","onmessage","$1615705ecc6adca3$exports","Message","onclose","_cleanup","Disconnected","onopen","_sendQueuedMessages","_scheduleHeartbeat","_wsPingTimer","setTimeout","_sendHeartbeat","_wsOpen","stringify","type","Heartbeat","send","readyState","copiedQueue","$31d11a8d122cb4b7$var$__spreadArray","$31d11a8d122cb4b7$var$__read","copiedQueue_1","$31d11a8d122cb4b7$var$__values","copiedQueue_1_1","next","done","value","clearTimeout","$77f14d3e81888156$export$89e6bb5ad64bf4a","connection","startConnection","options","peerConnection","_startPeerConnection","Media","_stream","_addTracksToConnection","originator","Data","dataConnection","config","dataChannel","label","initialize","_makeOffer","handleSDP","sdp","provider","_setupListeners","peerId","peer","connectionId","connectionType","onicecandidate","candidate","socket","Candidate","payload","dst","oniceconnectionstatechange","iceConnectionState","ondatachannel","channel","getConnection","ontrack","stream","streams","mediaConnection","_addStreamToMediaConnection","cleanup","peerConnectionNotClosed","signalingState","dataChannelNotClosed","$77f14d3e81888156$var$__awaiter","Promise","createOffer","constraints","offer","_a","sent","sdpTransform","setLocalDescription","metadata","$77f14d3e81888156$var$__assign","serialization","Offer","err_2","emitError","WebRTC","err_1_1","_makeAnswer","createAnswer","answer","Answer","err_3","err_1_2","RTCSessionDescription","self","setRemoteDescription","err_4","handleCandidate","ice","sdpMLineIndex","sdpMid","addIceCandidate","RTCIceCandidate","err_5","addTrack","getTracks","forEach","track","addStream","$0b3b332fd86c5202$export$23a2a68283c24d80","$0b3b332fd86c5202$var$__extends","_open","$353dee38f9ab557b$export$4a84e95a2324ac29","$353dee38f9ab557b$var$__extends","_localStream","ID_PREFIX","_negotiator","$77f14d3e81888156$exports","Negotiator","_remoteStream","remoteStream","handleMessage","$353dee38f9ab557b$var$__assign","_payload","messages","_getMessages","messages_1","$353dee38f9ab557b$var$__values","messages_1_1","_removeConnection","open","$0b3b332fd86c5202$exports","BaseConnection","$3014d862dcc9946b$export$c6913ae0ed687038","$3014d862dcc9946b$var$__extends","fileReader","_queue","_processing","doNextTask","onerror","destroy","queue","enque","processing","abort","shift","$3356170d7bce7f20$export$d365f7ad9d7df9c9","$3356170d7bce7f20$var$__extends","_buffer","_bufferSize","_buffering","_chunkedData","_encodingQueue","$3014d862dcc9946b$exports","EncodingQueue","Binary","ab","_bufferedSend","_dc","_configureDataChannel","_handleDataMessage","datatype","constructor","isBinarySerialization","BinaryUTF8","deserializedData","Blob","unpackedData","ArrayBuffer","String","ab1","_handleChunk","chunkInfo","count","data_1","chunked","_sendChunks","msg","_trySend","bufferedAmount","MAX_BUFFERED_AMOUNT","_tryBuffer","blobs","blobs_1","$3356170d7bce7f20$var$__values","blobs_1_1","blob_1","$9e85b3e1327369e6$export$2c4e825dc9120f87","_options","_buildRequest","method","url","URL","searchParams","Date","now","fetch","href","referrerPolicy","retrieveId","$9e85b3e1327369e6$var$__awaiter","response","status","text","error_1","pathError","listAllPeers","helpfulError","json","error_2","$26088d7da5b03f69$var$PeerOptions","PeerOptions","$26088d7da5b03f69$export$ecd1fc136c422448","$26088d7da5b03f69$var$__extends","id1","_lastServerId","_destroyed","_connections","Map","_lostMessages","userId","$26088d7da5b03f69$var$__assign","debug","DEFAULT_KEY","hostname","logFunction","_api","$9e85b3e1327369e6$exports","API","_createServerConnection","_delayedAbort","BrowserIncompatible","InvalidID","_initialize","then","catch","_abort","ServerError","plainConnections","_b","$26088d7da5b03f69$var$__values","_c","_d","$26088d7da5b03f69$var$__read","k","v","$31d11a8d122cb4b7$exports","Socket","_handleMessage","SocketError","disconnected","Network","disconnect","Close","SocketClosed","src","Open","IdTaken","UnavailableID","InvalidKey","Leave","_cleanupPeer","delete","Expire","PeerUnavailable","$353dee38f9ab557b$exports","MediaConnection","_addConnection","$3356170d7bce7f20$exports","DataConnection","message_1","_storeMessage","has","connect","connections","indexOf","splice","connections_1","connections_1_1","err","destroyed","keys","connections_2","connections_2_1","currentId","reconnect","_","peers","$70d766613f57b014$export$2e2bcd8739ae039","$26088d7da5b03f69$exports","Peer"],"sources":["lib/exports.ts","lib/util.ts","lib/supports.ts","lib/peer.ts","node_modules/eventemitter3/index.js","lib/logger.ts","lib/socket.ts","lib/enums.ts","package.json","lib/mediaconnection.ts","lib/negotiator.ts","lib/baseconnection.ts","lib/dataconnection.ts","lib/encodingQueue.ts","lib/api.ts"],"sourcesContent":["import { util } from \"./util\";\nimport { Peer } from \"./peer\";\n\nexport type {\n\tPeerJSOption,\n\tPeerConnectOption,\n\tAnswerOption,\n\tCallOption,\n} from \"./optionInterfaces\";\nexport type { UtilSupportsObj } from \"./util\";\nexport type { DataConnection } from \"./dataconnection\";\nexport type { MediaConnection } from \"./mediaconnection\";\nexport type { LogLevel } from \"./logger\";\nexport type {\n\tConnectionType,\n\tPeerErrorType,\n\tSerializationType,\n\tSocketEventType,\n\tServerMessageType,\n} from \"./enums\";\n\nexport { Peer, util };\nexport default Peer;\n","// Types aren’t accurate\n//@ts-ignore\nimport BinaryPack from \"peerjs-js-binarypack\";\nimport { Supports } from \"./supports\";\n\nexport interface UtilSupportsObj {\n\tbrowser: boolean;\n\twebRTC: boolean;\n\taudioVideo: boolean;\n\tdata: boolean;\n\tbinaryBlob: boolean;\n\treliable: boolean;\n}\n\nconst DEFAULT_CONFIG = {\n\ticeServers: [\n\t\t{ urls: \"stun:stun.l.google.com:19302\" },\n\t\t{\n\t\t\turls: [\n\t\t\t\t\"turn:eu-0.turn.peerjs.com:3478\",\n\t\t\t\t\"turn:us-0.turn.peerjs.com:3478\",\n\t\t\t],\n\t\t\tusername: \"peerjs\",\n\t\t\tcredential: \"peerjsp\",\n\t\t},\n\t],\n\tsdpSemantics: \"unified-plan\",\n};\n\nclass Util {\n\tnoop(): void {}\n\n\treadonly CLOUD_HOST = \"0.peerjs.com\";\n\treadonly CLOUD_PORT = 443;\n\n\t// Browsers that need chunking:\n\treadonly chunkedBrowsers = { Chrome: 1, chrome: 1 };\n\treadonly chunkedMTU = 16300; // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n\t// Returns browser-agnostic default config\n\treadonly defaultConfig = DEFAULT_CONFIG;\n\n\treadonly browser = Supports.getBrowser();\n\treadonly browserVersion = Supports.getVersion();\n\n\t// Lists which features are supported\n\treadonly supports = (function () {\n\t\tconst supported: UtilSupportsObj = {\n\t\t\tbrowser: Supports.isBrowserSupported(),\n\t\t\twebRTC: Supports.isWebRTCSupported(),\n\t\t\taudioVideo: false,\n\t\t\tdata: false,\n\t\t\tbinaryBlob: false,\n\t\t\treliable: false,\n\t\t};\n\n\t\tif (!supported.webRTC) return supported;\n\n\t\tlet pc: RTCPeerConnection;\n\n\t\ttry {\n\t\t\tpc = new RTCPeerConnection(DEFAULT_CONFIG);\n\n\t\t\tsupported.audioVideo = true;\n\n\t\t\tlet dc: RTCDataChannel;\n\n\t\t\ttry {\n\t\t\t\tdc = pc.createDataChannel(\"_PEERJSTEST\", { ordered: true });\n\t\t\t\tsupported.data = true;\n\t\t\t\tsupported.reliable = !!dc.ordered;\n\n\t\t\t\t// Binary test\n\t\t\t\ttry {\n\t\t\t\t\tdc.binaryType = \"blob\";\n\t\t\t\t\tsupported.binaryBlob = !Supports.isIOS;\n\t\t\t\t} catch (e) {}\n\t\t\t} catch (e) {\n\t\t\t} finally {\n\t\t\t\tif (dc) {\n\t\t\t\t\tdc.close();\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t} finally {\n\t\t\tif (pc) {\n\t\t\t\tpc.close();\n\t\t\t}\n\t\t}\n\n\t\treturn supported;\n\t})();\n\n\t// Ensure alphanumeric ids\n\tvalidateId(id: string): boolean {\n\t\t// Allow empty ids\n\t\treturn !id || /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id);\n\t}\n\n\tpack = BinaryPack.pack;\n\tunpack = BinaryPack.unpack;\n\n\t// Binary stuff\n\n\tprivate _dataCount: number = 1;\n\n\tchunk(\n\t\tblob: Blob,\n\t): { __peerData: number; n: number; total: number; data: Blob }[] {\n\t\tconst chunks = [];\n\t\tconst size = blob.size;\n\t\tconst total = Math.ceil(size / util.chunkedMTU);\n\n\t\tlet index = 0;\n\t\tlet start = 0;\n\n\t\twhile (start < size) {\n\t\t\tconst end = Math.min(size, start + util.chunkedMTU);\n\t\t\tconst b = blob.slice(start, end);\n\n\t\t\tconst chunk = {\n\t\t\t\t__peerData: this._dataCount,\n\t\t\t\tn: index,\n\t\t\t\tdata: b,\n\t\t\t\ttotal,\n\t\t\t};\n\n\t\t\tchunks.push(chunk);\n\n\t\t\tstart = end;\n\t\t\tindex++;\n\t\t}\n\n\t\tthis._dataCount++;\n\n\t\treturn chunks;\n\t}\n\n\tblobToArrayBuffer(\n\t\tblob: Blob,\n\t\tcb: (arg: ArrayBuffer | null) => void,\n\t): FileReader {\n\t\tconst fr = new FileReader();\n\n\t\tfr.onload = function (evt) {\n\t\t\tif (evt.target) {\n\t\t\t\tcb(evt.target.result as ArrayBuffer);\n\t\t\t}\n\t\t};\n\n\t\tfr.readAsArrayBuffer(blob);\n\n\t\treturn fr;\n\t}\n\n\tbinaryStringToArrayBuffer(binary: string): ArrayBuffer | SharedArrayBuffer {\n\t\tconst byteArray = new Uint8Array(binary.length);\n\n\t\tfor (let i = 0; i < binary.length; i++) {\n\t\t\tbyteArray[i] = binary.charCodeAt(i) & 0xff;\n\t\t}\n\n\t\treturn byteArray.buffer;\n\t}\n\n\trandomToken(): string {\n\t\treturn Math.random().toString(36).slice(2);\n\t}\n\n\tisSecure(): boolean {\n\t\treturn location.protocol === \"https:\";\n\t}\n}\nexport const util = new Util();\n","import webRTCAdapter_import from \"webrtc-adapter\";\n\nconst webRTCAdapter: typeof webRTCAdapter_import =\n\t//@ts-ignore\n\twebRTCAdapter_import.default || webRTCAdapter_import;\n\nexport const Supports = new (class {\n\treadonly isIOS = [\"iPad\", \"iPhone\", \"iPod\"].includes(navigator.platform);\n\treadonly supportedBrowsers = [\"firefox\", \"chrome\", \"safari\"];\n\n\treadonly minFirefoxVersion = 59;\n\treadonly minChromeVersion = 72;\n\treadonly minSafariVersion = 605;\n\n\tisWebRTCSupported(): boolean {\n\t\treturn typeof RTCPeerConnection !== \"undefined\";\n\t}\n\n\tisBrowserSupported(): boolean {\n\t\tconst browser = this.getBrowser();\n\t\tconst version = this.getVersion();\n\n\t\tconst validBrowser = this.supportedBrowsers.includes(browser);\n\n\t\tif (!validBrowser) return false;\n\n\t\tif (browser === \"chrome\") return version >= this.minChromeVersion;\n\t\tif (browser === \"firefox\") return version >= this.minFirefoxVersion;\n\t\tif (browser === \"safari\")\n\t\t\treturn !this.isIOS && version >= this.minSafariVersion;\n\n\t\treturn false;\n\t}\n\n\tgetBrowser(): string {\n\t\treturn webRTCAdapter.browserDetails.browser;\n\t}\n\n\tgetVersion(): number {\n\t\treturn webRTCAdapter.browserDetails.version || 0;\n\t}\n\n\tisUnifiedPlanSupported(): boolean {\n\t\tconst browser = this.getBrowser();\n\t\tconst version = webRTCAdapter.browserDetails.version || 0;\n\n\t\tif (browser === \"chrome\" && version < this.minChromeVersion) return false;\n\t\tif (browser === \"firefox\" && version >= this.minFirefoxVersion) return true;\n\t\tif (\n\t\t\t!window.RTCRtpTransceiver ||\n\t\t\t!(\"currentDirection\" in RTCRtpTransceiver.prototype)\n\t\t)\n\t\t\treturn false;\n\n\t\tlet tempPc: RTCPeerConnection;\n\t\tlet supported = false;\n\n\t\ttry {\n\t\t\ttempPc = new RTCPeerConnection();\n\t\t\ttempPc.addTransceiver(\"audio\");\n\t\t\tsupported = true;\n\t\t} catch (e) {\n\t\t} finally {\n\t\t\tif (tempPc) {\n\t\t\t\ttempPc.close();\n\t\t\t}\n\t\t}\n\n\t\treturn supported;\n\t}\n\n\ttoString(): string {\n\t\treturn `Supports:\n    browser:${this.getBrowser()}\n    version:${this.getVersion()}\n    isIOS:${this.isIOS}\n    isWebRTCSupported:${this.isWebRTCSupported()}\n    isBrowserSupported:${this.isBrowserSupported()}\n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`;\n\t}\n})();\n","import { EventEmitter } from \"eventemitter3\";\nimport { util } from \"./util\";\nimport logger, { LogLevel } from \"./logger\";\nimport { Socket } from \"./socket\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport { DataConnection } from \"./dataconnection\";\nimport {\n\tConnectionType,\n\tPeerErrorType,\n\tSocketEventType,\n\tServerMessageType,\n} from \"./enums\";\nimport { ServerMessage } from \"./servermessage\";\nimport { API } from \"./api\";\nimport type {\n\tPeerConnectOption,\n\tPeerJSOption,\n\tCallOption,\n} from \"./optionInterfaces\";\n\nclass PeerOptions implements PeerJSOption {\n\tdebug?: LogLevel; // 1: Errors, 2: Warnings, 3: All logs\n\thost?: string;\n\tport?: number;\n\tpath?: string;\n\tkey?: string;\n\ttoken?: string;\n\tconfig?: any;\n\tsecure?: boolean;\n\tpingInterval?: number;\n\treferrerPolicy?: ReferrerPolicy;\n\tlogFunction?: (logLevel: LogLevel, ...rest: any[]) => void;\n}\n\ntype PeerEvents = {\n\t/**\n\t * Emitted when a connection to the PeerServer is established.\n\t */\n\topen: (id: string) => void;\n\t/**\n\t * Emitted when a new data connection is established from a remote peer.\n\t */\n\tconnection: (dataConnection: DataConnection) => void;\n\t/**\n\t * Emitted when a remote peer attempts to call you.\n\t */\n\tcall: (mediaConnection: MediaConnection) => void;\n\t/**\n\t * Emitted when the peer is destroyed and can no longer accept or create any new connections.\n\t */\n\tclose: () => void;\n\t/**\n\t * Emitted when the peer is disconnected from the signalling server\n\t */\n\tdisconnected: (currentId: string) => void;\n\t/**\n\t * Errors on the peer are almost always fatal and will destroy the peer.\n\t */\n\terror: (error: Error) => void;\n};\n/**\n * A peer who can initiate connections with other peers.\n */\nexport class Peer extends EventEmitter<PeerEvents> {\n\tprivate static readonly DEFAULT_KEY = \"peerjs\";\n\n\tprivate readonly _options: PeerOptions;\n\tprivate readonly _api: API;\n\tprivate readonly _socket: Socket;\n\n\tprivate _id: string | null = null;\n\tprivate _lastServerId: string | null = null;\n\n\t// States.\n\tprivate _destroyed = false; // Connections have been killed\n\tprivate _disconnected = false; // Connection to PeerServer killed but P2P connections still active\n\tprivate _open = false; // Sockets and such are not yet open.\n\tprivate readonly _connections: Map<\n\t\tstring,\n\t\t(DataConnection | MediaConnection)[]\n\t> = new Map(); // All connections for this peer.\n\tprivate readonly _lostMessages: Map<string, ServerMessage[]> = new Map(); // src => [list of messages]\n\t/**\n\t * The brokering ID of this peer\n\t */\n\tget id() {\n\t\treturn this._id;\n\t}\n\n\tget options() {\n\t\treturn this._options;\n\t}\n\n\tget open() {\n\t\treturn this._open;\n\t}\n\n\tget socket() {\n\t\treturn this._socket;\n\t}\n\n\t/**\n\t * A hash of all connections associated with this peer, keyed by the remote peer's ID.\n\t * @deprecated\n\t * Return type will change from Object to Map<string,[]>\n\t */\n\tget connections(): Object {\n\t\tconst plainConnections = Object.create(null);\n\n\t\tfor (let [k, v] of this._connections) {\n\t\t\tplainConnections[k] = v;\n\t\t}\n\n\t\treturn plainConnections;\n\t}\n\n\t/**\n\t * true if this peer and all of its connections can no longer be used.\n\t */\n\tget destroyed() {\n\t\treturn this._destroyed;\n\t}\n\t/**\n\t * false if there is an active connection to the PeerServer.\n\t */\n\tget disconnected() {\n\t\treturn this._disconnected;\n\t}\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t */\n\tconstructor();\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t * @param options for specifying details about PeerServer\n\t */\n\tconstructor(options: PeerOptions);\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t * @param id Other peers can connect to this peer using the provided ID.\n\t *     If no ID is given, one will be generated by the brokering server.\n\t * @param options for specifying details about PeerServer\n\t */\n\tconstructor(id: string, options?: PeerOptions);\n\n\tconstructor(id?: string | PeerOptions, options?: PeerOptions) {\n\t\tsuper();\n\n\t\tlet userId: string | undefined;\n\n\t\t// Deal with overloading\n\t\tif (id && id.constructor == Object) {\n\t\t\toptions = id as PeerOptions;\n\t\t} else if (id) {\n\t\t\tuserId = id.toString();\n\t\t}\n\n\t\t// Configurize options\n\t\toptions = {\n\t\t\tdebug: 0, // 1: Errors, 2: Warnings, 3: All logs\n\t\t\thost: util.CLOUD_HOST,\n\t\t\tport: util.CLOUD_PORT,\n\t\t\tpath: \"/\",\n\t\t\tkey: Peer.DEFAULT_KEY,\n\t\t\ttoken: util.randomToken(),\n\t\t\tconfig: util.defaultConfig,\n\t\t\treferrerPolicy: \"strict-origin-when-cross-origin\",\n\t\t\t...options,\n\t\t};\n\t\tthis._options = options;\n\n\t\t// Detect relative URL host.\n\t\tif (this._options.host === \"/\") {\n\t\t\tthis._options.host = window.location.hostname;\n\t\t}\n\n\t\t// Set path correctly.\n\t\tif (this._options.path) {\n\t\t\tif (this._options.path[0] !== \"/\") {\n\t\t\t\tthis._options.path = \"/\" + this._options.path;\n\t\t\t}\n\t\t\tif (this._options.path[this._options.path.length - 1] !== \"/\") {\n\t\t\t\tthis._options.path += \"/\";\n\t\t\t}\n\t\t}\n\n\t\t// Set whether we use SSL to same as current host\n\t\tif (\n\t\t\tthis._options.secure === undefined &&\n\t\t\tthis._options.host !== util.CLOUD_HOST\n\t\t) {\n\t\t\tthis._options.secure = util.isSecure();\n\t\t} else if (this._options.host == util.CLOUD_HOST) {\n\t\t\tthis._options.secure = true;\n\t\t}\n\t\t// Set a custom log function if present\n\t\tif (this._options.logFunction) {\n\t\t\tlogger.setLogFunction(this._options.logFunction);\n\t\t}\n\n\t\tlogger.logLevel = this._options.debug || 0;\n\n\t\tthis._api = new API(options);\n\t\tthis._socket = this._createServerConnection();\n\n\t\t// Sanity checks\n\t\t// Ensure WebRTC supported\n\t\tif (!util.supports.audioVideo && !util.supports.data) {\n\t\t\tthis._delayedAbort(\n\t\t\t\tPeerErrorType.BrowserIncompatible,\n\t\t\t\t\"The current browser does not support WebRTC\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// Ensure alphanumeric id\n\t\tif (!!userId && !util.validateId(userId)) {\n\t\t\tthis._delayedAbort(PeerErrorType.InvalidID, `ID \"${userId}\" is invalid`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId) {\n\t\t\tthis._initialize(userId);\n\t\t} else {\n\t\t\tthis._api\n\t\t\t\t.retrieveId()\n\t\t\t\t.then((id) => this._initialize(id))\n\t\t\t\t.catch((error) => this._abort(PeerErrorType.ServerError, error));\n\t\t}\n\t}\n\n\tprivate _createServerConnection(): Socket {\n\t\tconst socket = new Socket(\n\t\t\tthis._options.secure,\n\t\t\tthis._options.host!,\n\t\t\tthis._options.port!,\n\t\t\tthis._options.path!,\n\t\t\tthis._options.key!,\n\t\t\tthis._options.pingInterval,\n\t\t);\n\n\t\tsocket.on(SocketEventType.Message, (data: ServerMessage) => {\n\t\t\tthis._handleMessage(data);\n\t\t});\n\n\t\tsocket.on(SocketEventType.Error, (error: string) => {\n\t\t\tthis._abort(PeerErrorType.SocketError, error);\n\t\t});\n\n\t\tsocket.on(SocketEventType.Disconnected, () => {\n\t\t\tif (this.disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emitError(PeerErrorType.Network, \"Lost connection to server.\");\n\t\t\tthis.disconnect();\n\t\t});\n\n\t\tsocket.on(SocketEventType.Close, () => {\n\t\t\tif (this.disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._abort(\n\t\t\t\tPeerErrorType.SocketClosed,\n\t\t\t\t\"Underlying socket is already closed.\",\n\t\t\t);\n\t\t});\n\n\t\treturn socket;\n\t}\n\n\t/** Initialize a connection with the server. */\n\tprivate _initialize(id: string): void {\n\t\tthis._id = id;\n\t\tthis.socket.start(id, this._options.token!);\n\t}\n\n\t/** Handles messages from the server. */\n\tprivate _handleMessage(message: ServerMessage): void {\n\t\tconst type = message.type;\n\t\tconst payload = message.payload;\n\t\tconst peerId = message.src;\n\n\t\tswitch (type) {\n\t\t\tcase ServerMessageType.Open: // The connection to the server is open.\n\t\t\t\tthis._lastServerId = this.id;\n\t\t\t\tthis._open = true;\n\t\t\t\tthis.emit(\"open\", this.id);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Error: // Server error.\n\t\t\t\tthis._abort(PeerErrorType.ServerError, payload.msg);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.IdTaken: // The selected ID is taken.\n\t\t\t\tthis._abort(PeerErrorType.UnavailableID, `ID \"${this.id}\" is taken`);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.InvalidKey: // The given API key cannot be found.\n\t\t\t\tthis._abort(\n\t\t\t\t\tPeerErrorType.InvalidKey,\n\t\t\t\t\t`API KEY \"${this._options.key}\" is invalid`,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Leave: // Another peer has closed its connection to this peer.\n\t\t\t\tlogger.log(`Received leave message from ${peerId}`);\n\t\t\t\tthis._cleanupPeer(peerId);\n\t\t\t\tthis._connections.delete(peerId);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Expire: // The offer sent to a peer has expired without response.\n\t\t\t\tthis.emitError(\n\t\t\t\t\tPeerErrorType.PeerUnavailable,\n\t\t\t\t\t`Could not connect to peer ${peerId}`,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Offer: {\n\t\t\t\t// we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n\t\t\t\tconst connectionId = payload.connectionId;\n\t\t\t\tlet connection = this.getConnection(peerId, connectionId);\n\n\t\t\t\tif (connection) {\n\t\t\t\t\tconnection.close();\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t`Offer received for existing Connection ID:${connectionId}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Create a new connection.\n\t\t\t\tif (payload.type === ConnectionType.Media) {\n\t\t\t\t\tconst mediaConnection = new MediaConnection(peerId, this, {\n\t\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t\t\t_payload: payload,\n\t\t\t\t\t\tmetadata: payload.metadata,\n\t\t\t\t\t});\n\t\t\t\t\tconnection = mediaConnection;\n\t\t\t\t\tthis._addConnection(peerId, connection);\n\t\t\t\t\tthis.emit(\"call\", mediaConnection);\n\t\t\t\t} else if (payload.type === ConnectionType.Data) {\n\t\t\t\t\tconst dataConnection = new DataConnection(peerId, this, {\n\t\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t\t\t_payload: payload,\n\t\t\t\t\t\tmetadata: payload.metadata,\n\t\t\t\t\t\tlabel: payload.label,\n\t\t\t\t\t\tserialization: payload.serialization,\n\t\t\t\t\t\treliable: payload.reliable,\n\t\t\t\t\t});\n\t\t\t\t\tconnection = dataConnection;\n\t\t\t\t\tthis._addConnection(peerId, connection);\n\t\t\t\t\tthis.emit(\"connection\", dataConnection);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn(`Received malformed connection type:${payload.type}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Find messages.\n\t\t\t\tconst messages = this._getMessages(connectionId);\n\t\t\t\tfor (let message of messages) {\n\t\t\t\t\tconnection.handleMessage(message);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tif (!payload) {\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t`You received a malformed message from ${peerId} of type ${type}`,\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst connectionId = payload.connectionId;\n\t\t\t\tconst connection = this.getConnection(peerId, connectionId);\n\n\t\t\t\tif (connection && connection.peerConnection) {\n\t\t\t\t\t// Pass it on.\n\t\t\t\t\tconnection.handleMessage(message);\n\t\t\t\t} else if (connectionId) {\n\t\t\t\t\t// Store for possible later use\n\t\t\t\t\tthis._storeMessage(connectionId, message);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn(\"You received an unrecognized message:\", message);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/** Stores messages without a set up connection, to be claimed later. */\n\tprivate _storeMessage(connectionId: string, message: ServerMessage): void {\n\t\tif (!this._lostMessages.has(connectionId)) {\n\t\t\tthis._lostMessages.set(connectionId, []);\n\t\t}\n\n\t\tthis._lostMessages.get(connectionId).push(message);\n\t}\n\n\t/** Retrieve messages from lost message store */\n\t//TODO Change it to private\n\tpublic _getMessages(connectionId: string): ServerMessage[] {\n\t\tconst messages = this._lostMessages.get(connectionId);\n\n\t\tif (messages) {\n\t\t\tthis._lostMessages.delete(connectionId);\n\t\t\treturn messages;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t/**\n\t * Connects to the remote peer specified by id and returns a data connection.\n\t * @param peer The brokering ID of the remote peer (their peer.id).\n\t * @param options for specifying details about Peer Connection\n\t */\n\tconnect(peer: string, options: PeerConnectOption = {}): DataConnection {\n\t\tif (this.disconnected) {\n\t\t\tlogger.warn(\n\t\t\t\t\"You cannot connect to a new Peer because you called \" +\n\t\t\t\t\t\".disconnect() on this Peer and ended your connection with the \" +\n\t\t\t\t\t\"server. You can create a new Peer to reconnect, or call reconnect \" +\n\t\t\t\t\t\"on this peer if you believe its ID to still be available.\",\n\t\t\t);\n\t\t\tthis.emitError(\n\t\t\t\tPeerErrorType.Disconnected,\n\t\t\t\t\"Cannot connect to new Peer after disconnecting from server.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataConnection = new DataConnection(peer, this, options);\n\t\tthis._addConnection(peer, dataConnection);\n\t\treturn dataConnection;\n\t}\n\n\t/**\n\t * Calls the remote peer specified by id and returns a media connection.\n\t * @param peer The brokering ID of the remote peer (their peer.id).\n\t * @param stream The caller's media stream\n\t * @param options Metadata associated with the connection, passed in by whoever initiated the connection.\n\t */\n\tcall(\n\t\tpeer: string,\n\t\tstream: MediaStream,\n\t\toptions: CallOption = {},\n\t): MediaConnection {\n\t\tif (this.disconnected) {\n\t\t\tlogger.warn(\n\t\t\t\t\"You cannot connect to a new Peer because you called \" +\n\t\t\t\t\t\".disconnect() on this Peer and ended your connection with the \" +\n\t\t\t\t\t\"server. You can create a new Peer to reconnect.\",\n\t\t\t);\n\t\t\tthis.emitError(\n\t\t\t\tPeerErrorType.Disconnected,\n\t\t\t\t\"Cannot connect to new Peer after disconnecting from server.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!stream) {\n\t\t\tlogger.error(\n\t\t\t\t\"To call a peer, you must provide a stream from your browser's `getUserMedia`.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst mediaConnection = new MediaConnection(peer, this, {\n\t\t\t...options,\n\t\t\t_stream: stream,\n\t\t});\n\t\tthis._addConnection(peer, mediaConnection);\n\t\treturn mediaConnection;\n\t}\n\n\t/** Add a data/media connection to this peer. */\n\tprivate _addConnection(\n\t\tpeerId: string,\n\t\tconnection: MediaConnection | DataConnection,\n\t): void {\n\t\tlogger.log(\n\t\t\t`add connection ${connection.type}:${connection.connectionId} to peerId:${peerId}`,\n\t\t);\n\n\t\tif (!this._connections.has(peerId)) {\n\t\t\tthis._connections.set(peerId, []);\n\t\t}\n\t\tthis._connections.get(peerId).push(connection);\n\t}\n\n\t//TODO should be private\n\t_removeConnection(connection: DataConnection | MediaConnection): void {\n\t\tconst connections = this._connections.get(connection.peer);\n\n\t\tif (connections) {\n\t\t\tconst index = connections.indexOf(connection);\n\n\t\t\tif (index !== -1) {\n\t\t\t\tconnections.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\t//remove from lost messages\n\t\tthis._lostMessages.delete(connection.connectionId);\n\t}\n\n\t/** Retrieve a data/media connection for this peer. */\n\tgetConnection(\n\t\tpeerId: string,\n\t\tconnectionId: string,\n\t): null | DataConnection | MediaConnection {\n\t\tconst connections = this._connections.get(peerId);\n\t\tif (!connections) {\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (let connection of connections) {\n\t\t\tif (connection.connectionId === connectionId) {\n\t\t\t\treturn connection;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _delayedAbort(type: PeerErrorType, message: string | Error): void {\n\t\tsetTimeout(() => {\n\t\t\tthis._abort(type, message);\n\t\t}, 0);\n\t}\n\n\t/**\n\t * Emits an error message and destroys the Peer.\n\t * The Peer is not destroyed if it's in a disconnected state, in which case\n\t * it retains its disconnected state and its existing connections.\n\t */\n\tprivate _abort(type: PeerErrorType, message: string | Error): void {\n\t\tlogger.error(\"Aborting!\");\n\n\t\tthis.emitError(type, message);\n\n\t\tif (!this._lastServerId) {\n\t\t\tthis.destroy();\n\t\t} else {\n\t\t\tthis.disconnect();\n\t\t}\n\t}\n\n\t/** Emits a typed error message. */\n\temitError(type: PeerErrorType, err: string | Error): void {\n\t\tlogger.error(\"Error:\", err);\n\n\t\tlet error: Error & { type?: PeerErrorType };\n\n\t\tif (typeof err === \"string\") {\n\t\t\terror = new Error(err);\n\t\t} else {\n\t\t\terror = err as Error;\n\t\t}\n\n\t\terror.type = type;\n\n\t\tthis.emit(\"error\", error);\n\t}\n\n\t/**\n\t * Destroys the Peer: closes all active connections as well as the connection\n\t *  to the server.\n\t * Warning: The peer can no longer create or accept connections after being\n\t *  destroyed.\n\t */\n\tdestroy(): void {\n\t\tif (this.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\tlogger.log(`Destroy peer with ID:${this.id}`);\n\n\t\tthis.disconnect();\n\t\tthis._cleanup();\n\n\t\tthis._destroyed = true;\n\n\t\tthis.emit(\"close\");\n\t}\n\n\t/** Disconnects every connection on this peer. */\n\tprivate _cleanup(): void {\n\t\tfor (let peerId of this._connections.keys()) {\n\t\t\tthis._cleanupPeer(peerId);\n\t\t\tthis._connections.delete(peerId);\n\t\t}\n\n\t\tthis.socket.removeAllListeners();\n\t}\n\n\t/** Closes all connections to this peer. */\n\tprivate _cleanupPeer(peerId: string): void {\n\t\tconst connections = this._connections.get(peerId);\n\n\t\tif (!connections) return;\n\n\t\tfor (let connection of connections) {\n\t\t\tconnection.close();\n\t\t}\n\t}\n\n\t/**\n\t * Disconnects the Peer's connection to the PeerServer. Does not close any\n\t *  active connections.\n\t * Warning: The peer can no longer create or accept connections after being\n\t *  disconnected. It also cannot reconnect to the server.\n\t */\n\tdisconnect(): void {\n\t\tif (this.disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentId = this.id;\n\n\t\tlogger.log(`Disconnect peer with ID:${currentId}`);\n\n\t\tthis._disconnected = true;\n\t\tthis._open = false;\n\n\t\tthis.socket.close();\n\n\t\tthis._lastServerId = currentId;\n\t\tthis._id = null;\n\n\t\tthis.emit(\"disconnected\", currentId);\n\t}\n\n\t/** Attempts to reconnect with the same ID. */\n\treconnect(): void {\n\t\tif (this.disconnected && !this.destroyed) {\n\t\t\tlogger.log(\n\t\t\t\t`Attempting reconnection to server with ID ${this._lastServerId}`,\n\t\t\t);\n\t\t\tthis._disconnected = false;\n\t\t\tthis._initialize(this._lastServerId!);\n\t\t} else if (this.destroyed) {\n\t\t\tthrow new Error(\n\t\t\t\t\"This peer cannot reconnect to the server. It has already been destroyed.\",\n\t\t\t);\n\t\t} else if (!this.disconnected && !this.open) {\n\t\t\t// Do nothing. We're still connecting the first time.\n\t\t\tlogger.error(\n\t\t\t\t\"In a hurry? We're still trying to make the initial connection!\",\n\t\t\t);\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Get a list of available peer IDs. If you're running your own server, you'll\n\t * want to set allow_discovery: true in the PeerServer options. If you're using\n\t * the cloud server, email team@peerjs.com to get the functionality enabled for\n\t * your key.\n\t */\n\tlistAllPeers(cb = (_: any[]) => {}): void {\n\t\tthis._api\n\t\t\t.listAllPeers()\n\t\t\t.then((peers) => cb(peers))\n\t\t\t.catch((error) => this._abort(PeerErrorType.ServerError, error));\n\t}\n}\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","const LOG_PREFIX = \"PeerJS: \";\n\n/*\nPrints log messages depending on the debug level passed in. Defaults to 0.\n0  Prints no logs.\n1  Prints only errors.\n2  Prints errors and warnings.\n3  Prints all logs.\n*/\nexport enum LogLevel {\n\tDisabled,\n\tErrors,\n\tWarnings,\n\tAll,\n}\n\nclass Logger {\n\tprivate _logLevel = LogLevel.Disabled;\n\n\tget logLevel(): LogLevel {\n\t\treturn this._logLevel;\n\t}\n\n\tset logLevel(logLevel: LogLevel) {\n\t\tthis._logLevel = logLevel;\n\t}\n\n\tlog(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.All) {\n\t\t\tthis._print(LogLevel.All, ...args);\n\t\t}\n\t}\n\n\twarn(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.Warnings) {\n\t\t\tthis._print(LogLevel.Warnings, ...args);\n\t\t}\n\t}\n\n\terror(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.Errors) {\n\t\t\tthis._print(LogLevel.Errors, ...args);\n\t\t}\n\t}\n\n\tsetLogFunction(fn: (logLevel: LogLevel, ..._: any[]) => void): void {\n\t\tthis._print = fn;\n\t}\n\n\tprivate _print(logLevel: LogLevel, ...rest: any[]): void {\n\t\tconst copy = [LOG_PREFIX, ...rest];\n\n\t\tfor (let i in copy) {\n\t\t\tif (copy[i] instanceof Error) {\n\t\t\t\tcopy[i] = \"(\" + copy[i].name + \") \" + copy[i].message;\n\t\t\t}\n\t\t}\n\n\t\tif (logLevel >= LogLevel.All) {\n\t\t\tconsole.log(...copy);\n\t\t} else if (logLevel >= LogLevel.Warnings) {\n\t\t\tconsole.warn(\"WARNING\", ...copy);\n\t\t} else if (logLevel >= LogLevel.Errors) {\n\t\t\tconsole.error(\"ERROR\", ...copy);\n\t\t}\n\t}\n}\n\nexport default new Logger();\n","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\nimport { SocketEventType, ServerMessageType } from \"./enums\";\nimport { version } from \"../package.json\";\n\n/**\n * An abstraction on top of WebSockets to provide fastest\n * possible connection for peers.\n */\nexport class Socket extends EventEmitter {\n\tprivate _disconnected: boolean = true;\n\tprivate _id?: string;\n\tprivate _messagesQueue: Array<object> = [];\n\tprivate _socket?: WebSocket;\n\tprivate _wsPingTimer?: any;\n\tprivate readonly _baseUrl: string;\n\n\tconstructor(\n\t\tsecure: any,\n\t\thost: string,\n\t\tport: number,\n\t\tpath: string,\n\t\tkey: string,\n\t\tprivate readonly pingInterval: number = 5000,\n\t) {\n\t\tsuper();\n\n\t\tconst wsProtocol = secure ? \"wss://\" : \"ws://\";\n\n\t\tthis._baseUrl = wsProtocol + host + \":\" + port + path + \"peerjs?key=\" + key;\n\t}\n\n\tstart(id: string, token: string): void {\n\t\tthis._id = id;\n\n\t\tconst wsUrl = `${this._baseUrl}&id=${id}&token=${token}`;\n\n\t\tif (!!this._socket || !this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._socket = new WebSocket(wsUrl + \"&version=\" + version);\n\t\tthis._disconnected = false;\n\n\t\tthis._socket.onmessage = (event) => {\n\t\t\tlet data;\n\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(event.data);\n\t\t\t\tlogger.log(\"Server message received:\", data);\n\t\t\t} catch (e) {\n\t\t\t\tlogger.log(\"Invalid server message\", event.data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit(SocketEventType.Message, data);\n\t\t};\n\n\t\tthis._socket.onclose = (event) => {\n\t\t\tif (this._disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.log(\"Socket closed.\", event);\n\n\t\t\tthis._cleanup();\n\t\t\tthis._disconnected = true;\n\n\t\t\tthis.emit(SocketEventType.Disconnected);\n\t\t};\n\n\t\t// Take care of the queue of connections if necessary and make sure Peer knows\n\t\t// socket is open.\n\t\tthis._socket.onopen = () => {\n\t\t\tif (this._disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._sendQueuedMessages();\n\n\t\t\tlogger.log(\"Socket open\");\n\n\t\t\tthis._scheduleHeartbeat();\n\t\t};\n\t}\n\n\tprivate _scheduleHeartbeat(): void {\n\t\tthis._wsPingTimer = setTimeout(() => {\n\t\t\tthis._sendHeartbeat();\n\t\t}, this.pingInterval);\n\t}\n\n\tprivate _sendHeartbeat(): void {\n\t\tif (!this._wsOpen()) {\n\t\t\tlogger.log(`Cannot send heartbeat, because socket closed`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = JSON.stringify({ type: ServerMessageType.Heartbeat });\n\n\t\tthis._socket!.send(message);\n\n\t\tthis._scheduleHeartbeat();\n\t}\n\n\t/** Is the websocket currently open? */\n\tprivate _wsOpen(): boolean {\n\t\treturn !!this._socket && this._socket.readyState === 1;\n\t}\n\n\t/** Send queued messages. */\n\tprivate _sendQueuedMessages(): void {\n\t\t//Create copy of queue and clear it,\n\t\t//because send method push the message back to queue if smth will go wrong\n\t\tconst copiedQueue = [...this._messagesQueue];\n\t\tthis._messagesQueue = [];\n\n\t\tfor (const message of copiedQueue) {\n\t\t\tthis.send(message);\n\t\t}\n\t}\n\n\t/** Exposed send for DC & Peer. */\n\tsend(data: any): void {\n\t\tif (this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If we didn't get an ID yet, we can't yet send anything so we should queue\n\t\t// up these messages.\n\t\tif (!this._id) {\n\t\t\tthis._messagesQueue.push(data);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!data.type) {\n\t\t\tthis.emit(SocketEventType.Error, \"Invalid message\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._wsOpen()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = JSON.stringify(data);\n\n\t\tthis._socket!.send(message);\n\t}\n\n\tclose(): void {\n\t\tif (this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cleanup();\n\n\t\tthis._disconnected = true;\n\t}\n\n\tprivate _cleanup(): void {\n\t\tif (this._socket) {\n\t\t\tthis._socket.onopen =\n\t\t\t\tthis._socket.onmessage =\n\t\t\t\tthis._socket.onclose =\n\t\t\t\t\tnull;\n\t\t\tthis._socket.close();\n\t\t\tthis._socket = undefined;\n\t\t}\n\n\t\tclearTimeout(this._wsPingTimer!);\n\t}\n}\n","export enum ConnectionType {\n\tData = \"data\",\n\tMedia = \"media\",\n}\n\nexport enum PeerErrorType {\n\tBrowserIncompatible = \"browser-incompatible\",\n\tDisconnected = \"disconnected\",\n\tInvalidID = \"invalid-id\",\n\tInvalidKey = \"invalid-key\",\n\tNetwork = \"network\",\n\tPeerUnavailable = \"peer-unavailable\",\n\tSslUnavailable = \"ssl-unavailable\",\n\tServerError = \"server-error\",\n\tSocketError = \"socket-error\",\n\tSocketClosed = \"socket-closed\",\n\tUnavailableID = \"unavailable-id\",\n\tWebRTC = \"webrtc\",\n}\n\nexport enum SerializationType {\n\tBinary = \"binary\",\n\tBinaryUTF8 = \"binary-utf8\",\n\tJSON = \"json\",\n}\n\nexport enum SocketEventType {\n\tMessage = \"message\",\n\tDisconnected = \"disconnected\",\n\tError = \"error\",\n\tClose = \"close\",\n}\n\nexport enum ServerMessageType {\n\tHeartbeat = \"HEARTBEAT\",\n\tCandidate = \"CANDIDATE\",\n\tOffer = \"OFFER\",\n\tAnswer = \"ANSWER\",\n\tOpen = \"OPEN\", // The connection to the server is open.\n\tError = \"ERROR\", // Server error.\n\tIdTaken = \"ID-TAKEN\", // The selected ID is taken.\n\tInvalidKey = \"INVALID-KEY\", // The given API key cannot be found.\n\tLeave = \"LEAVE\", // Another peer has closed its connection to this peer.\n\tExpire = \"EXPIRE\", // The offer sent to a peer has expired without response.\n}\n","{\n\t\"name\": \"peerjs\",\n\t\"version\": \"1.4.7\",\n\t\"keywords\": [\n\t\t\"peerjs\",\n\t\t\"webrtc\",\n\t\t\"p2p\",\n\t\t\"rtc\"\n\t],\n\t\"description\": \"PeerJS client\",\n\t\"homepage\": \"https://peerjs.com\",\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/peers/peerjs/issues\"\n\t},\n\t\"repository\": {\n\t\t\"type\": \"git\",\n\t\t\"url\": \"https://github.com/peers/peerjs\"\n\t},\n\t\"license\": \"MIT\",\n\t\"contributors\": [\n\t\t\"Michelle Bu <michelle@michellebu.com>\",\n\t\t\"afrokick <devbyru@gmail.com>\",\n\t\t\"ericz <really.ez@gmail.com>\",\n\t\t\"Jairo <kidandcat@gmail.com>\",\n\t\t\"Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>\",\n\t\t\"Jairo Caro-Accino Viciana <jairo@galax.be>\",\n\t\t\"Carlos Caballero <carlos.caballero.gonzalez@gmail.com>\",\n\t\t\"hc <hheennrryy@gmail.com>\",\n\t\t\"Muhammad Asif <capripio@gmail.com>\",\n\t\t\"PrashoonB <prashoonbhattacharjee@gmail.com>\",\n\t\t\"Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>\",\n\t\t\"akotynski <aleksanderkotbury@gmail.com>\",\n\t\t\"lmb <i@lmb.io>\",\n\t\t\"Jairooo <jairocaro@msn.com>\",\n\t\t\"Moritz Stückler <moritz.stueckler@gmail.com>\",\n\t\t\"Simon <crydotsnakegithub@gmail.com>\",\n\t\t\"Denis Lukov <denismassters@gmail.com>\",\n\t\t\"Philipp Hancke <fippo@andyet.net>\",\n\t\t\"Hans Oksendahl <hansoksendahl@gmail.com>\",\n\t\t\"Jess <jessachandler@gmail.com>\",\n\t\t\"khankuan <khankuan@gmail.com>\",\n\t\t\"DUODVK <kurmanov.work@gmail.com>\",\n\t\t\"XiZhao <kwang1imsa@gmail.com>\",\n\t\t\"Matthias Lohr <matthias@lohr.me>\",\n\t\t\"=frank tree <=frnktrb@googlemail.com>\",\n\t\t\"Andre Eckardt <aeckardt@outlook.com>\",\n\t\t\"Chris Cowan <agentme49@gmail.com>\",\n\t\t\"Alex Chuev <alex@chuev.com>\",\n\t\t\"alxnull <alxnull@e.mail.de>\",\n\t\t\"Yemel Jardi <angel.jardi@gmail.com>\",\n\t\t\"Ben Parnell <benjaminparnell.94@gmail.com>\",\n\t\t\"Benny Lichtner <bennlich@gmail.com>\",\n\t\t\"fresheneesz <bitetrudpublic@gmail.com>\",\n\t\t\"bob.barstead@exaptive.com <bob.barstead@exaptive.com>\",\n\t\t\"chandika <chandika@gmail.com>\",\n\t\t\"emersion <contact@emersion.fr>\",\n\t\t\"Christopher Van <cvan@users.noreply.github.com>\",\n\t\t\"eddieherm <edhermoso@gmail.com>\",\n\t\t\"Eduardo Pinho <enet4mikeenet@gmail.com>\",\n\t\t\"Evandro Zanatta <ezanatta@tray.net.br>\",\n\t\t\"Gardner Bickford <gardner@users.noreply.github.com>\",\n\t\t\"Gian Luca <gianluca.cecchi@cynny.com>\",\n\t\t\"PatrickJS <github@gdi2290.com>\",\n\t\t\"jonnyf <github@jonathanfoss.co.uk>\",\n\t\t\"Hizkia Felix <hizkifw@gmail.com>\",\n\t\t\"Hristo Oskov <hristo.oskov@gmail.com>\",\n\t\t\"Isaac Madwed <i.madwed@gmail.com>\",\n\t\t\"Ilya Konanykhin <ilya.konanykhin@gmail.com>\",\n\t\t\"jasonbarry <jasbarry@me.com>\",\n\t\t\"Jonathan Burke <jonathan.burke.1311@googlemail.com>\",\n\t\t\"Josh Hamit <josh.hamit@gmail.com>\",\n\t\t\"Jordan Austin <jrax86@gmail.com>\",\n\t\t\"Joel Wetzell <jwetzell@yahoo.com>\",\n\t\t\"xizhao <kevin.wang@cloudera.com>\",\n\t\t\"Alberto Torres <kungfoobar@gmail.com>\",\n\t\t\"Jonathan Mayol <mayoljonathan@gmail.com>\",\n\t\t\"Jefferson Felix <me@jsfelix.dev>\",\n\t\t\"Rolf Erik Lekang <me@rolflekang.com>\",\n\t\t\"Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>\",\n\t\t\"Pepijn de Vos <pepijndevos@gmail.com>\",\n\t\t\"JooYoung <qkdlql@naver.com>\",\n\t\t\"Tobias Speicher <rootcommander@gmail.com>\",\n\t\t\"Steve Blaurock <sblaurock@gmail.com>\",\n\t\t\"Kyrylo Shegeda <shegeda@ualberta.ca>\",\n\t\t\"Diwank Singh Tomer <singh@diwank.name>\",\n\t\t\"Sören Balko <Soeren.Balko@gmail.com>\",\n\t\t\"Arpit Solanki <solankiarpit1997@gmail.com>\",\n\t\t\"Yuki Ito <yuki@gnnk.net>\",\n\t\t\"Artur Zayats <zag2art@gmail.com>\"\n\t],\n\t\"funding\": {\n\t\t\"type\": \"opencollective\",\n\t\t\"url\": \"https://opencollective.com/peer\"\n\t},\n\t\"collective\": {\n\t\t\"type\": \"opencollective\",\n\t\t\"url\": \"https://opencollective.com/peer\"\n\t},\n\t\"files\": [\n\t\t\"dist/*\"\n\t],\n\t\"sideEffects\": [\n\t\t\"lib/global.ts\",\n\t\t\"lib/supports.ts\"\n\t],\n\t\"main\": \"dist/bundler.cjs\",\n\t\"module\": \"dist/bundler.mjs\",\n\t\"browser-minified\": \"dist/peerjs.min.js\",\n\t\"browser-unminified\": \"dist/peerjs.js\",\n\t\"types\": \"dist/types.d.ts\",\n\t\"engines\": {\n\t\t\"node\": \">= 10\"\n\t},\n\t\"targets\": {\n\t\t\"types\": {\n\t\t\t\"source\": \"lib/exports.ts\"\n\t\t},\n\t\t\"main\": {\n\t\t\t\"source\": \"lib/exports.ts\",\n\t\t\t\"sourceMap\": {\n\t\t\t\t\"inlineSources\": true\n\t\t\t}\n\t\t},\n\t\t\"module\": {\n\t\t\t\"source\": \"lib/exports.ts\",\n\t\t\t\"includeNodeModules\": [\n\t\t\t\t\"eventemitter3\"\n\t\t\t],\n\t\t\t\"sourceMap\": {\n\t\t\t\t\"inlineSources\": true\n\t\t\t}\n\t\t},\n\t\t\"browser-minified\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"global\",\n\t\t\t\"optimize\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"cover 99%, not dead\"\n\t\t\t},\n\t\t\t\"source\": \"lib/global.ts\"\n\t\t},\n\t\t\"browser-unminified\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"global\",\n\t\t\t\"optimize\": false,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"cover 99%, not dead\"\n\t\t\t},\n\t\t\t\"source\": \"lib/global.ts\"\n\t\t}\n\t},\n\t\"scripts\": {\n\t\t\"contributors\": \"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\\"chore(contributors): update and sort contributors list\\\"\",\n\t\t\"check\": \"tsc --noEmit\",\n\t\t\"watch\": \"parcel watch\",\n\t\t\"build\": \"rm -rf dist && parcel build\",\n\t\t\"prepublishOnly\": \"npm run build\",\n\t\t\"test\": \"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts\",\n\t\t\"format\": \"prettier --write .\",\n\t\t\"semantic-release\": \"semantic-release\"\n\t},\n\t\"devDependencies\": {\n\t\t\"@parcel/config-default\": \"^2.5.0\",\n\t\t\"@parcel/packager-ts\": \"^2.5.0\",\n\t\t\"@parcel/transformer-typescript-tsc\": \"^2.5.0\",\n\t\t\"@parcel/transformer-typescript-types\": \"^2.5.0\",\n\t\t\"@semantic-release/changelog\": \"^6.0.1\",\n\t\t\"@semantic-release/git\": \"^10.0.1\",\n\t\t\"@types/chai\": \"^4.3.0\",\n\t\t\"@types/mocha\": \"^9.1.0\",\n\t\t\"@types/node\": \"^17.0.18\",\n\t\t\"chai\": \"^4.3.6\",\n\t\t\"git-authors-cli\": \"^1.0.40\",\n\t\t\"jsdom\": \"^19.0.0\",\n\t\t\"jsdom-global\": \"^3.0.2\",\n\t\t\"mocha\": \"^9.2.0\",\n\t\t\"mock-socket\": \"8.0.5\",\n\t\t\"parcel\": \"^2.5.0\",\n\t\t\"parcel-transformer-tsc-sourcemaps\": \"^1.0.2\",\n\t\t\"prettier\": \"^2.6.2\",\n\t\t\"semantic-release\": \"^19.0.2\",\n\t\t\"standard\": \"^16.0.4\",\n\t\t\"ts-node\": \"^10.5.0\",\n\t\t\"typescript\": \"^4.5.5\"\n\t},\n\t\"dependencies\": {\n\t\t\"@swc/helpers\": \"^0.3.13\",\n\t\t\"eventemitter3\": \"^4.0.7\",\n\t\t\"peerjs-js-binarypack\": \"1.0.1\",\n\t\t\"webrtc-adapter\": \"^7.7.1\"\n\t}\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport { ConnectionType, ServerMessageType } from \"./enums\";\nimport { Peer } from \"./peer\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport type { AnswerOption } from \"./optionInterfaces\";\n\ntype MediaConnectionEvents = {\n\t/**\n\t * Emitted when a connection to the PeerServer is established.\n\t */\n\tstream: (stream: MediaStream) => void;\n};\n\n/**\n * Wraps the streaming interface between two Peers.\n */\nexport class MediaConnection extends BaseConnection<MediaConnectionEvents> {\n\tprivate static readonly ID_PREFIX = \"mc_\";\n\n\tprivate _negotiator: Negotiator<MediaConnectionEvents, MediaConnection>;\n\tprivate _localStream: MediaStream;\n\tprivate _remoteStream: MediaStream;\n\n\tget type() {\n\t\treturn ConnectionType.Media;\n\t}\n\n\tget localStream(): MediaStream {\n\t\treturn this._localStream;\n\t}\n\tget remoteStream(): MediaStream {\n\t\treturn this._remoteStream;\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\n\t\tthis._localStream = this.options._stream;\n\t\tthis.connectionId =\n\t\t\tthis.options.connectionId ||\n\t\t\tMediaConnection.ID_PREFIX + util.randomToken();\n\n\t\tthis._negotiator = new Negotiator(this);\n\n\t\tif (this._localStream) {\n\t\t\tthis._negotiator.startConnection({\n\t\t\t\t_stream: this._localStream,\n\t\t\t\toriginator: true,\n\t\t\t});\n\t\t}\n\t}\n\n\taddStream(remoteStream) {\n\t\tlogger.log(\"Receiving stream\", remoteStream);\n\n\t\tthis._remoteStream = remoteStream;\n\t\tsuper.emit(\"stream\", remoteStream); // Should we call this `open`?\n\t}\n\n\thandleMessage(message: ServerMessage): void {\n\t\tconst type = message.type;\n\t\tconst payload = message.payload;\n\n\t\tswitch (message.type) {\n\t\t\tcase ServerMessageType.Answer:\n\t\t\t\t// Forward to negotiator\n\t\t\t\tthis._negotiator.handleSDP(type, payload.sdp);\n\t\t\t\tthis._open = true;\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Candidate:\n\t\t\t\tthis._negotiator.handleCandidate(payload.candidate);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.warn(`Unrecognized message type:${type} from peer:${this.peer}`);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tanswer(stream?: MediaStream, options: AnswerOption = {}): void {\n\t\tif (this._localStream) {\n\t\t\tlogger.warn(\n\t\t\t\t\"Local stream already exists on this MediaConnection. Are you answering a call twice?\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._localStream = stream;\n\n\t\tif (options && options.sdpTransform) {\n\t\t\tthis.options.sdpTransform = options.sdpTransform;\n\t\t}\n\n\t\tthis._negotiator.startConnection({\n\t\t\t...this.options._payload,\n\t\t\t_stream: stream,\n\t\t});\n\t\t// Retrieve lost messages stored because PeerConnection not set up.\n\t\tconst messages = this.provider._getMessages(this.connectionId);\n\n\t\tfor (let message of messages) {\n\t\t\tthis.handleMessage(message);\n\t\t}\n\n\t\tthis._open = true;\n\t}\n\n\t/**\n\t * Exposed functionality for users.\n\t */\n\n\t/** Allows user to close connection. */\n\tclose(): void {\n\t\tif (this._negotiator) {\n\t\t\tthis._negotiator.cleanup();\n\t\t\tthis._negotiator = null;\n\t\t}\n\n\t\tthis._localStream = null;\n\t\tthis._remoteStream = null;\n\n\t\tif (this.provider) {\n\t\t\tthis.provider._removeConnection(this);\n\n\t\t\tthis.provider = null;\n\t\t}\n\n\t\tif (this.options && this.options._stream) {\n\t\t\tthis.options._stream = null;\n\t\t}\n\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._open = false;\n\n\t\tsuper.emit(\"close\");\n\t}\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport { DataConnection } from \"./dataconnection\";\nimport { ConnectionType, PeerErrorType, ServerMessageType } from \"./enums\";\nimport { BaseConnection, BaseConnectionEvents } from \"./baseconnection\";\nimport { ValidEventTypes } from \"eventemitter3\";\n\n/**\n * Manages all negotiations between Peers.\n */\nexport class Negotiator<\n\tA extends ValidEventTypes,\n\tT extends BaseConnection<A | BaseConnectionEvents>,\n> {\n\tconstructor(readonly connection: T) {}\n\n\t/** Returns a PeerConnection object set up correctly (for data, media). */\n\tstartConnection(options: any) {\n\t\tconst peerConnection = this._startPeerConnection();\n\n\t\t// Set the connection's PC.\n\t\tthis.connection.peerConnection = peerConnection;\n\n\t\tif (this.connection.type === ConnectionType.Media && options._stream) {\n\t\t\tthis._addTracksToConnection(options._stream, peerConnection);\n\t\t}\n\n\t\t// What do we need to do now?\n\t\tif (options.originator) {\n\t\t\tif (this.connection.type === ConnectionType.Data) {\n\t\t\t\tconst dataConnection = <DataConnection>(<unknown>this.connection);\n\n\t\t\t\tconst config: RTCDataChannelInit = { ordered: !!options.reliable };\n\n\t\t\t\tconst dataChannel = peerConnection.createDataChannel(\n\t\t\t\t\tdataConnection.label,\n\t\t\t\t\tconfig,\n\t\t\t\t);\n\t\t\t\tdataConnection.initialize(dataChannel);\n\t\t\t}\n\n\t\t\tthis._makeOffer();\n\t\t} else {\n\t\t\tthis.handleSDP(\"OFFER\", options.sdp);\n\t\t}\n\t}\n\n\t/** Start a PC. */\n\tprivate _startPeerConnection(): RTCPeerConnection {\n\t\tlogger.log(\"Creating RTCPeerConnection.\");\n\n\t\tconst peerConnection = new RTCPeerConnection(\n\t\t\tthis.connection.provider.options.config,\n\t\t);\n\n\t\tthis._setupListeners(peerConnection);\n\n\t\treturn peerConnection;\n\t}\n\n\t/** Set up various WebRTC listeners. */\n\tprivate _setupListeners(peerConnection: RTCPeerConnection) {\n\t\tconst peerId = this.connection.peer;\n\t\tconst connectionId = this.connection.connectionId;\n\t\tconst connectionType = this.connection.type;\n\t\tconst provider = this.connection.provider;\n\n\t\t// ICE CANDIDATES.\n\t\tlogger.log(\"Listening for ICE candidates.\");\n\n\t\tpeerConnection.onicecandidate = (evt) => {\n\t\t\tif (!evt.candidate || !evt.candidate.candidate) return;\n\n\t\t\tlogger.log(`Received ICE candidates for ${peerId}:`, evt.candidate);\n\n\t\t\tprovider.socket.send({\n\t\t\t\ttype: ServerMessageType.Candidate,\n\t\t\t\tpayload: {\n\t\t\t\t\tcandidate: evt.candidate,\n\t\t\t\t\ttype: connectionType,\n\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t},\n\t\t\t\tdst: peerId,\n\t\t\t});\n\t\t};\n\n\t\tpeerConnection.oniceconnectionstatechange = () => {\n\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\tcase \"failed\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState is failed, closing connections to \" + peerId,\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.emit(\n\t\t\t\t\t\t\"error\",\n\t\t\t\t\t\tnew Error(\"Negotiation of connection to \" + peerId + \" failed.\"),\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.close();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"closed\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState is closed, closing connections to \" + peerId,\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.emit(\n\t\t\t\t\t\t\"error\",\n\t\t\t\t\t\tnew Error(\"Connection to \" + peerId + \" closed.\"),\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.close();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"disconnected\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState changed to disconnected on the connection with \" +\n\t\t\t\t\t\t\tpeerId,\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"completed\":\n\t\t\t\t\tpeerConnection.onicecandidate = util.noop;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.connection.emit(\n\t\t\t\t\"iceStateChanged\",\n\t\t\t\tpeerConnection.iceConnectionState,\n\t\t\t);\n\t\t};\n\n\t\t// DATACONNECTION.\n\t\tlogger.log(\"Listening for data channel\");\n\t\t// Fired between offer and answer, so options should already be saved\n\t\t// in the options hash.\n\t\tpeerConnection.ondatachannel = (evt) => {\n\t\t\tlogger.log(\"Received data channel\");\n\n\t\t\tconst dataChannel = evt.channel;\n\t\t\tconst connection = <DataConnection>(\n\t\t\t\tprovider.getConnection(peerId, connectionId)\n\t\t\t);\n\n\t\t\tconnection.initialize(dataChannel);\n\t\t};\n\n\t\t// MEDIACONNECTION.\n\t\tlogger.log(\"Listening for remote stream\");\n\n\t\tpeerConnection.ontrack = (evt) => {\n\t\t\tlogger.log(\"Received remote stream\");\n\n\t\t\tconst stream = evt.streams[0];\n\t\t\tconst connection = provider.getConnection(peerId, connectionId);\n\n\t\t\tif (connection.type === ConnectionType.Media) {\n\t\t\t\tconst mediaConnection = <MediaConnection>connection;\n\n\t\t\t\tthis._addStreamToMediaConnection(stream, mediaConnection);\n\t\t\t}\n\t\t};\n\t}\n\n\tcleanup(): void {\n\t\tlogger.log(\"Cleaning up PeerConnection to \" + this.connection.peer);\n\n\t\tconst peerConnection = this.connection.peerConnection;\n\n\t\tif (!peerConnection) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.connection.peerConnection = null;\n\n\t\t//unsubscribe from all PeerConnection's events\n\t\tpeerConnection.onicecandidate =\n\t\t\tpeerConnection.oniceconnectionstatechange =\n\t\t\tpeerConnection.ondatachannel =\n\t\t\tpeerConnection.ontrack =\n\t\t\t\t() => {};\n\n\t\tconst peerConnectionNotClosed = peerConnection.signalingState !== \"closed\";\n\t\tlet dataChannelNotClosed = false;\n\n\t\tif (this.connection.type === ConnectionType.Data) {\n\t\t\tconst dataConnection = <DataConnection>(<unknown>this.connection);\n\t\t\tconst dataChannel = dataConnection.dataChannel;\n\n\t\t\tif (dataChannel) {\n\t\t\t\tdataChannelNotClosed =\n\t\t\t\t\t!!dataChannel.readyState && dataChannel.readyState !== \"closed\";\n\t\t\t}\n\t\t}\n\n\t\tif (peerConnectionNotClosed || dataChannelNotClosed) {\n\t\t\tpeerConnection.close();\n\t\t}\n\t}\n\n\tprivate async _makeOffer(): Promise<void> {\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\ttry {\n\t\t\tconst offer = await peerConnection.createOffer(\n\t\t\t\tthis.connection.options.constraints,\n\t\t\t);\n\n\t\t\tlogger.log(\"Created offer.\");\n\n\t\t\tif (\n\t\t\t\tthis.connection.options.sdpTransform &&\n\t\t\t\ttypeof this.connection.options.sdpTransform === \"function\"\n\t\t\t) {\n\t\t\t\toffer.sdp =\n\t\t\t\t\tthis.connection.options.sdpTransform(offer.sdp) || offer.sdp;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait peerConnection.setLocalDescription(offer);\n\n\t\t\t\tlogger.log(\n\t\t\t\t\t\"Set localDescription:\",\n\t\t\t\t\toffer,\n\t\t\t\t\t`for:${this.connection.peer}`,\n\t\t\t\t);\n\n\t\t\t\tlet payload: any = {\n\t\t\t\t\tsdp: offer,\n\t\t\t\t\ttype: this.connection.type,\n\t\t\t\t\tconnectionId: this.connection.connectionId,\n\t\t\t\t\tmetadata: this.connection.metadata,\n\t\t\t\t\tbrowser: util.browser,\n\t\t\t\t};\n\n\t\t\t\tif (this.connection.type === ConnectionType.Data) {\n\t\t\t\t\tconst dataConnection = <DataConnection>(<unknown>this.connection);\n\n\t\t\t\t\tpayload = {\n\t\t\t\t\t\t...payload,\n\t\t\t\t\t\tlabel: dataConnection.label,\n\t\t\t\t\t\treliable: dataConnection.reliable,\n\t\t\t\t\t\tserialization: dataConnection.serialization,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tprovider.socket.send({\n\t\t\t\t\ttype: ServerMessageType.Offer,\n\t\t\t\t\tpayload,\n\t\t\t\t\tdst: this.connection.peer,\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\t// TODO: investigate why _makeOffer is being called from the answer\n\t\t\t\tif (\n\t\t\t\t\terr !=\n\t\t\t\t\t\"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer\"\n\t\t\t\t) {\n\t\t\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\t\t\tlogger.log(\"Failed to setLocalDescription, \", err);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err_1) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err_1);\n\t\t\tlogger.log(\"Failed to createOffer, \", err_1);\n\t\t}\n\t}\n\n\tprivate async _makeAnswer(): Promise<void> {\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\ttry {\n\t\t\tconst answer = await peerConnection.createAnswer();\n\t\t\tlogger.log(\"Created answer.\");\n\n\t\t\tif (\n\t\t\t\tthis.connection.options.sdpTransform &&\n\t\t\t\ttypeof this.connection.options.sdpTransform === \"function\"\n\t\t\t) {\n\t\t\t\tanswer.sdp =\n\t\t\t\t\tthis.connection.options.sdpTransform(answer.sdp) || answer.sdp;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait peerConnection.setLocalDescription(answer);\n\n\t\t\t\tlogger.log(\n\t\t\t\t\t`Set localDescription:`,\n\t\t\t\t\tanswer,\n\t\t\t\t\t`for:${this.connection.peer}`,\n\t\t\t\t);\n\n\t\t\t\tprovider.socket.send({\n\t\t\t\t\ttype: ServerMessageType.Answer,\n\t\t\t\t\tpayload: {\n\t\t\t\t\t\tsdp: answer,\n\t\t\t\t\t\ttype: this.connection.type,\n\t\t\t\t\t\tconnectionId: this.connection.connectionId,\n\t\t\t\t\t\tbrowser: util.browser,\n\t\t\t\t\t},\n\t\t\t\t\tdst: this.connection.peer,\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\t\tlogger.log(\"Failed to setLocalDescription, \", err);\n\t\t\t}\n\t\t} catch (err_1) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err_1);\n\t\t\tlogger.log(\"Failed to create answer, \", err_1);\n\t\t}\n\t}\n\n\t/** Handle an SDP. */\n\tasync handleSDP(type: string, sdp: any): Promise<void> {\n\t\tsdp = new RTCSessionDescription(sdp);\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\tlogger.log(\"Setting remote description\", sdp);\n\n\t\tconst self = this;\n\n\t\ttry {\n\t\t\tawait peerConnection.setRemoteDescription(sdp);\n\t\t\tlogger.log(`Set remoteDescription:${type} for:${this.connection.peer}`);\n\t\t\tif (type === \"OFFER\") {\n\t\t\t\tawait self._makeAnswer();\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\tlogger.log(\"Failed to setRemoteDescription, \", err);\n\t\t}\n\t}\n\n\t/** Handle a candidate. */\n\tasync handleCandidate(ice: any): Promise<void> {\n\t\tlogger.log(`handleCandidate:`, ice);\n\n\t\tconst candidate = ice.candidate;\n\t\tconst sdpMLineIndex = ice.sdpMLineIndex;\n\t\tconst sdpMid = ice.sdpMid;\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\ttry {\n\t\t\tawait peerConnection.addIceCandidate(\n\t\t\t\tnew RTCIceCandidate({\n\t\t\t\t\tsdpMid: sdpMid,\n\t\t\t\t\tsdpMLineIndex: sdpMLineIndex,\n\t\t\t\t\tcandidate: candidate,\n\t\t\t\t}),\n\t\t\t);\n\t\t\tlogger.log(`Added ICE candidate for:${this.connection.peer}`);\n\t\t} catch (err) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\tlogger.log(\"Failed to handleCandidate, \", err);\n\t\t}\n\t}\n\n\tprivate _addTracksToConnection(\n\t\tstream: MediaStream,\n\t\tpeerConnection: RTCPeerConnection,\n\t): void {\n\t\tlogger.log(`add tracks from stream ${stream.id} to peer connection`);\n\n\t\tif (!peerConnection.addTrack) {\n\t\t\treturn logger.error(\n\t\t\t\t`Your browser does't support RTCPeerConnection#addTrack. Ignored.`,\n\t\t\t);\n\t\t}\n\n\t\tstream.getTracks().forEach((track) => {\n\t\t\tpeerConnection.addTrack(track, stream);\n\t\t});\n\t}\n\n\tprivate _addStreamToMediaConnection(\n\t\tstream: MediaStream,\n\t\tmediaConnection: MediaConnection,\n\t): void {\n\t\tlogger.log(\n\t\t\t`add stream ${stream.id} to media connection ${mediaConnection.connectionId}`,\n\t\t);\n\n\t\tmediaConnection.addStream(stream);\n\t}\n}\n","import { EventEmitter, ValidEventTypes } from \"eventemitter3\";\nimport { Peer } from \"./peer\";\nimport { ServerMessage } from \"./servermessage\";\nimport { ConnectionType } from \"./enums\";\n\nexport type BaseConnectionEvents = {\n\t/**\n\t * Emitted when either you or the remote peer closes the connection.\n\t */\n\tclose: () => void;\n\terror: (error: Error) => void;\n\ticeStateChanged: (state: RTCIceConnectionState) => void;\n};\n\nexport abstract class BaseConnection<\n\tT extends ValidEventTypes,\n> extends EventEmitter<T & BaseConnectionEvents> {\n\tprotected _open = false;\n\n\treadonly metadata: any;\n\tconnectionId: string;\n\n\tpeerConnection: RTCPeerConnection;\n\n\tabstract get type(): ConnectionType;\n\n\tget open() {\n\t\treturn this._open;\n\t}\n\n\tconstructor(\n\t\treadonly peer: string,\n\t\tpublic provider: Peer,\n\t\treadonly options: any,\n\t) {\n\t\tsuper();\n\n\t\tthis.metadata = options.metadata;\n\t}\n\n\tabstract close(): void;\n\n\tabstract handleMessage(message: ServerMessage): void;\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport { ConnectionType, SerializationType, ServerMessageType } from \"./enums\";\nimport { Peer } from \"./peer\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport { EncodingQueue } from \"./encodingQueue\";\nimport type { DataConnection as IDataConnection } from \"./dataconnection\";\n\ntype DataConnectionEvents = {\n\t/**\n\t * Emitted when data is received from the remote peer.\n\t */\n\tdata: (data: unknown) => void;\n\t/**\n\t * Emitted when the connection is established and ready-to-use.\n\t */\n\topen: () => void;\n};\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nexport class DataConnection\n\textends BaseConnection<DataConnectionEvents>\n\timplements IDataConnection\n{\n\tprivate static readonly ID_PREFIX = \"dc_\";\n\tprivate static readonly MAX_BUFFERED_AMOUNT = 8 * 1024 * 1024;\n\n\tprivate _negotiator: Negotiator<DataConnectionEvents, DataConnection>;\n\treadonly label: string;\n\treadonly serialization: SerializationType;\n\treadonly reliable: boolean;\n\tstringify: (data: any) => string = JSON.stringify;\n\tparse: (data: string) => any = JSON.parse;\n\n\tget type() {\n\t\treturn ConnectionType.Data;\n\t}\n\n\tprivate _buffer: any[] = [];\n\tprivate _bufferSize = 0;\n\tprivate _buffering = false;\n\tprivate _chunkedData: {\n\t\t[id: number]: {\n\t\t\tdata: Blob[];\n\t\t\tcount: number;\n\t\t\ttotal: number;\n\t\t};\n\t} = {};\n\n\tprivate _dc: RTCDataChannel;\n\tprivate _encodingQueue = new EncodingQueue();\n\n\tget dataChannel(): RTCDataChannel {\n\t\treturn this._dc;\n\t}\n\n\tget bufferSize(): number {\n\t\treturn this._bufferSize;\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\n\t\tthis.connectionId =\n\t\t\tthis.options.connectionId ||\n\t\t\tDataConnection.ID_PREFIX + util.randomToken();\n\n\t\tthis.label = this.options.label || this.connectionId;\n\t\tthis.serialization = this.options.serialization || SerializationType.Binary;\n\t\tthis.reliable = !!this.options.reliable;\n\n\t\tthis._encodingQueue.on(\"done\", (ab: ArrayBuffer) => {\n\t\t\tthis._bufferedSend(ab);\n\t\t});\n\n\t\tthis._encodingQueue.on(\"error\", () => {\n\t\t\tlogger.error(\n\t\t\t\t`DC#${this.connectionId}: Error occured in encoding from blob to arraybuffer, close DC`,\n\t\t\t);\n\t\t\tthis.close();\n\t\t});\n\n\t\tthis._negotiator = new Negotiator(this);\n\n\t\tthis._negotiator.startConnection(\n\t\t\tthis.options._payload || {\n\t\t\t\toriginator: true,\n\t\t\t},\n\t\t);\n\t}\n\n\t/** Called by the Negotiator when the DataChannel is ready. */\n\tinitialize(dc: RTCDataChannel): void {\n\t\tthis._dc = dc;\n\t\tthis._configureDataChannel();\n\t}\n\n\tprivate _configureDataChannel(): void {\n\t\tif (!util.supports.binaryBlob || util.supports.reliable) {\n\t\t\tthis.dataChannel.binaryType = \"arraybuffer\";\n\t\t}\n\n\t\tthis.dataChannel.onopen = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc connection success`);\n\t\t\tthis._open = true;\n\t\t\tthis.emit(\"open\");\n\t\t};\n\n\t\tthis.dataChannel.onmessage = (e) => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc onmessage:`, e.data);\n\t\t\tthis._handleDataMessage(e);\n\t\t};\n\n\t\tthis.dataChannel.onclose = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc closed for:`, this.peer);\n\t\t\tthis.close();\n\t\t};\n\t}\n\n\t// Handles a DataChannel message.\n\tprivate _handleDataMessage({\n\t\tdata,\n\t}: {\n\t\tdata: Blob | ArrayBuffer | string;\n\t}): void {\n\t\tconst datatype = data.constructor;\n\n\t\tconst isBinarySerialization =\n\t\t\tthis.serialization === SerializationType.Binary ||\n\t\t\tthis.serialization === SerializationType.BinaryUTF8;\n\n\t\tlet deserializedData: any = data;\n\n\t\tif (isBinarySerialization) {\n\t\t\tif (datatype === Blob) {\n\t\t\t\t// Datatype should never be blob\n\t\t\t\tutil.blobToArrayBuffer(data as Blob, (ab) => {\n\t\t\t\t\tconst unpackedData = util.unpack(ab);\n\t\t\t\t\tthis.emit(\"data\", unpackedData);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t} else if (datatype === ArrayBuffer) {\n\t\t\t\tdeserializedData = util.unpack(data as ArrayBuffer);\n\t\t\t} else if (datatype === String) {\n\t\t\t\t// String fallback for binary data for browsers that don't support binary yet\n\t\t\t\tconst ab = util.binaryStringToArrayBuffer(data as string);\n\t\t\t\tdeserializedData = util.unpack(ab);\n\t\t\t}\n\t\t} else if (this.serialization === SerializationType.JSON) {\n\t\t\tdeserializedData = this.parse(data as string);\n\t\t}\n\n\t\t// Check if we've chunked--if so, piece things back together.\n\t\t// We're guaranteed that this isn't 0.\n\t\tif (deserializedData.__peerData) {\n\t\t\tthis._handleChunk(deserializedData);\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.emit(\"data\", deserializedData);\n\t}\n\n\tprivate _handleChunk(data: {\n\t\t__peerData: number;\n\t\tn: number;\n\t\ttotal: number;\n\t\tdata: Blob;\n\t}): void {\n\t\tconst id = data.__peerData;\n\t\tconst chunkInfo = this._chunkedData[id] || {\n\t\t\tdata: [],\n\t\t\tcount: 0,\n\t\t\ttotal: data.total,\n\t\t};\n\n\t\tchunkInfo.data[data.n] = data.data;\n\t\tchunkInfo.count++;\n\t\tthis._chunkedData[id] = chunkInfo;\n\n\t\tif (chunkInfo.total === chunkInfo.count) {\n\t\t\t// Clean up before making the recursive call to `_handleDataMessage`.\n\t\t\tdelete this._chunkedData[id];\n\n\t\t\t// We've received all the chunks--time to construct the complete data.\n\t\t\tconst data = new Blob(chunkInfo.data);\n\t\t\tthis._handleDataMessage({ data });\n\t\t}\n\t}\n\n\t/**\n\t * Exposed functionality for users.\n\t */\n\n\t/** Allows user to close connection. */\n\tclose(): void {\n\t\tthis._buffer = [];\n\t\tthis._bufferSize = 0;\n\t\tthis._chunkedData = {};\n\n\t\tif (this._negotiator) {\n\t\t\tthis._negotiator.cleanup();\n\t\t\tthis._negotiator = null;\n\t\t}\n\n\t\tif (this.provider) {\n\t\t\tthis.provider._removeConnection(this);\n\n\t\t\tthis.provider = null;\n\t\t}\n\n\t\tif (this.dataChannel) {\n\t\t\tthis.dataChannel.onopen = null;\n\t\t\tthis.dataChannel.onmessage = null;\n\t\t\tthis.dataChannel.onclose = null;\n\t\t\tthis._dc = null;\n\t\t}\n\n\t\tif (this._encodingQueue) {\n\t\t\tthis._encodingQueue.destroy();\n\t\t\tthis._encodingQueue.removeAllListeners();\n\t\t\tthis._encodingQueue = null;\n\t\t}\n\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._open = false;\n\n\t\tsuper.emit(\"close\");\n\t}\n\n\t/** Allows user to send data. */\n\tsend(data: any, chunked?: boolean): void {\n\t\tif (!this.open) {\n\t\t\tsuper.emit(\n\t\t\t\t\"error\",\n\t\t\t\tnew Error(\n\t\t\t\t\t\"Connection is not open. You should listen for the `open` event before sending messages.\",\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.serialization === SerializationType.JSON) {\n\t\t\tthis._bufferedSend(this.stringify(data));\n\t\t} else if (\n\t\t\tthis.serialization === SerializationType.Binary ||\n\t\t\tthis.serialization === SerializationType.BinaryUTF8\n\t\t) {\n\t\t\tconst blob = util.pack(data);\n\n\t\t\tif (!chunked && blob.size > util.chunkedMTU) {\n\t\t\t\tthis._sendChunks(blob);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!util.supports.binaryBlob) {\n\t\t\t\t// We only do this if we really need to (e.g. blobs are not supported),\n\t\t\t\t// because this conversion is costly.\n\t\t\t\tthis._encodingQueue.enque(blob);\n\t\t\t} else {\n\t\t\t\tthis._bufferedSend(blob);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._bufferedSend(data);\n\t\t}\n\t}\n\n\tprivate _bufferedSend(msg: any): void {\n\t\tif (this._buffering || !this._trySend(msg)) {\n\t\t\tthis._buffer.push(msg);\n\t\t\tthis._bufferSize = this._buffer.length;\n\t\t}\n\t}\n\n\t// Returns true if the send succeeds.\n\tprivate _trySend(msg: any): boolean {\n\t\tif (!this.open) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.dataChannel.bufferedAmount > DataConnection.MAX_BUFFERED_AMOUNT) {\n\t\t\tthis._buffering = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis._buffering = false;\n\t\t\t\tthis._tryBuffer();\n\t\t\t}, 50);\n\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.dataChannel.send(msg);\n\t\t} catch (e) {\n\t\t\tlogger.error(`DC#:${this.connectionId} Error when sending:`, e);\n\t\t\tthis._buffering = true;\n\n\t\t\tthis.close();\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// Try to send the first message in the buffer.\n\tprivate _tryBuffer(): void {\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._buffer.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst msg = this._buffer[0];\n\n\t\tif (this._trySend(msg)) {\n\t\t\tthis._buffer.shift();\n\t\t\tthis._bufferSize = this._buffer.length;\n\t\t\tthis._tryBuffer();\n\t\t}\n\t}\n\n\tprivate _sendChunks(blob: Blob): void {\n\t\tconst blobs = util.chunk(blob);\n\t\tlogger.log(`DC#${this.connectionId} Try to send ${blobs.length} chunks...`);\n\n\t\tfor (let blob of blobs) {\n\t\t\tthis.send(blob, true);\n\t\t}\n\t}\n\n\thandleMessage(message: ServerMessage): void {\n\t\tconst payload = message.payload;\n\n\t\tswitch (message.type) {\n\t\t\tcase ServerMessageType.Answer:\n\t\t\t\tthis._negotiator.handleSDP(message.type, payload.sdp);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Candidate:\n\t\t\t\tthis._negotiator.handleCandidate(payload.candidate);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.warn(\n\t\t\t\t\t\"Unrecognized message type:\",\n\t\t\t\t\tmessage.type,\n\t\t\t\t\t\"from peer:\",\n\t\t\t\t\tthis.peer,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\n\nexport class EncodingQueue extends EventEmitter {\n\treadonly fileReader: FileReader = new FileReader();\n\n\tprivate _queue: Blob[] = [];\n\tprivate _processing: boolean = false;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.fileReader.onload = (evt) => {\n\t\t\tthis._processing = false;\n\n\t\t\tif (evt.target) {\n\t\t\t\tthis.emit(\"done\", evt.target.result as ArrayBuffer);\n\t\t\t}\n\n\t\t\tthis.doNextTask();\n\t\t};\n\n\t\tthis.fileReader.onerror = (evt) => {\n\t\t\tlogger.error(`EncodingQueue error:`, evt);\n\t\t\tthis._processing = false;\n\t\t\tthis.destroy();\n\t\t\tthis.emit(\"error\", evt);\n\t\t};\n\t}\n\n\tget queue(): Blob[] {\n\t\treturn this._queue;\n\t}\n\n\tget size(): number {\n\t\treturn this.queue.length;\n\t}\n\n\tget processing(): boolean {\n\t\treturn this._processing;\n\t}\n\n\tenque(blob: Blob): void {\n\t\tthis.queue.push(blob);\n\n\t\tif (this.processing) return;\n\n\t\tthis.doNextTask();\n\t}\n\n\tdestroy(): void {\n\t\tthis.fileReader.abort();\n\t\tthis._queue = [];\n\t}\n\n\tprivate doNextTask(): void {\n\t\tif (this.size === 0) return;\n\t\tif (this.processing) return;\n\n\t\tthis._processing = true;\n\n\t\tthis.fileReader.readAsArrayBuffer(this.queue.shift());\n\t}\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { PeerJSOption } from \"./optionInterfaces\";\nimport { version } from \"../package.json\";\n\nexport class API {\n\tconstructor(private readonly _options: PeerJSOption) {}\n\n\tprivate _buildRequest(method: string): Promise<Response> {\n\t\tconst protocol = this._options.secure ? \"https\" : \"http\";\n\t\tconst { host, port, path, key } = this._options;\n\t\tconst url = new URL(`${protocol}://${host}:${port}${path}${key}/${method}`);\n\t\t// TODO: Why timestamp, why random?\n\t\turl.searchParams.set(\"ts\", `${Date.now()}${Math.random()}`);\n\t\turl.searchParams.set(\"version\", version);\n\t\treturn fetch(url.href, {\n\t\t\treferrerPolicy: this._options.referrerPolicy,\n\t\t});\n\t}\n\n\t/** Get a unique ID from the server via XHR and initialize with it. */\n\tasync retrieveId(): Promise<string> {\n\t\ttry {\n\t\t\tconst response = await this._buildRequest(\"id\");\n\n\t\t\tif (response.status !== 200) {\n\t\t\t\tthrow new Error(`Error. Status:${response.status}`);\n\t\t\t}\n\n\t\t\treturn response.text();\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Error retrieving ID\", error);\n\n\t\t\tlet pathError = \"\";\n\n\t\t\tif (\n\t\t\t\tthis._options.path === \"/\" &&\n\t\t\t\tthis._options.host !== util.CLOUD_HOST\n\t\t\t) {\n\t\t\t\tpathError =\n\t\t\t\t\t\" If you passed in a `path` to your self-hosted PeerServer, \" +\n\t\t\t\t\t\"you'll also need to pass in that same path when creating a new \" +\n\t\t\t\t\t\"Peer.\";\n\t\t\t}\n\n\t\t\tthrow new Error(\"Could not get an ID from the server.\" + pathError);\n\t\t}\n\t}\n\n\t/** @deprecated */\n\tasync listAllPeers(): Promise<any[]> {\n\t\ttry {\n\t\t\tconst response = await this._buildRequest(\"peers\");\n\n\t\t\tif (response.status !== 200) {\n\t\t\t\tif (response.status === 401) {\n\t\t\t\t\tlet helpfulError = \"\";\n\n\t\t\t\t\tif (this._options.host === util.CLOUD_HOST) {\n\t\t\t\t\t\thelpfulError =\n\t\t\t\t\t\t\t\"It looks like you're using the cloud server. You can email \" +\n\t\t\t\t\t\t\t\"team@peerjs.com to enable peer listing for your API key.\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\thelpfulError =\n\t\t\t\t\t\t\t\"You need to enable `allow_discovery` on your self-hosted \" +\n\t\t\t\t\t\t\t\"PeerServer to use this feature.\";\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"It doesn't look like you have permission to list peers IDs. \" +\n\t\t\t\t\t\t\thelpfulError,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthrow new Error(`Error. Status:${response.status}`);\n\t\t\t}\n\n\t\t\treturn response.json();\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Error retrieving list peers\", error);\n\n\t\t\tthrow new Error(\"Could not get list peers from the server.\" + error);\n\t\t}\n\t}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}