{"ast":null,"code":"var _jsxFileName = \"E:\\\\PFE\\\\client\\\\src\\\\components\\\\message\\\\LeftSide.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport UserCard from '../UserCard';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { getDataAPI } from '../../utils/fetchData';\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes';\nimport { useHistory, useParams } from 'react-router-dom';\nimport { MESS_TYPES, getConversations } from '../../redux/actions/messageAction';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst LeftSide = () => {\n  _s();\n  const {\n    auth,\n    message,\n    online\n  } = useSelector(state => state);\n  const dispatch = useDispatch();\n  const [search, setSearch] = useState('');\n  const [searchUsers, setSearchUsers] = useState([]);\n  const history = useHistory();\n  const {\n    id\n  } = useParams();\n  const pageEnd = useRef();\n  const [page, setPage] = useState(0);\n  const handleSearch = async e => {\n    e.preventDefault();\n    if (!search) return setSearchUsers([]);\n    try {\n      const res = await getDataAPI(`search?username=${search}`, auth.token);\n      setSearchUsers(res.data.users);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n  const handleAddUser = user => {\n    setSearch('');\n    setSearchUsers([]);\n    dispatch({\n      type: MESS_TYPES.ADD_USER,\n      payload: {\n        ...user,\n        text: '',\n        media: []\n      }\n    });\n    dispatch({\n      type: MESS_TYPES.CHECK_ONLINE_OFFLINE,\n      payload: online\n    });\n    return history.push(`/message/${user._id}`);\n  };\n  const isActive = user => {\n    if (id === user._id) return 'active';\n    return '';\n  };\n  useEffect(() => {\n    if (message.firstLoad) return;\n    dispatch(getConversations({\n      auth\n    }));\n  }, [dispatch, auth, message.firstLoad]);\n\n  // Load More\n  useEffect(() => {\n    const observer = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting) {\n        setPage(p => p + 1);\n      }\n    }, {\n      threshold: 0.1\n    });\n    observer.observe(pageEnd.current);\n  }, [setPage]);\n  useEffect(() => {\n    if (message.resultUsers >= (page - 1) * 9 && page > 1) {\n      dispatch(getConversations({\n        auth,\n        page\n      }));\n    }\n  }, [message.resultUsers, page, auth, dispatch]);\n\n  // Check User Online - Offline\n  useEffect(() => {\n    if (message.firstLoad) {\n      dispatch({\n        type: MESS_TYPES.CHECK_ONLINE_OFFLINE,\n        payload: online\n      });\n    }\n  }, [online, message.firstLoad, dispatch]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"message_header\",\n      onSubmit: handleSearch,\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: search,\n        placeholder: \"Enter to Search...\",\n        onChange: e => setSearch(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        style: {\n          display: 'none'\n        },\n        children: \"Search\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"message_chat_list\",\n      children: [searchUsers.length !== 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: searchUsers.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `message_user ${isActive(user)}`,\n          onClick: () => handleAddUser(user),\n          children: /*#__PURE__*/_jsxDEV(UserCard, {\n            user: user\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 37\n          }, this)\n        }, user._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 33\n        }, this))\n      }, void 0, false) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: message.users.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `message_user ${isActive(user)}`,\n          onClick: () => handleAddUser(user),\n          children: /*#__PURE__*/_jsxDEV(UserCard, {\n            user: user,\n            msg: true,\n            children: user.online ? /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-circle text-success\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 47\n            }, this) : auth.user.following.find(item => item._id === user._id) && /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-circle\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 118,\n              columnNumber: 50\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 37\n          }, this)\n        }, user._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 33\n        }, this))\n      }, void 0, false), /*#__PURE__*/_jsxDEV(\"button\", {\n        ref: pageEnd,\n        style: {\n          opacity: 0\n        },\n        children: \"Load More\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 16\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n};\n_s(LeftSide, \"nXaU6rclc2654cH2HG+Jl5o7KIg=\", false, function () {\n  return [useSelector, useDispatch, useHistory, useParams];\n});\n_c = LeftSide;\nexport default LeftSide;\nvar _c;\n$RefreshReg$(_c, \"LeftSide\");","map":{"version":3,"names":["React","useState","useEffect","useRef","UserCard","useSelector","useDispatch","getDataAPI","GLOBALTYPES","useHistory","useParams","MESS_TYPES","getConversations","jsxDEV","_jsxDEV","Fragment","_Fragment","LeftSide","_s","auth","message","online","state","dispatch","search","setSearch","searchUsers","setSearchUsers","history","id","pageEnd","page","setPage","handleSearch","e","preventDefault","res","token","data","users","err","type","ALERT","payload","error","response","msg","handleAddUser","user","ADD_USER","text","media","CHECK_ONLINE_OFFLINE","push","_id","isActive","firstLoad","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","current","resultUsers","children","className","onSubmit","value","placeholder","onChange","target","fileName","_jsxFileName","lineNumber","columnNumber","style","display","length","map","onClick","following","find","item","ref","opacity","_c","$RefreshReg$"],"sources":["E:/PFE/client/src/components/message/LeftSide.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\r\nimport UserCard from '../UserCard'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport { getDataAPI } from '../../utils/fetchData'\r\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes'\r\nimport { useHistory, useParams } from 'react-router-dom'\r\nimport { MESS_TYPES, getConversations } from '../../redux/actions/messageAction'\r\n\r\n\r\nconst LeftSide = () => {\r\n    const { auth, message, online } = useSelector(state => state)\r\n    const dispatch = useDispatch()\r\n\r\n    const [search, setSearch] = useState('')\r\n    const [searchUsers, setSearchUsers] = useState([])\r\n\r\n    const history = useHistory()\r\n    const { id } = useParams()\r\n\r\n    const pageEnd = useRef()\r\n    const [page, setPage] = useState(0)\r\n\r\n    \r\n    const handleSearch = async e => {\r\n        e.preventDefault()\r\n        if(!search) return setSearchUsers([]);\r\n\r\n        try {\r\n            const res = await getDataAPI(`search?username=${search}`, auth.token)\r\n            setSearchUsers(res.data.users)\r\n        } catch (err) {\r\n            dispatch({\r\n                type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg}\r\n            })\r\n        }\r\n    }\r\n\r\n    const handleAddUser = (user) => {\r\n        setSearch('')\r\n        setSearchUsers([])\r\n        dispatch({type: MESS_TYPES.ADD_USER, payload: {...user, text: '', media: []}})\r\n        dispatch({type: MESS_TYPES.CHECK_ONLINE_OFFLINE, payload: online})\r\n        return history.push(`/message/${user._id}`)\r\n    }\r\n\r\n    const isActive = (user) => {\r\n        if(id === user._id) return 'active';\r\n        return ''\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(message.firstLoad) return;\r\n        dispatch(getConversations({auth}))\r\n    },[dispatch, auth, message.firstLoad])\r\n\r\n    // Load More\r\n    useEffect(() => {\r\n        const observer = new IntersectionObserver(entries => {\r\n            if(entries[0].isIntersecting){\r\n                setPage(p => p + 1)\r\n            }\r\n        },{\r\n            threshold: 0.1\r\n        })\r\n\r\n        observer.observe(pageEnd.current)\r\n    },[setPage])\r\n\r\n    useEffect(() => {\r\n        if(message.resultUsers >= (page - 1) * 9 && page > 1){\r\n            dispatch(getConversations({auth, page}))\r\n        }\r\n    },[message.resultUsers, page, auth, dispatch])\r\n    \r\n\r\n    // Check User Online - Offline\r\n    useEffect(() => {\r\n        if(message.firstLoad) {\r\n            dispatch({type: MESS_TYPES.CHECK_ONLINE_OFFLINE, payload: online})\r\n        }\r\n    },[online, message.firstLoad, dispatch])\r\n\r\n    return (\r\n        <>\r\n            <form className=\"message_header\" onSubmit={handleSearch} >\r\n                <input type=\"text\" value={search}\r\n                placeholder=\"Enter to Search...\"\r\n                onChange={e => setSearch(e.target.value)} />\r\n\r\n                <button type=\"submit\" style={{display: 'none'}}>Search</button>\r\n            </form>\r\n\r\n            <div className=\"message_chat_list\">\r\n                {\r\n                    searchUsers.length !== 0\r\n                    ?  <>\r\n                        {\r\n                            searchUsers.map(user => (\r\n                                <div key={user._id} className={`message_user ${isActive(user)}`}\r\n                                onClick={() => handleAddUser(user)}>\r\n                                    <UserCard user={user} />\r\n                                </div>\r\n                            ))\r\n                        }\r\n                        \r\n                    </>\r\n                    : <>\r\n                        {\r\n                            message.users.map(user => (\r\n                                <div key={user._id} className={`message_user ${isActive(user)}`}\r\n                                onClick={() => handleAddUser(user)}>\r\n                                    <UserCard user={user} msg={true}>\r\n                                        {\r\n                                            user.online\r\n                                            ? <i className=\"fas fa-circle text-success\" />\r\n                                            : auth.user.following.find(item => \r\n                                                item._id === user._id\r\n                                            ) && <i className=\"fas fa-circle\" />\r\n                                                \r\n                                        }\r\n                                        \r\n                                    </UserCard>\r\n                                </div>\r\n                            ))\r\n                        }\r\n                    </>\r\n                }\r\n               \r\n               <button ref={pageEnd} style={{opacity: 0}} >Load More</button>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default LeftSide\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}