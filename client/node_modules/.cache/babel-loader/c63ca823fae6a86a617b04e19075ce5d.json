{"ast":null,"code":"import { GLOBALTYPES, EditData, DeleteData } from './globalTypes';\nimport { POST_TYPES } from './postAction';\nimport { postDataAPI, patchDataAPI, deleteDataAPI } from '../../utils/fetchData';\nimport { createNotify, removeNotify } from '../actions/notifyAction';\nexport const createComment = _ref => {\n  let {\n    post,\n    newComment,\n    auth,\n    socket\n  } = _ref;\n  return async dispatch => {\n    const newPost = {\n      ...post,\n      comments: [...post.comments, newComment]\n    };\n    dispatch({\n      type: POST_TYPES.UPDATE_POST,\n      payload: newPost\n    });\n    try {\n      const data = {\n        ...newComment,\n        postId: post._id,\n        postUserId: post.user._id\n      };\n      const res = await postDataAPI('comment', data, auth.token);\n      const newData = {\n        ...res.data.newComment,\n        user: auth.user\n      };\n      const newPost = {\n        ...post,\n        comments: [...post.comments, newData]\n      };\n      dispatch({\n        type: POST_TYPES.UPDATE_POST,\n        payload: newPost\n      });\n\n      // Socket\n      socket.emit('createComment', newPost);\n\n      // Notify\n      const msg = {\n        id: res.data.newComment._id,\n        text: newComment.reply ? 'mentioned you in a comment.' : 'has commented on your post.',\n        recipients: newComment.reply ? [newComment.tag._id] : [post.user._id],\n        url: `/post/${post._id}`,\n        content: post.content,\n        image: post.images[0].url\n      };\n      dispatch(createNotify({\n        msg,\n        auth,\n        socket\n      }));\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const updateComment = _ref2 => {\n  let {\n    comment,\n    post,\n    content,\n    auth\n  } = _ref2;\n  return async dispatch => {\n    const newComments = EditData(post.comments, comment._id, {\n      ...comment,\n      content\n    });\n    const newPost = {\n      ...post,\n      comments: newComments\n    };\n    dispatch({\n      type: POST_TYPES.UPDATE_POST,\n      payload: newPost\n    });\n    try {\n      patchDataAPI(`comment/${comment._id}`, {\n        content\n      }, auth.token);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const likeComment = _ref3 => {\n  let {\n    comment,\n    post,\n    auth\n  } = _ref3;\n  return async dispatch => {\n    const newComment = {\n      ...comment,\n      likes: [...comment.likes, auth.user]\n    };\n    const newComments = EditData(post.comments, comment._id, newComment);\n    const newPost = {\n      ...post,\n      comments: newComments\n    };\n    dispatch({\n      type: POST_TYPES.UPDATE_POST,\n      payload: newPost\n    });\n    try {\n      await patchDataAPI(`comment/${comment._id}/like`, null, auth.token);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const unLikeComment = _ref4 => {\n  let {\n    comment,\n    post,\n    auth\n  } = _ref4;\n  return async dispatch => {\n    const newComment = {\n      ...comment,\n      likes: DeleteData(comment.likes, auth.user._id)\n    };\n    const newComments = EditData(post.comments, comment._id, newComment);\n    const newPost = {\n      ...post,\n      comments: newComments\n    };\n    dispatch({\n      type: POST_TYPES.UPDATE_POST,\n      payload: newPost\n    });\n    try {\n      await patchDataAPI(`comment/${comment._id}/unlike`, null, auth.token);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const deleteComment = _ref5 => {\n  let {\n    post,\n    comment,\n    auth,\n    socket\n  } = _ref5;\n  return async dispatch => {\n    const deleteArr = [...post.comments.filter(cm => cm.reply === comment._id), comment];\n    const newPost = {\n      ...post,\n      comments: post.comments.filter(cm => !deleteArr.find(da => cm._id === da._id))\n    };\n    dispatch({\n      type: POST_TYPES.UPDATE_POST,\n      payload: newPost\n    });\n    socket.emit('deleteComment', newPost);\n    try {\n      deleteArr.forEach(item => {\n        deleteDataAPI(`comment/${item._id}`, auth.token);\n        const msg = {\n          id: item._id,\n          text: comment.reply ? 'mentioned you in a comment.' : 'has commented on your post.',\n          recipients: comment.reply ? [comment.tag._id] : [post.user._id],\n          url: `/post/${post._id}`\n        };\n        dispatch(removeNotify({\n          msg,\n          auth,\n          socket\n        }));\n      });\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};","map":{"version":3,"names":["GLOBALTYPES","EditData","DeleteData","POST_TYPES","postDataAPI","patchDataAPI","deleteDataAPI","createNotify","removeNotify","createComment","_ref","post","newComment","auth","socket","dispatch","newPost","comments","type","UPDATE_POST","payload","data","postId","_id","postUserId","user","res","token","newData","emit","msg","id","text","reply","recipients","tag","url","content","image","images","err","ALERT","error","response","updateComment","_ref2","comment","newComments","likeComment","_ref3","likes","unLikeComment","_ref4","deleteComment","_ref5","deleteArr","filter","cm","find","da","forEach","item"],"sources":["E:/PFE/client/src/redux/actions/commentAction.js"],"sourcesContent":["import { GLOBALTYPES, EditData, DeleteData } from './globalTypes'\r\nimport { POST_TYPES } from './postAction'\r\nimport { postDataAPI, patchDataAPI, deleteDataAPI } from '../../utils/fetchData'\r\nimport { createNotify, removeNotify } from '../actions/notifyAction'\r\n\r\n\r\nexport const createComment = ({post, newComment, auth, socket}) => async (dispatch) => {\r\n    const newPost = {...post, comments: [...post.comments, newComment]}\r\n    \r\n    dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost })\r\n\r\n    try {\r\n        const data = {...newComment, postId: post._id, postUserId: post.user._id}\r\n        const res = await postDataAPI('comment', data, auth.token)\r\n\r\n        const newData = {...res.data.newComment, user: auth.user}\r\n        const newPost = {...post, comments: [...post.comments, newData]}\r\n        dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost })\r\n\r\n        // Socket\r\n        socket.emit('createComment', newPost)\r\n\r\n        // Notify\r\n        const msg = {\r\n            id: res.data.newComment._id,\r\n            text: newComment.reply ? 'mentioned you in a comment.' : 'has commented on your post.',\r\n            recipients: newComment.reply ? [newComment.tag._id] : [post.user._id],\r\n            url: `/post/${post._id}`,\r\n            content: post.content, \r\n            image: post.images[0].url\r\n        }\r\n\r\n        dispatch(createNotify({msg, auth, socket}))\r\n        \r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg} })\r\n    }\r\n}\r\n\r\nexport const updateComment = ({comment, post, content, auth}) => async (dispatch) => {\r\n    const newComments = EditData(post.comments, comment._id, {...comment, content})\r\n    const newPost = {...post, comments: newComments}\r\n    \r\n    dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost })\r\n    try {\r\n        patchDataAPI(`comment/${comment._id}`, { content }, auth.token)\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg} })\r\n    }\r\n}\r\n\r\nexport const likeComment = ({comment, post, auth}) => async (dispatch) => {\r\n    const newComment = {...comment, likes: [...comment.likes, auth.user]}\r\n\r\n    const newComments = EditData(post.comments, comment._id, newComment)\r\n\r\n    const newPost = {...post, comments: newComments}\r\n    \r\n    dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost })\r\n\r\n    try {\r\n        await patchDataAPI(`comment/${comment._id}/like`, null, auth.token)\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg} })\r\n    }\r\n}\r\n\r\nexport const unLikeComment = ({comment, post, auth}) => async (dispatch) => {\r\n\r\n    const newComment = {...comment, likes: DeleteData(comment.likes, auth.user._id)}\r\n\r\n    const newComments = EditData(post.comments, comment._id, newComment)\r\n\r\n    const newPost = {...post, comments: newComments}\r\n    \r\n    dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost })\r\n\r\n    try {\r\n        await patchDataAPI(`comment/${comment._id}/unlike`, null, auth.token)\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg} })\r\n    }\r\n}\r\n\r\nexport const deleteComment = ({post, comment, auth, socket}) => async (dispatch) => {\r\n    const deleteArr = [...post.comments.filter(cm => cm.reply === comment._id), comment]\r\n    \r\n    const newPost = {\r\n        ...post,\r\n        comments: post.comments.filter(cm => !deleteArr.find(da => cm._id === da._id))\r\n    }\r\n\r\n    dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost })\r\n\r\n    socket.emit('deleteComment', newPost)\r\n    try {\r\n       deleteArr.forEach(item => {\r\n            deleteDataAPI(`comment/${item._id}`, auth.token)\r\n\r\n            const msg = {\r\n                id: item._id,\r\n                text: comment.reply ? 'mentioned you in a comment.' : 'has commented on your post.',\r\n                recipients: comment.reply ? [comment.tag._id] : [post.user._id],\r\n                url: `/post/${post._id}`,\r\n            }\r\n    \r\n            dispatch(removeNotify({msg, auth, socket}))\r\n       })\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg} })\r\n    }\r\n\r\n}"],"mappings":"AAAA,SAASA,WAAW,EAAEC,QAAQ,EAAEC,UAAU,QAAQ,eAAe;AACjE,SAASC,UAAU,QAAQ,cAAc;AACzC,SAASC,WAAW,EAAEC,YAAY,EAAEC,aAAa,QAAQ,uBAAuB;AAChF,SAASC,YAAY,EAAEC,YAAY,QAAQ,yBAAyB;AAGpE,OAAO,MAAMC,aAAa,GAAGC,IAAA;EAAA,IAAC;IAACC,IAAI;IAAEC,UAAU;IAAEC,IAAI;IAAEC;EAAM,CAAC,GAAAJ,IAAA;EAAA,OAAK,MAAOK,QAAQ,IAAK;IACnF,MAAMC,OAAO,GAAG;MAAC,GAAGL,IAAI;MAAEM,QAAQ,EAAE,CAAC,GAAGN,IAAI,CAACM,QAAQ,EAAEL,UAAU;IAAC,CAAC;IAEnEG,QAAQ,CAAC;MAAEG,IAAI,EAAEf,UAAU,CAACgB,WAAW;MAAEC,OAAO,EAAEJ;IAAQ,CAAC,CAAC;IAE5D,IAAI;MACA,MAAMK,IAAI,GAAG;QAAC,GAAGT,UAAU;QAAEU,MAAM,EAAEX,IAAI,CAACY,GAAG;QAAEC,UAAU,EAAEb,IAAI,CAACc,IAAI,CAACF;MAAG,CAAC;MACzE,MAAMG,GAAG,GAAG,MAAMtB,WAAW,CAAC,SAAS,EAAEiB,IAAI,EAAER,IAAI,CAACc,KAAK,CAAC;MAE1D,MAAMC,OAAO,GAAG;QAAC,GAAGF,GAAG,CAACL,IAAI,CAACT,UAAU;QAAEa,IAAI,EAAEZ,IAAI,CAACY;MAAI,CAAC;MACzD,MAAMT,OAAO,GAAG;QAAC,GAAGL,IAAI;QAAEM,QAAQ,EAAE,CAAC,GAAGN,IAAI,CAACM,QAAQ,EAAEW,OAAO;MAAC,CAAC;MAChEb,QAAQ,CAAC;QAAEG,IAAI,EAAEf,UAAU,CAACgB,WAAW;QAAEC,OAAO,EAAEJ;MAAQ,CAAC,CAAC;;MAE5D;MACAF,MAAM,CAACe,IAAI,CAAC,eAAe,EAAEb,OAAO,CAAC;;MAErC;MACA,MAAMc,GAAG,GAAG;QACRC,EAAE,EAAEL,GAAG,CAACL,IAAI,CAACT,UAAU,CAACW,GAAG;QAC3BS,IAAI,EAAEpB,UAAU,CAACqB,KAAK,GAAG,6BAA6B,GAAG,6BAA6B;QACtFC,UAAU,EAAEtB,UAAU,CAACqB,KAAK,GAAG,CAACrB,UAAU,CAACuB,GAAG,CAACZ,GAAG,CAAC,GAAG,CAACZ,IAAI,CAACc,IAAI,CAACF,GAAG,CAAC;QACrEa,GAAG,EAAG,SAAQzB,IAAI,CAACY,GAAI,EAAC;QACxBc,OAAO,EAAE1B,IAAI,CAAC0B,OAAO;QACrBC,KAAK,EAAE3B,IAAI,CAAC4B,MAAM,CAAC,CAAC,CAAC,CAACH;MAC1B,CAAC;MAEDrB,QAAQ,CAACR,YAAY,CAAC;QAACuB,GAAG;QAAEjB,IAAI;QAAEC;MAAM,CAAC,CAAC,CAAC;IAE/C,CAAC,CAAC,OAAO0B,GAAG,EAAE;MACVzB,QAAQ,CAAC;QAAEG,IAAI,EAAElB,WAAW,CAACyC,KAAK;QAAErB,OAAO,EAAE;UAACsB,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACtB,IAAI,CAACS;QAAG;MAAE,CAAC,CAAC;IAClF;EACJ,CAAC;AAAA;AAED,OAAO,MAAMc,aAAa,GAAGC,KAAA;EAAA,IAAC;IAACC,OAAO;IAAEnC,IAAI;IAAE0B,OAAO;IAAExB;EAAI,CAAC,GAAAgC,KAAA;EAAA,OAAK,MAAO9B,QAAQ,IAAK;IACjF,MAAMgC,WAAW,GAAG9C,QAAQ,CAACU,IAAI,CAACM,QAAQ,EAAE6B,OAAO,CAACvB,GAAG,EAAE;MAAC,GAAGuB,OAAO;MAAET;IAAO,CAAC,CAAC;IAC/E,MAAMrB,OAAO,GAAG;MAAC,GAAGL,IAAI;MAAEM,QAAQ,EAAE8B;IAAW,CAAC;IAEhDhC,QAAQ,CAAC;MAAEG,IAAI,EAAEf,UAAU,CAACgB,WAAW;MAAEC,OAAO,EAAEJ;IAAQ,CAAC,CAAC;IAC5D,IAAI;MACAX,YAAY,CAAE,WAAUyC,OAAO,CAACvB,GAAI,EAAC,EAAE;QAAEc;MAAQ,CAAC,EAAExB,IAAI,CAACc,KAAK,CAAC;IACnE,CAAC,CAAC,OAAOa,GAAG,EAAE;MACVzB,QAAQ,CAAC;QAAEG,IAAI,EAAElB,WAAW,CAACyC,KAAK;QAAErB,OAAO,EAAE;UAACsB,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACtB,IAAI,CAACS;QAAG;MAAE,CAAC,CAAC;IAClF;EACJ,CAAC;AAAA;AAED,OAAO,MAAMkB,WAAW,GAAGC,KAAA;EAAA,IAAC;IAACH,OAAO;IAAEnC,IAAI;IAAEE;EAAI,CAAC,GAAAoC,KAAA;EAAA,OAAK,MAAOlC,QAAQ,IAAK;IACtE,MAAMH,UAAU,GAAG;MAAC,GAAGkC,OAAO;MAAEI,KAAK,EAAE,CAAC,GAAGJ,OAAO,CAACI,KAAK,EAAErC,IAAI,CAACY,IAAI;IAAC,CAAC;IAErE,MAAMsB,WAAW,GAAG9C,QAAQ,CAACU,IAAI,CAACM,QAAQ,EAAE6B,OAAO,CAACvB,GAAG,EAAEX,UAAU,CAAC;IAEpE,MAAMI,OAAO,GAAG;MAAC,GAAGL,IAAI;MAAEM,QAAQ,EAAE8B;IAAW,CAAC;IAEhDhC,QAAQ,CAAC;MAAEG,IAAI,EAAEf,UAAU,CAACgB,WAAW;MAAEC,OAAO,EAAEJ;IAAQ,CAAC,CAAC;IAE5D,IAAI;MACA,MAAMX,YAAY,CAAE,WAAUyC,OAAO,CAACvB,GAAI,OAAM,EAAE,IAAI,EAAEV,IAAI,CAACc,KAAK,CAAC;IACvE,CAAC,CAAC,OAAOa,GAAG,EAAE;MACVzB,QAAQ,CAAC;QAAEG,IAAI,EAAElB,WAAW,CAACyC,KAAK;QAAErB,OAAO,EAAE;UAACsB,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACtB,IAAI,CAACS;QAAG;MAAE,CAAC,CAAC;IAClF;EACJ,CAAC;AAAA;AAED,OAAO,MAAMqB,aAAa,GAAGC,KAAA;EAAA,IAAC;IAACN,OAAO;IAAEnC,IAAI;IAAEE;EAAI,CAAC,GAAAuC,KAAA;EAAA,OAAK,MAAOrC,QAAQ,IAAK;IAExE,MAAMH,UAAU,GAAG;MAAC,GAAGkC,OAAO;MAAEI,KAAK,EAAEhD,UAAU,CAAC4C,OAAO,CAACI,KAAK,EAAErC,IAAI,CAACY,IAAI,CAACF,GAAG;IAAC,CAAC;IAEhF,MAAMwB,WAAW,GAAG9C,QAAQ,CAACU,IAAI,CAACM,QAAQ,EAAE6B,OAAO,CAACvB,GAAG,EAAEX,UAAU,CAAC;IAEpE,MAAMI,OAAO,GAAG;MAAC,GAAGL,IAAI;MAAEM,QAAQ,EAAE8B;IAAW,CAAC;IAEhDhC,QAAQ,CAAC;MAAEG,IAAI,EAAEf,UAAU,CAACgB,WAAW;MAAEC,OAAO,EAAEJ;IAAQ,CAAC,CAAC;IAE5D,IAAI;MACA,MAAMX,YAAY,CAAE,WAAUyC,OAAO,CAACvB,GAAI,SAAQ,EAAE,IAAI,EAAEV,IAAI,CAACc,KAAK,CAAC;IACzE,CAAC,CAAC,OAAOa,GAAG,EAAE;MACVzB,QAAQ,CAAC;QAAEG,IAAI,EAAElB,WAAW,CAACyC,KAAK;QAAErB,OAAO,EAAE;UAACsB,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACtB,IAAI,CAACS;QAAG;MAAE,CAAC,CAAC;IAClF;EACJ,CAAC;AAAA;AAED,OAAO,MAAMuB,aAAa,GAAGC,KAAA;EAAA,IAAC;IAAC3C,IAAI;IAAEmC,OAAO;IAAEjC,IAAI;IAAEC;EAAM,CAAC,GAAAwC,KAAA;EAAA,OAAK,MAAOvC,QAAQ,IAAK;IAChF,MAAMwC,SAAS,GAAG,CAAC,GAAG5C,IAAI,CAACM,QAAQ,CAACuC,MAAM,CAACC,EAAE,IAAIA,EAAE,CAACxB,KAAK,KAAKa,OAAO,CAACvB,GAAG,CAAC,EAAEuB,OAAO,CAAC;IAEpF,MAAM9B,OAAO,GAAG;MACZ,GAAGL,IAAI;MACPM,QAAQ,EAAEN,IAAI,CAACM,QAAQ,CAACuC,MAAM,CAACC,EAAE,IAAI,CAACF,SAAS,CAACG,IAAI,CAACC,EAAE,IAAIF,EAAE,CAAClC,GAAG,KAAKoC,EAAE,CAACpC,GAAG,CAAC;IACjF,CAAC;IAEDR,QAAQ,CAAC;MAAEG,IAAI,EAAEf,UAAU,CAACgB,WAAW;MAAEC,OAAO,EAAEJ;IAAQ,CAAC,CAAC;IAE5DF,MAAM,CAACe,IAAI,CAAC,eAAe,EAAEb,OAAO,CAAC;IACrC,IAAI;MACDuC,SAAS,CAACK,OAAO,CAACC,IAAI,IAAI;QACrBvD,aAAa,CAAE,WAAUuD,IAAI,CAACtC,GAAI,EAAC,EAAEV,IAAI,CAACc,KAAK,CAAC;QAEhD,MAAMG,GAAG,GAAG;UACRC,EAAE,EAAE8B,IAAI,CAACtC,GAAG;UACZS,IAAI,EAAEc,OAAO,CAACb,KAAK,GAAG,6BAA6B,GAAG,6BAA6B;UACnFC,UAAU,EAAEY,OAAO,CAACb,KAAK,GAAG,CAACa,OAAO,CAACX,GAAG,CAACZ,GAAG,CAAC,GAAG,CAACZ,IAAI,CAACc,IAAI,CAACF,GAAG,CAAC;UAC/Da,GAAG,EAAG,SAAQzB,IAAI,CAACY,GAAI;QAC3B,CAAC;QAEDR,QAAQ,CAACP,YAAY,CAAC;UAACsB,GAAG;UAAEjB,IAAI;UAAEC;QAAM,CAAC,CAAC,CAAC;MAChD,CAAC,CAAC;IACL,CAAC,CAAC,OAAO0B,GAAG,EAAE;MACVzB,QAAQ,CAAC;QAAEG,IAAI,EAAElB,WAAW,CAACyC,KAAK;QAAErB,OAAO,EAAE;UAACsB,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACtB,IAAI,CAACS;QAAG;MAAE,CAAC,CAAC;IAClF;EAEJ,CAAC;AAAA"},"metadata":{},"sourceType":"module"}